import{SensorEventType as e}from"../sensor-TzqXogk2.js";import"../base-sensor-cUrlV0_m.js";import"../ticker-EaCO7G8S.js";import{BaseMotionSensor as t}from"../base-motion-sensor-BS2TuJo7.js";const n=[`start`,`cancel`,`end`,`moveLeft`,`moveRight`,`moveUp`,`moveDown`];function r(e,t){if(!e.size||!t.size)return 1/0;let n=1/0;for(let r of e){let e=t.get(r);e!==void 0&&e<n&&(n=e)}return n}const i={startKeys:[` `,`Enter`],moveLeftKeys:[`ArrowLeft`],moveRightKeys:[`ArrowRight`],moveUpKeys:[`ArrowUp`],moveDownKeys:[`ArrowDown`],cancelKeys:[`Escape`],endKeys:[` `,`Enter`],cancelOnBlur:!0,cancelOnVisibilityChange:!0,computeSpeed:()=>500,startPredicate:(e,t)=>{if(t.element&&document.activeElement===t.element){let{left:e,top:n}=t.element.getBoundingClientRect();return{x:e,y:n}}return null}};var a=class extends t{constructor(e,t={}){super();let{startPredicate:n=i.startPredicate,computeSpeed:r=i.computeSpeed,cancelOnVisibilityChange:a=i.cancelOnVisibilityChange,cancelOnBlur:o=i.cancelOnBlur,startKeys:s=i.startKeys,moveLeftKeys:c=i.moveLeftKeys,moveRightKeys:l=i.moveRightKeys,moveUpKeys:u=i.moveUpKeys,moveDownKeys:d=i.moveDownKeys,cancelKeys:f=i.cancelKeys,endKeys:p=i.endKeys}=t;this.element=e,this._startKeys=new Set(s),this._cancelKeys=new Set(f),this._endKeys=new Set(p),this._moveLeftKeys=new Set(c),this._moveRightKeys=new Set(l),this._moveUpKeys=new Set(u),this._moveDownKeys=new Set(d),this._moveKeys=new Set([...c,...l,...u,...d]),this._moveKeyTimestamps=new Map,this._cancelOnBlur=o,this._cancelOnVisibilityChange=a,this._computeSpeed=r,this._startPredicate=n,this._onKeyDown=this._onKeyDown.bind(this),this._onKeyUp=this._onKeyUp.bind(this),this._onTick=this._onTick.bind(this),this._internalCancel=this._internalCancel.bind(this),this._blurCancelHandler=this._blurCancelHandler.bind(this),this.on(`tick`,this._onTick,this._onTick),document.addEventListener(`keydown`,this._onKeyDown),document.addEventListener(`keyup`,this._onKeyUp),o&&e?.addEventListener(`blur`,this._blurCancelHandler),a&&document.addEventListener(`visibilitychange`,this._internalCancel)}_end(e){this.drag&&(this._moveKeyTimestamps.clear(),this._direction.x=0,this._direction.y=0,super._end(e))}_cancel(e){this.drag&&(this._moveKeyTimestamps.clear(),this._direction.x=0,this._direction.y=0,super._cancel(e))}_internalCancel(){this.cancel()}_blurCancelHandler(){queueMicrotask(()=>{document.activeElement!==this.element&&this.cancel()})}_updateDirection(){let e=r(this._moveLeftKeys,this._moveKeyTimestamps),t=r(this._moveRightKeys,this._moveKeyTimestamps),n=r(this._moveUpKeys,this._moveKeyTimestamps),i=r(this._moveDownKeys,this._moveKeyTimestamps),a=e===t?0:e<t?-1:1,o=n===i?0:n<i?-1:1;if(!(a===0||o===0)){let e=1/(Math.sqrt(a*a+o*o)||1);a*=e,o*=e}this._direction.x=a,this._direction.y=o}_onTick(){this._speed=this._computeSpeed(this)}_onKeyUp(e){this._moveKeyTimestamps.get(e.key)&&(this._moveKeyTimestamps.delete(e.key),this._updateDirection())}_onKeyDown(t){if(!this.drag){if(this._startKeys.has(t.key)){let n=this._startPredicate(t,this);n&&(t.preventDefault(),this._start({type:e.Start,x:n.x,y:n.y}))}return}if(this._cancelKeys.has(t.key)){t.preventDefault(),this._internalCancel();return}if(this._endKeys.has(t.key)){t.preventDefault(),this._end({type:e.End,x:this.drag.x,y:this.drag.y});return}if(this._moveKeys.has(t.key)){t.preventDefault(),this._moveKeyTimestamps.get(t.key)||(this._moveKeyTimestamps.set(t.key,Date.now()),this._updateDirection());return}}updateSettings(e={}){let t=!1,{cancelOnBlur:r,cancelOnVisibilityChange:i,startPredicate:a,computeSpeed:o}=e;if(r!==void 0&&this._cancelOnBlur!==r&&(this._cancelOnBlur=r,r?this.element?.addEventListener(`blur`,this._blurCancelHandler):this.element?.removeEventListener(`blur`,this._blurCancelHandler)),i!==void 0&&this._cancelOnVisibilityChange!==i&&(this._cancelOnVisibilityChange=i,i?document.addEventListener(`visibilitychange`,this._internalCancel):document.removeEventListener(`visibilitychange`,this._internalCancel)),a!==void 0&&(this._startPredicate=a),o!==void 0&&(this._computeSpeed=o),n.forEach((n,r)=>{let i=`${n}Keys`,a=e[i];a!==void 0&&(this[`_${i}`]=new Set(a),r>=3&&(t=!0))}),t){let e=[...this._moveLeftKeys,...this._moveRightKeys,...this._moveUpKeys,...this._moveDownKeys];[...this._moveKeys].every((t,n)=>e[n]===t)||(this._moveKeys=new Set(e),this._moveKeyTimestamps.clear(),this._updateDirection())}}destroy(){this.isDestroyed||(super.destroy(),this.off(`tick`,this._onTick),document.removeEventListener(`keydown`,this._onKeyDown),document.removeEventListener(`keyup`,this._onKeyUp),this._cancelOnBlur&&this.element?.removeEventListener(`blur`,this._blurCancelHandler),this._cancelOnVisibilityChange&&document.removeEventListener(`visibilitychange`,this._internalCancel))}};export{a as KeyboardMotionSensor,i as keyboardMotionSensorDefaults};
//# sourceMappingURL=keyboard-motion-sensor.js.map