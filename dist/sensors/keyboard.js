import{SensorEventType as e}from"../sensor-TzqXogk2.js";import{BaseSensor as t}from"../base-sensor-cUrlV0_m.js";const n={moveDistance:25,cancelOnBlur:!0,cancelOnVisibilityChange:!0,startPredicate:(e,t)=>{if(t.element&&(e.key===`Enter`||e.key===` `)&&document.activeElement===t.element){let{x:e,y:n}=t.element.getBoundingClientRect();return{x:e,y:n}}return null},movePredicate:(e,t)=>{if(!t.drag)return null;switch(e.key){case`ArrowLeft`:return{x:t.drag.x-t.moveDistance.x,y:t.drag.y};case`ArrowRight`:return{x:t.drag.x+t.moveDistance.x,y:t.drag.y};case`ArrowUp`:return{x:t.drag.x,y:t.drag.y-t.moveDistance.y};case`ArrowDown`:return{x:t.drag.x,y:t.drag.y+t.moveDistance.y};default:return null}},cancelPredicate:(e,t)=>{if(t.drag&&e.key===`Escape`){let{x:e,y:n}=t.drag;return{x:e,y:n}}return null},endPredicate:(e,t)=>{if(t.drag&&(e.key===`Enter`||e.key===` `)){let{x:e,y:n}=t.drag;return{x:e,y:n}}return null}};var r=class extends t{constructor(e,t={}){super();let{moveDistance:r=n.moveDistance,cancelOnBlur:i=n.cancelOnBlur,cancelOnVisibilityChange:a=n.cancelOnVisibilityChange,startPredicate:o=n.startPredicate,movePredicate:s=n.movePredicate,cancelPredicate:c=n.cancelPredicate,endPredicate:l=n.endPredicate}=t;this.element=e,this.moveDistance=typeof r==`number`?{x:r,y:r}:{...r},this._cancelOnBlur=i,this._cancelOnVisibilityChange=a,this._startPredicate=o,this._movePredicate=s,this._cancelPredicate=c,this._endPredicate=l,this._onKeyDown=this._onKeyDown.bind(this),this._internalCancel=this._internalCancel.bind(this),this._blurCancelHandler=this._blurCancelHandler.bind(this),document.addEventListener(`keydown`,this._onKeyDown),i&&e?.addEventListener(`blur`,this._blurCancelHandler),a&&document.addEventListener(`visibilitychange`,this._internalCancel)}_internalCancel(){this.cancel()}_blurCancelHandler(){queueMicrotask(()=>{document.activeElement!==this.element&&this.cancel()})}_onKeyDown(t){if(!this.drag){let n=this._startPredicate(t,this);n&&(t.preventDefault(),this._start({type:e.Start,x:n.x,y:n.y,srcEvent:t}));return}let n=this._cancelPredicate(t,this);if(n){t.preventDefault(),this._cancel({type:e.Cancel,x:n.x,y:n.y,srcEvent:t});return}let r=this._endPredicate(t,this);if(r){t.preventDefault(),this._end({type:e.End,x:r.x,y:r.y,srcEvent:t});return}let i=this._movePredicate(t,this);if(i){t.preventDefault(),this._move({type:e.Move,x:i.x,y:i.y,srcEvent:t});return}}updateSettings(e={}){let{moveDistance:t,cancelOnBlur:n,cancelOnVisibilityChange:r,startPredicate:i,movePredicate:a,cancelPredicate:o,endPredicate:s}=e;t!==void 0&&(typeof t==`number`?this.moveDistance.x=this.moveDistance.y=t:(this.moveDistance.x=t.x,this.moveDistance.y=t.y)),n!==void 0&&this._cancelOnBlur!==n&&(this._cancelOnBlur=n,n?this.element?.addEventListener(`blur`,this._blurCancelHandler):this.element?.removeEventListener(`blur`,this._blurCancelHandler)),r!==void 0&&this._cancelOnVisibilityChange!==r&&(this._cancelOnVisibilityChange=r,r?document.addEventListener(`visibilitychange`,this._internalCancel):document.removeEventListener(`visibilitychange`,this._internalCancel)),i&&(this._startPredicate=i),a&&(this._movePredicate=a),o&&(this._cancelPredicate=o),s&&(this._endPredicate=s)}destroy(){this.isDestroyed||(super.destroy(),document.removeEventListener(`keydown`,this._onKeyDown),this._cancelOnBlur&&this.element?.removeEventListener(`blur`,this._blurCancelHandler),this._cancelOnVisibilityChange&&document.removeEventListener(`visibilitychange`,this._internalCancel))}};export{r as KeyboardSensor,n as keyboardSensorDefaults};
//# sourceMappingURL=keyboard.js.map