{"version":3,"file":"containment.js","names":[],"sources":["../../../src/draggable/modifiers/create-containment-modifier.ts"],"sourcesContent":["import type { Sensor } from '../../sensors/sensor.js';\n\nimport type { DraggableModifier, DraggableModifierData } from '../../draggable/draggable.js';\n\nimport type { Rect } from '../../types.js';\n\nimport { PointerSensor } from '../../sensors/pointer-sensor.js';\n\nimport { createFullRect } from '../../utils/create-full-rect.js';\n\nconst TEMP_RECT_1 = createFullRect();\n\nconst TEMP_RECT_2 = createFullRect();\n\nconst ADJUSTMENT_DATA = { change: 0, drift: 0 };\n\nfunction adjustAxisChange(\n  itemStartX: number,\n  itemEndX: number,\n  containerStartX: number,\n  containerEndX: number,\n  drift: number,\n  change: number,\n  trackDrift: boolean,\n) {\n  let nextChange = change;\n  let nextDrift = drift;\n\n  if (change > 0) {\n    nextChange = Math.min(Math.max(containerEndX - itemEndX, 0), change);\n    if (trackDrift) {\n      if (drift < 0) {\n        const driftChange = Math.min(-drift, change);\n        nextDrift = drift + driftChange;\n        nextChange = Math.max(0, nextChange - driftChange);\n      } else {\n        nextDrift = drift + (change - nextChange);\n      }\n    }\n  } else if (change < 0) {\n    nextChange = Math.max(Math.min(containerStartX - itemStartX, 0), change);\n    if (trackDrift) {\n      if (drift > 0) {\n        const driftChange = Math.max(-drift, change);\n        nextDrift = drift + driftChange;\n        nextChange = Math.min(0, nextChange - driftChange);\n      } else {\n        nextDrift = drift + (change - nextChange);\n      }\n    }\n  }\n\n  ADJUSTMENT_DATA.change = nextChange;\n  ADJUSTMENT_DATA.drift = nextDrift;\n}\n\nexport function createContainmentModifier<S extends Sensor[], E extends S[number]['_events_type']>(\n  getContainerRect: (data: DraggableModifierData<S, E>) => Rect,\n  trackSensorDrift: boolean | ((data: DraggableModifierData<S, E>) => boolean) = ({ drag }) => {\n    return drag.sensor instanceof PointerSensor;\n  },\n) {\n  return function containmentModifier(change, data) {\n    const containerRect = createFullRect(getContainerRect(data), TEMP_RECT_1);\n    const itemRect = createFullRect(data.item.clientRect, TEMP_RECT_2);\n    const itemData = data.item.data;\n    const containmentState = itemData.__containment__ || {\n      drift: { x: 0, y: 0 },\n      trackDrift: false,\n    };\n\n    // On first move, store the containment state. Item data will be kept alive\n    // for the duration of the drag, but it will be removed once the drag ends.\n    if (!itemData.__containment__) {\n      containmentState.trackDrift =\n        typeof trackSensorDrift === 'function' ? trackSensorDrift(data) : trackSensorDrift;\n      itemData.__containment__ = containmentState;\n    }\n\n    const { drift, trackDrift } = containmentState;\n\n    if (change.x) {\n      adjustAxisChange(\n        itemRect.left,\n        itemRect.right,\n        containerRect.left,\n        containerRect.right,\n        drift.x,\n        change.x,\n        trackDrift,\n      );\n      drift.x = ADJUSTMENT_DATA.drift;\n      change.x = ADJUSTMENT_DATA.change;\n    }\n\n    if (change.y) {\n      adjustAxisChange(\n        itemRect.top,\n        itemRect.bottom,\n        containerRect.top,\n        containerRect.bottom,\n        drift.y,\n        change.y,\n        trackDrift,\n      );\n      drift.y = ADJUSTMENT_DATA.drift;\n      change.y = ADJUSTMENT_DATA.change;\n    }\n\n    return change;\n  } as DraggableModifier<S, E>;\n}\n"],"mappings":"0MAUA,MAAM,EAAc,GAAgB,CAE9B,EAAc,GAAgB,CAE9B,EAAkB,CAAE,OAAQ,EAAG,MAAO,EAAG,CAE/C,SAAS,EACP,EACA,EACA,EACA,EACA,EACA,EACA,EACA,CACA,IAAI,EAAa,EACb,EAAY,EAEhB,GAAI,EAAS,EAEX,IADA,EAAa,KAAK,IAAI,KAAK,IAAI,EAAgB,EAAU,EAAE,CAAE,EAAO,CAChE,EACF,GAAI,EAAQ,EAAG,CACb,IAAM,EAAc,KAAK,IAAI,CAAC,EAAO,EAAO,CAC5C,EAAY,EAAQ,EACpB,EAAa,KAAK,IAAI,EAAG,EAAa,EAAY,MAElD,EAAY,GAAS,EAAS,WAGzB,EAAS,IAClB,EAAa,KAAK,IAAI,KAAK,IAAI,EAAkB,EAAY,EAAE,CAAE,EAAO,CACpE,GACF,GAAI,EAAQ,EAAG,CACb,IAAM,EAAc,KAAK,IAAI,CAAC,EAAO,EAAO,CAC5C,EAAY,EAAQ,EACpB,EAAa,KAAK,IAAI,EAAG,EAAa,EAAY,MAElD,EAAY,GAAS,EAAS,GAKpC,EAAgB,OAAS,EACzB,EAAgB,MAAQ,EAG1B,SAAgB,EACd,EACA,GAAgF,CAAE,UACzE,EAAK,kBAAkB,EAEhC,CACA,OAAO,SAA6B,EAAQ,EAAM,CAChD,IAAM,EAAgB,EAAe,EAAiB,EAAK,CAAE,EAAY,CACnE,EAAW,EAAe,EAAK,KAAK,WAAY,EAAY,CAC5D,EAAW,EAAK,KAAK,KACrB,EAAmB,EAAS,iBAAmB,CACnD,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,CACrB,WAAY,GACb,CAID,AAGE,EAAS,mBAFT,EAAiB,WACf,OAAO,GAAqB,WAAa,EAAiB,EAAK,CAAG,EACzC,GAG7B,GAAM,CAAE,QAAO,cAAe,EA8B9B,MA5BA,CAWE,EAAO,KAVP,EACE,EAAS,KACT,EAAS,MACT,EAAc,KACd,EAAc,MACd,EAAM,EACN,EAAO,EACP,EACD,CACD,EAAM,EAAI,EAAgB,MACf,EAAgB,QAG7B,AAWE,EAAO,KAVP,EACE,EAAS,IACT,EAAS,OACT,EAAc,IACd,EAAc,OACd,EAAM,EACN,EAAO,EACP,EACD,CACD,EAAM,EAAI,EAAgB,MACf,EAAgB,QAGtB"}