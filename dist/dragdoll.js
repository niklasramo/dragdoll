var m={Start:"start",Move:"move",Cancel:"cancel",End:"end",Destroy:"destroy"},et=class{};import{Emitter as Rt}from"eventti";var G=class{constructor(){this.drag=null,this.isDestroyed=!1,this._emitter=new Rt}_createDragData(e){return{x:e.x,y:e.y}}_updateDragData(e){this.drag&&(this.drag.x=e.x,this.drag.y=e.y)}_resetDragData(){this.drag=null}_start(e){this.isDestroyed||this.drag||(this.drag=this._createDragData(e),this._emitter.emit(m.Start,e))}_move(e){this.drag&&(this._updateDragData(e),this._emitter.emit(m.Move,e))}_end(e){this.drag&&(this._updateDragData(e),this._emitter.emit(m.End,e),this._resetDragData())}_cancel(e){this.drag&&(this._updateDragData(e),this._emitter.emit(m.Cancel,e),this._resetDragData())}on(e,t,n){return this._emitter.on(e,t,n)}off(e,t){this._emitter.off(e,t)}cancel(){this.drag&&this._cancel({type:m.Cancel,x:this.drag.x,y:this.drag.y})}destroy(){this.isDestroyed||(this.isDestroyed=!0,this.cancel(),this._emitter.emit(m.Destroy,{type:m.Destroy}),this._emitter.off())}};import{AutoTicker as Lt}from"tikki";var y={read:Symbol(),write:Symbol()},S=new Lt({phases:[y.read,y.write]});function yn(r,e){S=r,Object.assign(y,e)}var de=class extends G{constructor(){super(),this.drag=null,this._direction={x:0,y:0},this._speed=0,this._tick=this._tick.bind(this)}_createDragData(e){return{...super._createDragData(e),time:0,deltaTime:0}}_start(e){this.isDestroyed||this.drag||(super._start(e),S.on(y.read,this._tick,this._tick))}_end(e){this.drag&&(S.off(y.read,this._tick),super._end(e))}_cancel(e){this.drag&&(S.off(y.read,this._tick),super._cancel(e))}_tick(e){if(this.drag)if(e&&this.drag.time){this.drag.deltaTime=e-this.drag.time,this.drag.time=e;let t={type:"tick",time:this.drag.time,deltaTime:this.drag.deltaTime};if(this._emitter.emit("tick",t),!this.drag)return;let n=this._speed*(this.drag.deltaTime/1e3),i=this._direction.x*n,o=this._direction.y*n;(i||o)&&this._move({type:m.Move,x:this.drag.x+i,y:this.drag.y+o})}else this.drag.time=e,this.drag.deltaTime=0}};import{Emitter as kt}from"eventti";function Me(r,e){if("pointerId"in r)return r.pointerId===e?r:null;if("changedTouches"in r){let t=0;for(;t<r.changedTouches.length;t++)if(r.changedTouches[t].identifier===e)return r.changedTouches[t];return null}return r}function tt(r){return"pointerType"in r?r.pointerType:"touches"in r?"touch":"mouse"}function nt(r){return"pointerId"in r?r.pointerId:"changedTouches"in r?r.changedTouches[0]?r.changedTouches[0].identifier:null:-1}function we(r={}){let{capture:e=!0,passive:t=!0}=r;return{capture:e,passive:t}}var Ie=typeof window<"u"&&typeof window.document<"u",rt=Ie&&"ontouchstart"in window,it=Ie&&!!window.PointerEvent,In=!!(Ie&&navigator.vendor&&navigator.vendor.indexOf("Apple")>-1&&navigator.userAgent&&navigator.userAgent.indexOf("CriOS")==-1&&navigator.userAgent.indexOf("FxiOS")==-1);function Ae(r){return r==="auto"||r===void 0?it?"pointer":rt?"touch":"mouse":r}var Kt={start:"pointerdown",move:"pointermove",cancel:"pointercancel",end:"pointerup"},Wt={start:"touchstart",move:"touchmove",cancel:"touchcancel",end:"touchend"},Vt={start:"mousedown",move:"mousemove",cancel:"",end:"mouseup"},U={pointer:Kt,touch:Wt,mouse:Vt},X=class{constructor(e,t={}){let{listenerOptions:n={},sourceEvents:i="auto",startPredicate:o=s=>!("button"in s&&s.button>0)}=t;this.element=e,this.drag=null,this.isDestroyed=!1,this._areWindowListenersBound=!1,this._startPredicate=o,this._listenerOptions=we(n),this._sourceEvents=Ae(i),this._emitter=new kt,this._onStart=this._onStart.bind(this),this._onMove=this._onMove.bind(this),this._onCancel=this._onCancel.bind(this),this._onEnd=this._onEnd.bind(this),e.addEventListener(U[this._sourceEvents].start,this._onStart,this._listenerOptions)}_getTrackedPointerEventData(e){return this.drag?Me(e,this.drag.pointerId):null}_onStart(e){if(this.isDestroyed||this.drag||!this._startPredicate(e))return;let t=nt(e);if(t===null)return;let n=Me(e,t);if(n===null)return;let i={pointerId:t,pointerType:tt(e),x:n.clientX,y:n.clientY};this.drag=i;let o={...i,type:m.Start,srcEvent:e,target:n.target};this._emitter.emit(o.type,o),this.drag&&this._bindWindowListeners()}_onMove(e){if(!this.drag)return;let t=this._getTrackedPointerEventData(e);if(!t)return;this.drag.x=t.clientX,this.drag.y=t.clientY;let n={type:m.Move,srcEvent:e,target:t.target,...this.drag};this._emitter.emit(n.type,n)}_onCancel(e){if(!this.drag)return;let t=this._getTrackedPointerEventData(e);if(!t)return;this.drag.x=t.clientX,this.drag.y=t.clientY;let n={type:m.Cancel,srcEvent:e,target:t.target,...this.drag};this._emitter.emit(n.type,n),this._resetDrag()}_onEnd(e){if(!this.drag)return;let t=this._getTrackedPointerEventData(e);if(!t)return;this.drag.x=t.clientX,this.drag.y=t.clientY;let n={type:m.End,srcEvent:e,target:t.target,...this.drag};this._emitter.emit(n.type,n),this._resetDrag()}_bindWindowListeners(){if(this._areWindowListenersBound)return;let{move:e,end:t,cancel:n}=U[this._sourceEvents];window.addEventListener(e,this._onMove,this._listenerOptions),window.addEventListener(t,this._onEnd,this._listenerOptions),n&&window.addEventListener(n,this._onCancel,this._listenerOptions),this._areWindowListenersBound=!0}_unbindWindowListeners(){if(this._areWindowListenersBound){let{move:e,end:t,cancel:n}=U[this._sourceEvents];window.removeEventListener(e,this._onMove,this._listenerOptions),window.removeEventListener(t,this._onEnd,this._listenerOptions),n&&window.removeEventListener(n,this._onCancel,this._listenerOptions),this._areWindowListenersBound=!1}}_resetDrag(){this.drag=null,this._unbindWindowListeners()}cancel(){if(!this.drag)return;let e={type:m.Cancel,srcEvent:null,target:null,...this.drag};this._emitter.emit(e.type,e),this._resetDrag()}updateSettings(e){if(this.isDestroyed)return;let{listenerOptions:t,sourceEvents:n,startPredicate:i}=e,o=Ae(n),s=we(t);i&&this._startPredicate!==i&&(this._startPredicate=i),(t&&(this._listenerOptions.capture!==s.capture||this._listenerOptions.passive===s.passive)||n&&this._sourceEvents!==o)&&(this.element.removeEventListener(U[this._sourceEvents].start,this._onStart,this._listenerOptions),this._unbindWindowListeners(),this.cancel(),n&&(this._sourceEvents=o),t&&s&&(this._listenerOptions=s),this.element.addEventListener(U[this._sourceEvents].start,this._onStart,this._listenerOptions))}on(e,t,n){return this._emitter.on(e,t,n)}off(e,t){this._emitter.off(e,t)}destroy(){this.isDestroyed||(this.isDestroyed=!0,this.cancel(),this._emitter.emit(m.Destroy,{type:m.Destroy}),this._emitter.off(),this.element.removeEventListener(U[this._sourceEvents].start,this._onStart,this._listenerOptions))}};var z={moveDistance:25,cancelOnBlur:!0,cancelOnVisibilityChange:!0,startPredicate:(r,e)=>{if(e.element&&(r.key==="Enter"||r.key===" ")&&document.activeElement===e.element){let{x:t,y:n}=e.element.getBoundingClientRect();return{x:t,y:n}}return null},movePredicate:(r,e)=>{if(!e.drag)return null;switch(r.key){case"ArrowLeft":return{x:e.drag.x-e.moveDistance.x,y:e.drag.y};case"ArrowRight":return{x:e.drag.x+e.moveDistance.x,y:e.drag.y};case"ArrowUp":return{x:e.drag.x,y:e.drag.y-e.moveDistance.y};case"ArrowDown":return{x:e.drag.x,y:e.drag.y+e.moveDistance.y};default:return null}},cancelPredicate:(r,e)=>{if(e.drag&&r.key==="Escape"){let{x:t,y:n}=e.drag;return{x:t,y:n}}return null},endPredicate:(r,e)=>{if(e.drag&&(r.key==="Enter"||r.key===" ")){let{x:t,y:n}=e.drag;return{x:t,y:n}}return null}},ot=class extends G{constructor(e,t={}){super();let{moveDistance:n=z.moveDistance,cancelOnBlur:i=z.cancelOnBlur,cancelOnVisibilityChange:o=z.cancelOnVisibilityChange,startPredicate:s=z.startPredicate,movePredicate:a=z.movePredicate,cancelPredicate:c=z.cancelPredicate,endPredicate:l=z.endPredicate}=t;this.element=e,this.moveDistance=typeof n=="number"?{x:n,y:n}:{...n},this._cancelOnBlur=i,this._cancelOnVisibilityChange=o,this._startPredicate=s,this._movePredicate=a,this._cancelPredicate=c,this._endPredicate=l,this._onKeyDown=this._onKeyDown.bind(this),this._internalCancel=this._internalCancel.bind(this),this._blurCancelHandler=this._blurCancelHandler.bind(this),document.addEventListener("keydown",this._onKeyDown),i&&e?.addEventListener("blur",this._blurCancelHandler),o&&document.addEventListener("visibilitychange",this._internalCancel)}_internalCancel(){this.cancel()}_blurCancelHandler(){queueMicrotask(()=>{document.activeElement!==this.element&&this.cancel()})}_onKeyDown(e){if(!this.drag){let o=this._startPredicate(e,this);o&&(e.preventDefault(),this._start({type:m.Start,x:o.x,y:o.y,srcEvent:e}));return}let t=this._cancelPredicate(e,this);if(t){e.preventDefault(),this._cancel({type:m.Cancel,x:t.x,y:t.y,srcEvent:e});return}let n=this._endPredicate(e,this);if(n){e.preventDefault(),this._end({type:m.End,x:n.x,y:n.y,srcEvent:e});return}let i=this._movePredicate(e,this);if(i){e.preventDefault(),this._move({type:m.Move,x:i.x,y:i.y,srcEvent:e});return}}updateSettings(e={}){let{moveDistance:t,cancelOnBlur:n,cancelOnVisibilityChange:i,startPredicate:o,movePredicate:s,cancelPredicate:a,endPredicate:c}=e;t!==void 0&&(typeof t=="number"?this.moveDistance.x=this.moveDistance.y=t:(this.moveDistance.x=t.x,this.moveDistance.y=t.y)),n!==void 0&&this._cancelOnBlur!==n&&(this._cancelOnBlur=n,n?this.element?.addEventListener("blur",this._blurCancelHandler):this.element?.removeEventListener("blur",this._blurCancelHandler)),i!==void 0&&this._cancelOnVisibilityChange!==i&&(this._cancelOnVisibilityChange=i,i?document.addEventListener("visibilitychange",this._internalCancel):document.removeEventListener("visibilitychange",this._internalCancel)),o&&(this._startPredicate=o),s&&(this._movePredicate=s),a&&(this._cancelPredicate=a),c&&(this._endPredicate=c)}destroy(){this.isDestroyed||(super.destroy(),document.removeEventListener("keydown",this._onKeyDown),this._cancelOnBlur&&this.element?.removeEventListener("blur",this._blurCancelHandler),this._cancelOnVisibilityChange&&document.removeEventListener("visibilitychange",this._internalCancel))}};var Xt=["start","cancel","end","moveLeft","moveRight","moveUp","moveDown"];function he(r,e){if(!r.size||!e.size)return 1/0;let t=1/0;for(let n of r){let i=e.get(n);i!==void 0&&i<t&&(t=i)}return t}var w={startKeys:[" ","Enter"],moveLeftKeys:["ArrowLeft"],moveRightKeys:["ArrowRight"],moveUpKeys:["ArrowUp"],moveDownKeys:["ArrowDown"],cancelKeys:["Escape"],endKeys:[" ","Enter"],cancelOnBlur:!0,cancelOnVisibilityChange:!0,computeSpeed:()=>500,startPredicate:(r,e)=>{if(e.element&&document.activeElement===e.element){let{left:t,top:n}=e.element.getBoundingClientRect();return{x:t,y:n}}return null}},st=class extends de{constructor(e,t={}){super();let{startPredicate:n=w.startPredicate,computeSpeed:i=w.computeSpeed,cancelOnVisibilityChange:o=w.cancelOnVisibilityChange,cancelOnBlur:s=w.cancelOnBlur,startKeys:a=w.startKeys,moveLeftKeys:c=w.moveLeftKeys,moveRightKeys:l=w.moveRightKeys,moveUpKeys:d=w.moveUpKeys,moveDownKeys:h=w.moveDownKeys,cancelKeys:f=w.cancelKeys,endKeys:p=w.endKeys}=t;this.element=e,this._startKeys=new Set(a),this._cancelKeys=new Set(f),this._endKeys=new Set(p),this._moveLeftKeys=new Set(c),this._moveRightKeys=new Set(l),this._moveUpKeys=new Set(d),this._moveDownKeys=new Set(h),this._moveKeys=new Set([...c,...l,...d,...h]),this._moveKeyTimestamps=new Map,this._cancelOnBlur=s,this._cancelOnVisibilityChange=o,this._computeSpeed=i,this._startPredicate=n,this._onKeyDown=this._onKeyDown.bind(this),this._onKeyUp=this._onKeyUp.bind(this),this._onTick=this._onTick.bind(this),this._internalCancel=this._internalCancel.bind(this),this._blurCancelHandler=this._blurCancelHandler.bind(this),this.on("tick",this._onTick,this._onTick),document.addEventListener("keydown",this._onKeyDown),document.addEventListener("keyup",this._onKeyUp),s&&e?.addEventListener("blur",this._blurCancelHandler),o&&document.addEventListener("visibilitychange",this._internalCancel)}_end(e){this.drag&&(this._moveKeyTimestamps.clear(),this._direction.x=0,this._direction.y=0,super._end(e))}_cancel(e){this.drag&&(this._moveKeyTimestamps.clear(),this._direction.x=0,this._direction.y=0,super._cancel(e))}_internalCancel(){this.cancel()}_blurCancelHandler(){queueMicrotask(()=>{document.activeElement!==this.element&&this.cancel()})}_updateDirection(){let e=he(this._moveLeftKeys,this._moveKeyTimestamps),t=he(this._moveRightKeys,this._moveKeyTimestamps),n=he(this._moveUpKeys,this._moveKeyTimestamps),i=he(this._moveDownKeys,this._moveKeyTimestamps),o=e===t?0:e<t?-1:1,s=n===i?0:n<i?-1:1;if(!(o===0||s===0)){let a=1/(Math.sqrt(o*o+s*s)||1);o*=a,s*=a}this._direction.x=o,this._direction.y=s}_onTick(){this._speed=this._computeSpeed(this)}_onKeyUp(e){this._moveKeyTimestamps.get(e.key)&&(this._moveKeyTimestamps.delete(e.key),this._updateDirection())}_onKeyDown(e){if(!this.drag){if(this._startKeys.has(e.key)){let t=this._startPredicate(e,this);t&&(e.preventDefault(),this._start({type:m.Start,x:t.x,y:t.y}))}return}if(this._cancelKeys.has(e.key)){e.preventDefault(),this._internalCancel();return}if(this._endKeys.has(e.key)){e.preventDefault(),this._end({type:m.End,x:this.drag.x,y:this.drag.y});return}if(this._moveKeys.has(e.key)){e.preventDefault(),this._moveKeyTimestamps.get(e.key)||(this._moveKeyTimestamps.set(e.key,Date.now()),this._updateDirection());return}}updateSettings(e={}){let t=!1,{cancelOnBlur:n,cancelOnVisibilityChange:i,startPredicate:o,computeSpeed:s}=e;if(n!==void 0&&this._cancelOnBlur!==n&&(this._cancelOnBlur=n,n?this.element?.addEventListener("blur",this._blurCancelHandler):this.element?.removeEventListener("blur",this._blurCancelHandler)),i!==void 0&&this._cancelOnVisibilityChange!==i&&(this._cancelOnVisibilityChange=i,i?document.addEventListener("visibilitychange",this._internalCancel):document.removeEventListener("visibilitychange",this._internalCancel)),o!==void 0&&(this._startPredicate=o),s!==void 0&&(this._computeSpeed=s),Xt.forEach((a,c)=>{let l=`${a}Keys`,d=e[l];d!==void 0&&(this[`_${l}`]=new Set(d),c>=3&&(t=!0))}),t){let a=[...this._moveLeftKeys,...this._moveRightKeys,...this._moveUpKeys,...this._moveDownKeys];[...this._moveKeys].every((l,d)=>a[d]===l)||(this._moveKeys=new Set(a),this._moveKeyTimestamps.clear(),this._updateDirection())}}destroy(){this.isDestroyed||(super.destroy(),this.off("tick",this._onTick),document.removeEventListener("keydown",this._onKeyDown),document.removeEventListener("keyup",this._onKeyUp),this._cancelOnBlur&&this.element?.removeEventListener("blur",this._blurCancelHandler),this._cancelOnVisibilityChange&&document.removeEventListener("visibilitychange",this._internalCancel))}};import{Emitter as Yt}from"eventti";var te=class{constructor(){this.cache=new Map;this.validation=new Map;this.cache=new Map,this.validation=new Map}set(e,t){this.cache.set(e,t),this.validation.set(e,void 0)}get(e){return this.cache.get(e)}has(e){return this.cache.has(e)}delete(e){this.cache.delete(e),this.validation.delete(e)}isValid(e){return this.validation.has(e)}invalidate(e){e===void 0?this.validation.clear():this.validation.delete(e)}clear(){this.cache.clear(),this.validation.clear()}};var pe=class{constructor(e,t){this.sensor=e,this.startEvent=t,this.prevMoveEvent=t,this.moveEvent=t,this.endEvent=null,this.items=[],this.isEnded=!1,this._matrixCache=new te,this._clientOffsetCache=new te}};import{getOffsetContainer as ft}from"mezr";var at=new WeakMap;function T(r){let e=at.get(r)?.deref();return e||(e=window.getComputedStyle(r,null),at.set(r,new WeakRef(e))),e}function B(r,e={x:0,y:0}){if(e.x=0,e.y=0,r instanceof Window)return e;if(r instanceof Document)return e.x=window.scrollX*-1,e.y=window.scrollY*-1,e;let{x:t,y:n}=r.getBoundingClientRect(),i=T(r);return e.x=t+(parseFloat(i.borderLeftWidth)||0),e.y=n+(parseFloat(i.borderTopWidth)||0),e}function Oe(r){return typeof r=="object"&&r!==null&&"x"in r&&"y"in r}var qt={x:0,y:0},zt={x:0,y:0};function lt(r,e,t={x:0,y:0}){let n=Oe(r)?r:B(r,qt),i=Oe(e)?e:B(e,zt);return t.x=i.x-n.x,t.y=i.y-n.y,t}function ct(r){let e=T(r),t=parseFloat(e.height)||0;return e.boxSizing==="border-box"||(t+=parseFloat(e.borderTopWidth)||0,t+=parseFloat(e.borderBottomWidth)||0,t+=parseFloat(e.paddingTop)||0,t+=parseFloat(e.paddingBottom)||0,r instanceof HTMLElement&&(t+=r.offsetHeight-r.clientHeight)),t}function dt(r){let e=T(r),t=parseFloat(e.width)||0;return e.boxSizing==="border-box"||(t+=parseFloat(e.borderLeftWidth)||0,t+=parseFloat(e.borderRightWidth)||0,t+=parseFloat(e.paddingLeft)||0,t+=parseFloat(e.paddingRight)||0,r instanceof HTMLElement&&(t+=r.offsetWidth-r.clientWidth)),t}function me(r,e=!1){let{translate:t,rotate:n,scale:i,transform:o}=T(r),s="";if(t&&t!=="none"){let[a="0px",c="0px",l]=t.split(" ");a.includes("%")&&(a=`${parseFloat(a)/100*dt(r)}px`),c.includes("%")&&(c=`${parseFloat(c)/100*ct(r)}px`),l?s+=`translate3d(${a},${c},${l})`:s+=`translate(${a},${c})`}if(n&&n!=="none"){let a=n.split(" ");a.length>1?s+=`rotate3d(${a.join(",")})`:s+=`rotate(${a.join(",")})`}if(i&&i!=="none"){let a=i.split(" ");a.length===3?s+=`scale3d(${a.join(",")})`:s+=`scale(${a.join(",")})`}return!e&&o&&o!=="none"&&(s+=o),s}function fe(r){let e=r.split(" "),t="",n="",i="";return e.length===1?t=n=e[0]:e.length===2?[t,n]=e:[t,n,i]=e,{x:parseFloat(t)||0,y:parseFloat(n)||0,z:parseFloat(i)||0}}var Bt="scale(1, 1)";function F(r){return r.setMatrixValue(Bt)}var Y=new DOMMatrix;function ht(r,e=new DOMMatrix){let t=r;for(F(e);t;){let n=me(t);if(n&&(Y.setMatrixValue(n),!Y.isIdentity)){let{transformOrigin:i}=T(t),{x:o,y:s,z:a}=fe(i);a===0?Y.setMatrixValue(`translate(${o}px,${s}px) ${Y} translate(${o*-1}px,${s*-1}px)`):Y.setMatrixValue(`translate3d(${o}px,${s}px,${a}px) ${Y} translate3d(${o*-1}px,${s*-1}px,${a*-1}px)`),e.preMultiplySelf(Y)}t=t.parentElement}return e}function pt(r,e,t=!1){let{style:n}=r;for(let i in e)n.setProperty(i,e[i],t?"important":"")}function mt(){let r=document.createElement("div");return r.classList.add("dragdoll-measure"),pt(r,{display:"block",position:"absolute",inset:"0px",padding:"0px",margin:"0px",border:"none",opacity:"0",transform:"none","transform-origin":"0 0",transition:"none",animation:"none","pointer-events":"none"},!0),r}function ne(r){return r.m11!==1||r.m12!==0||r.m13!==0||r.m14!==0||r.m21!==0||r.m22!==1||r.m23!==0||r.m24!==0||r.m31!==0||r.m32!==0||r.m33!==1||r.m34!==0||r.m43!==0||r.m44!==1}var ue=mt(),ge=class{constructor(e,t){if(!e.isConnected)throw new Error("Element is not connected");let{drag:n}=t;if(!n)throw new Error("Drag is not defined");let i=T(e),o=e.getBoundingClientRect(),s=me(e,!0);this.data={},this.element=e,this.elementTransformOrigin=fe(i.transformOrigin),this.elementTransformMatrix=new DOMMatrix().setMatrixValue(s+i.transform),this.elementOffsetMatrix=new DOMMatrix(s).invertSelf(),this.frozenStyles=null,this.unfrozenStyles=null,this.position={x:0,y:0},this.containerOffset={x:0,y:0},this.alignmentOffset={x:0,y:0},this._moveDiff={x:0,y:0},this._alignDiff={x:0,y:0},this._matrixCache=n._matrixCache,this._clientOffsetCache=n._clientOffsetCache;let a=e.parentElement;if(!a)throw new Error("Dragged element does not have a parent element.");this.elementContainer=a;let c=t.settings.container||a;if(this.dragContainer=c,a!==c){let{position:f}=i;if(f!=="fixed"&&f!=="absolute")throw new Error(`Dragged element has "${f}" position, but only "fixed" or "absolute" are allowed when using a custom drag container.`)}let l=ft(e)||e;this.elementOffsetContainer=l;let d=c===a?l:ft(e,{container:c});this.dragOffsetContainer=d;{let{width:f,height:p,x:_,y:D}=o;this.clientRect={width:f,height:p,x:_,y:D}}this._updateContainerMatrices(),this._updateContainerOffset();let h=t.settings.frozenStyles({draggable:t,drag:n,item:this,style:i});if(Array.isArray(h))if(h.length){let f={};for(let p of h)f[p]=i[p];this.frozenStyles=f}else this.frozenStyles=null;else this.frozenStyles=h;if(this.frozenStyles){let f={};for(let p in this.frozenStyles)this.frozenStyles.hasOwnProperty(p)&&(f[p]=e.style[p]);this.unfrozenStyles=f}}_updateContainerMatrices(){[this.elementContainer,this.dragContainer].forEach(e=>{if(!this._matrixCache.isValid(e)){let t=this._matrixCache.get(e)||[new DOMMatrix,new DOMMatrix],[n,i]=t;ht(e,n),i.setMatrixValue(n.toString()).invertSelf(),this._matrixCache.set(e,t)}})}_updateContainerOffset(){let{elementOffsetContainer:e,elementContainer:t,dragOffsetContainer:n,dragContainer:i,containerOffset:o,_clientOffsetCache:s,_matrixCache:a}=this;if(e!==n){let[c,l]=[[i,n],[t,e]].map(([d,h])=>{let f=s.get(h)||{x:0,y:0};if(!s.isValid(h)){let p=a.get(d);h instanceof HTMLElement&&p&&!p[0].isIdentity?ne(p[0])?(ue.style.setProperty("transform",p[1].toString(),"important"),h.append(ue),B(ue,f),ue.remove()):(B(h,f),f.x-=p[0].m41,f.y-=p[0].m42):B(h,f)}return s.set(h,f),f});lt(c,l,o)}else o.x=0,o.y=0}getContainerMatrix(){return this._matrixCache.get(this.elementContainer)}getDragContainerMatrix(){return this._matrixCache.get(this.dragContainer)}updateSize(e){if(e)this.clientRect.width=e.width,this.clientRect.height=e.height;else{let{width:t,height:n}=this.element.getBoundingClientRect();this.clientRect.width=t,this.clientRect.height=n}}};function Re(r,e,t){let n=document.activeElement,i=r.contains(n);t&&t.append(r),e.append(t||r),i&&document.activeElement!==n&&n.focus({preventScroll:!0})}function re(r,e=0){let t=Math.pow(10,e);return Math.round((r+Number.EPSILON)*t)/t}function ut(r,e){return r.isIdentity&&e.isIdentity?!0:r.is2D&&e.is2D?r.a===e.a&&r.b===e.b&&r.c===e.c&&r.d===e.d&&r.e===e.e&&r.f===e.f:r.m11===e.m11&&r.m12===e.m12&&r.m13===e.m13&&r.m14===e.m14&&r.m21===e.m21&&r.m22===e.m22&&r.m23===e.m23&&r.m24===e.m24&&r.m31===e.m31&&r.m32===e.m32&&r.m33===e.m33&&r.m34===e.m34&&r.m41===e.m41&&r.m42===e.m42&&r.m43===e.m43&&r.m44===e.m44}var Ht=0,gt={capture:!0,passive:!0},Nt={x:0,y:0},I=new DOMMatrix,ye=new DOMMatrix;var Le={Start:"start",Move:"move",End:"end"},q={Start:"start",StartAlign:"start-align",Move:"move",Align:"align",End:"end",EndAlign:"end-align"},v={PrepareStart:"preparestart",Start:"start",PrepareMove:"preparemove",Move:"move",End:"end",Destroy:"destroy"},Gt={container:null,startPredicate:()=>!0,elements:()=>null,frozenStyles:()=>null,applyPosition:({item:r,phase:e})=>{let t=e===q.End||e===q.EndAlign,[n,i]=r.getContainerMatrix(),[o,s]=r.getDragContainerMatrix(),{position:a,alignmentOffset:c,containerOffset:l,elementTransformMatrix:d,elementTransformOrigin:h,elementOffsetMatrix:f}=r,{x:p,y:_,z:D}=h,x=!d.isIdentity&&(p!==0||_!==0||D!==0),b=a.x+c.x+l.x,C=a.y+c.y+l.y;F(I),x&&(D===0?I.translateSelf(-p,-_):I.translateSelf(-p,-_,-D)),t?i.isIdentity||I.multiplySelf(i):s.isIdentity||I.multiplySelf(s),F(ye).translateSelf(b,C),I.multiplySelf(ye),n.isIdentity||I.multiplySelf(n),x&&(F(ye).translateSelf(p,_,D),I.multiplySelf(ye)),d.isIdentity||I.multiplySelf(d),f.isIdentity||I.preMultiplySelf(f),r.element.style.transform=`${I}`},computeClientRect:({drag:r})=>r.items[0].clientRect||null,positionModifiers:[],group:null},yt=class{constructor(e,t={}){this.id=Ht++,this.sensors=e,this.settings=this._parseSettings(t),this.plugins={},this.drag=null,this.isDestroyed=!1,this._sensorData=new Map,this._emitter=new Yt,this._startPhase=0,this._startId=Symbol(),this._moveId=Symbol(),this._alignId=Symbol(),this._onMove=this._onMove.bind(this),this._onScroll=this._onScroll.bind(this),this._onEnd=this._onEnd.bind(this),this._prepareStart=this._prepareStart.bind(this),this._applyStart=this._applyStart.bind(this),this._prepareMove=this._prepareMove.bind(this),this._applyMove=this._applyMove.bind(this),this._prepareAlign=this._prepareAlign.bind(this),this._applyAlign=this._applyAlign.bind(this),this.sensors.forEach(n=>{this._sensorData.set(n,{predicateState:0,predicateEvent:null,onMove:s=>this._onMove(s,n),onEnd:s=>this._onEnd(s,n)});let{onMove:i,onEnd:o}=this._sensorData.get(n);n.on(m.Start,i,i),n.on(m.Move,i,i),n.on(m.Cancel,o,o),n.on(m.End,o,o),n.on(m.Destroy,o,o)})}_parseSettings(e,t=Gt){let{container:n=t.container,startPredicate:i=t.startPredicate,elements:o=t.elements,frozenStyles:s=t.frozenStyles,positionModifiers:a=t.positionModifiers,applyPosition:c=t.applyPosition,computeClientRect:l=t.computeClientRect,group:d=t.group,onPrepareStart:h=t.onPrepareStart,onStart:f=t.onStart,onPrepareMove:p=t.onPrepareMove,onMove:_=t.onMove,onEnd:D=t.onEnd,onDestroy:x=t.onDestroy}=e||{};return{container:n,startPredicate:i,elements:o,frozenStyles:s,positionModifiers:a,applyPosition:c,computeClientRect:l,group:d,onPrepareStart:h,onStart:f,onPrepareMove:p,onMove:_,onEnd:D,onDestroy:x}}_emit(e,...t){this._emitter.emit(e,...t)}_onMove(e,t){let n=this._sensorData.get(t);if(n)switch(n.predicateState){case 0:{n.predicateEvent=e;let i=this.settings.startPredicate({draggable:this,sensor:t,event:e});i===!0?this.resolveStartPredicate(t):i===!1&&this.rejectStartPredicate(t);break}case 1:{this.drag&&(this.drag.moveEvent=e,S.once(y.read,this._prepareMove,this._moveId),S.once(y.write,this._applyMove,this._moveId));break}}}_onScroll(){this.align()}_onEnd(e,t){let n=this._sensorData.get(t);n&&(this.drag?n.predicateState===1&&(this.drag.endEvent=e,this._sensorData.forEach(i=>{i.predicateState=0,i.predicateEvent=null}),this.stop()):(n.predicateState=0,n.predicateEvent=null))}_prepareStart(){let e=this.drag;if(!e)return;this._startPhase=2;let t=this.settings.elements({draggable:this,drag:e})||[];e.items=t.map(n=>new ge(n,this)),this._applyModifiers(Le.Start,0,0),this._emit(v.PrepareStart,e.startEvent),this.settings.onPrepareStart?.(e,this),this._startPhase=3}_applyStart(){let e=this.drag;if(e){this._startPhase=4;for(let t of e.items)t.dragContainer!==t.elementContainer&&Re(t.element,t.dragContainer),t.frozenStyles&&Object.assign(t.element.style,t.frozenStyles),this.settings.applyPosition({phase:q.Start,draggable:this,drag:e,item:t});for(let t of e.items){let n=t.getContainerMatrix()[0],i=t.getDragContainerMatrix()[0];if(ut(n,i)||!ne(n)&&!ne(i))continue;let o=t.element.getBoundingClientRect(),{alignmentOffset:s}=t;s.x+=re(t.clientRect.x-o.x,3),s.y+=re(t.clientRect.y-o.y,3)}for(let t of e.items){let{alignmentOffset:n}=t;(n.x!==0||n.y!==0)&&this.settings.applyPosition({phase:q.StartAlign,draggable:this,drag:e,item:t})}window.addEventListener("scroll",this._onScroll,gt),this._emit(v.Start,e.startEvent),this.settings.onStart?.(e,this),this._startPhase=5}}_prepareMove(){let e=this.drag;if(!e)return;let{moveEvent:t,prevMoveEvent:n}=e;t!==n&&(this._applyModifiers(Le.Move,t.x-n.x,t.y-n.y),this._emit(v.PrepareMove,t),!e.isEnded&&(this.settings.onPrepareMove?.(e,this),!e.isEnded&&(e.prevMoveEvent=t)))}_applyMove(){let e=this.drag;if(e){for(let t of e.items)t._moveDiff.x=0,t._moveDiff.y=0,this.settings.applyPosition({phase:q.Move,draggable:this,drag:e,item:t});this._emit(v.Move,e.moveEvent),!e.isEnded&&this.settings.onMove?.(e,this)}}_prepareAlign(){let{drag:e}=this;if(e)for(let t of e.items){let{x:n,y:i}=t.element.getBoundingClientRect(),o=t.clientRect.x-t._moveDiff.x-n;t.alignmentOffset.x=t.alignmentOffset.x-t._alignDiff.x+o,t._alignDiff.x=o;let s=t.clientRect.y-t._moveDiff.y-i;t.alignmentOffset.y=t.alignmentOffset.y-t._alignDiff.y+s,t._alignDiff.y=s}}_applyAlign(){let{drag:e}=this;if(e)for(let t of e.items)t._alignDiff.x=0,t._alignDiff.y=0,this.settings.applyPosition({phase:q.Align,draggable:this,drag:e,item:t})}_applyModifiers(e,t,n){let{drag:i}=this;if(!i)return;let{positionModifiers:o}=this.settings;for(let s of i.items){let a=Nt;a.x=t,a.y=n;for(let c of o)a=c(a,{draggable:this,drag:i,item:s,phase:e});s.position.x+=a.x,s.position.y+=a.y,s.clientRect.x+=a.x,s.clientRect.y+=a.y,e==="move"&&(s._moveDiff.x+=a.x,s._moveDiff.y+=a.y)}}on(e,t,n){return this._emitter.on(e,t,n)}off(e,t){this._emitter.off(e,t)}resolveStartPredicate(e,t){let n=this._sensorData.get(e);if(!n)return;let i=t||n.predicateEvent;n.predicateState===0&&i&&(this._startPhase=1,n.predicateState=1,n.predicateEvent=null,this.drag=new pe(e,i),this._sensorData.forEach((o,s)=>{s!==e&&(o.predicateState=2,o.predicateEvent=null)}),S.once(y.read,this._prepareStart,this._startId),S.once(y.write,this._applyStart,this._startId))}rejectStartPredicate(e){let t=this._sensorData.get(e);t?.predicateState===0&&(t.predicateState=2,t.predicateEvent=null)}stop(){let e=this.drag;if(!e||e.isEnded)return;let t=this._startPhase;if(t===2||t===4)throw new Error("Cannot stop drag start process at this point");if(this._startPhase=0,e.isEnded=!0,S.off(y.read,this._startId),S.off(y.write,this._startId),S.off(y.read,this._moveId),S.off(y.write,this._moveId),S.off(y.read,this._alignId),S.off(y.write,this._alignId),window.removeEventListener("scroll",this._onScroll,gt),t>1&&this._applyModifiers(Le.End,0,0),t===5){for(let n of e.items){if(n.elementContainer!==n.dragContainer&&(Re(n.element,n.elementContainer),n.alignmentOffset.x=0,n.alignmentOffset.y=0,n.containerOffset.x=0,n.containerOffset.y=0),n.unfrozenStyles)for(let i in n.unfrozenStyles)n.element.style[i]=n.unfrozenStyles[i]||"";this.settings.applyPosition({phase:q.End,draggable:this,drag:e,item:n})}for(let n of e.items)if(n.elementContainer!==n.dragContainer){let i=n.element.getBoundingClientRect();n.alignmentOffset.x=re(n.clientRect.x-i.x,3),n.alignmentOffset.y=re(n.clientRect.y-i.y,3)}for(let n of e.items)n.elementContainer!==n.dragContainer&&(n.alignmentOffset.x!==0||n.alignmentOffset.y!==0)&&this.settings.applyPosition({phase:q.EndAlign,draggable:this,drag:e,item:n})}else if(t===3)for(let n of e.items)n.clientRect.x-=n.position.x,n.clientRect.y-=n.position.y,n.position.x=0,n.position.y=0,n.elementContainer!==n.dragContainer&&(n.alignmentOffset.x=0,n.alignmentOffset.y=0,n.containerOffset.x=0,n.containerOffset.y=0);this._emit(v.End,e.endEvent),this.settings.onEnd?.(e,this),this.drag=null}align(e=!1){this.drag&&(e?(this._prepareAlign(),this._applyAlign()):(S.once(y.read,this._prepareAlign,this._alignId),S.once(y.write,this._applyAlign,this._alignId)))}getClientRect(){let{drag:e,settings:t}=this;return e&&t.computeClientRect?.({draggable:this,drag:e})||null}updateSettings(e={}){this.settings=this._parseSettings(e,this.settings)}use(e){return e(this)}destroy(){this.isDestroyed||(this.isDestroyed=!0,this.stop(),this._sensorData.forEach(({onMove:e,onEnd:t},n)=>{n.off(m.Start,e),n.off(m.Move,e),n.off(m.Cancel,t),n.off(m.End,t),n.off(m.Destroy,t)}),this._sensorData.clear(),this._emit(v.Destroy),this.settings.onDestroy?.(this),this._emitter.off())}};var St=new Set(["auto","scroll","overlay"]);function Se(r){let e=T(r);return!!(St.has(e.overflowY)||St.has(e.overflowX))}function _t(r){return r instanceof Document}function Et(r,e=[]){let t=r?.parentNode;for(;t&&!_t(t);)t instanceof Element?(Se(t)&&e.push(t),t=t.parentNode):t instanceof ShadowRoot?t=t.host:t=t.parentNode;return e.push(window),e}function Ut(r){let e=[];return Se(r)&&e.push(r),Et(r,e),e}function Ci(r={}){let e,t=0,n=null,i,{touchTimeout:o=250,fallback:s=()=>!0}=r,a=d=>d.preventDefault(),c=d=>{if(t){if(e){d.cancelable&&d.preventDefault();return}e===void 0&&(d.cancelable&&d.timeStamp-t>o?(e=!0,d.preventDefault()):e=!1)}};return d=>{if(!(d.sensor instanceof X))return s(d);let{draggable:h,sensor:f,event:p}=d,_=p;if(_.pointerType==="touch"){if(_.type===m.Start&&(_.srcEvent.type==="pointerdown"||_.srcEvent.type==="touchstart")){n=_.target;let D=n?Ut(n):[];D.forEach(b=>{b.addEventListener("touchmove",c,{passive:!1,capture:!0})});let x=()=>{t&&(h.off(v.End,x),h.sensors.forEach(b=>{b instanceof X&&b.off(m.End,x)}),n?.removeEventListener("contextmenu",a),D.forEach(b=>{b.removeEventListener("touchmove",c,{capture:!0})}),t=0,e=void 0,n=null,i=void window.clearTimeout(i))};e=void 0,t=_.srcEvent.timeStamp,n?.addEventListener("contextmenu",a),h.on(v.End,x),h.sensors.forEach(b=>{b instanceof X&&b.on(m.End,x)}),o>0&&(i=window.setTimeout(()=>{h.resolveStartPredicate(f),e=!0,i=void 0},o))}return e}return _.type===m.Start&&!_.srcEvent.button}}function Ft(r,e){return Math.round(r/e)*e}function vt(r,e,t){let n=t-e,i=Math.abs(n);if(i>=r){let o=i%r;return Ft(n>0?n-o:n+o,r)}return 0}function Mi(r,e){return function(n,{item:i}){let o=i.data.__snap__||(i.data.__snap__={snapX:0,snapY:0,sensorX:0,sensorY:0});o.sensorX+=n.x,o.sensorY+=n.y;let s=vt(r,o.snapX,o.sensorX),a=vt(e,o.snapY,o.sensorY);return o.snapX+=s,o.snapY+=a,n.x=s,n.y=a,n}}function A(r,e={width:0,height:0,x:0,y:0,left:0,top:0,right:0,bottom:0}){return r&&(e.width=r.width,e.height=r.height,e.x=r.x,e.y=r.y,e.left=r.x,e.top=r.y,e.right=r.x+r.width,e.bottom=r.y+r.height),e}var jt=A(),$t=A(),j={change:0,drift:0};function bt(r,e,t,n,i,o,s){let a=o,c=i;if(o>0){if(a=Math.min(Math.max(n-e,0),o),s)if(i<0){let l=Math.min(-i,o);c=i+l,a=Math.max(0,a-l)}else c=i+(o-a)}else if(o<0&&(a=Math.max(Math.min(t-r,0),o),s))if(i>0){let l=Math.max(-i,o);c=i+l,a=Math.min(0,a-l)}else c=i+(o-a);j.change=a,j.drift=c}function Ri(r,e=({drag:t})=>t.sensor instanceof X){return function(n,i){let o=A(r(i),jt),s=A(i.item.clientRect,$t),a=i.item.data,c=a.__containment__||{drift:{x:0,y:0},trackDrift:!1};a.__containment__||(c.trackDrift=typeof e=="function"?e(i):e,a.__containment__=c);let{drift:l,trackDrift:d}=c;return n.x&&(bt(s.left,s.right,o.left,o.right,l.x,n.x,d),l.x=j.drift,n.x=j.change),n.y&&(bt(s.top,s.bottom,o.top,o.bottom,l.y,n.y,d),l.y=j.drift,n.y=j.change),n}}var ie=class{constructor(e,{batchSize:t=100,minBatchCount:n=0,maxBatchCount:i=Number.MAX_SAFE_INTEGER,initialBatchCount:o=0,shrinkThreshold:s=2,getItem:a=(l,...d)=>l,onRelease:c}={}){this._batchSize=Math.floor(Math.max(t,1)),this._minSize=Math.floor(Math.max(n,0))*this._batchSize,this._maxSize=Math.floor(Math.min(Math.max(i*this._batchSize,this._batchSize),Number.MAX_SAFE_INTEGER)),this._shrinkThreshold=Math.floor(Math.max(s,1)*this._batchSize),this._data=new Array(Math.floor(Math.max(Math.max(o,n)*this._batchSize,0))),this._index=0,this._createItem=e,this._getItem=a,this._onRelease=c}get(...e){if(this._index>0)return this._getItem(this._data[--this._index],...e);if(this._index===0){let t=this._data.length,n=Math.min(this._batchSize,this._maxSize-t);n>0&&(this._data.length=t+n)}return this._createItem(...e)}release(e){if(this._index<this._maxSize&&(this._onRelease&&this._onRelease(e),this._data[this._index++]=e,this._index>=this._shrinkThreshold)){let t=this._data.length-this._batchSize;t>=this._minSize&&(this._data.length=t,this._index-=this._batchSize)}}destroy(){this._data.length=0,this._index=0}};import{getDistance as Zt}from"mezr";var Jt=A(),Qt=A();function Dt(r,e){return Zt(A(r,Jt),A(e,Qt))}function xt(r,e,t={width:0,height:0,x:0,y:0}){let n=Math.max(r.x,e.x),i=Math.min(r.x+r.width,e.x+e.width);if(i<=n)return null;let o=Math.max(r.y,e.y),s=Math.min(r.y+r.height,e.y+e.height);return s<=o?null:(t.x=n,t.y=o,t.width=i-n,t.height=s-o,t)}function Tt(r,e){let t=xt(r,e);return t?t.width*t.height:0}function oe(r,e){let t=Tt(r,e);if(!t)return 0;let n=Math.min(r.width,e.width)*Math.min(r.height,e.height);return t/n*100}import{getRect as en}from"mezr";function ke(...r){let{width:e,height:t,left:n,top:i}=en(...r);return{width:e,height:t,x:n,y:i}}function O(r){return r instanceof Window}function Ke(r){return O(r)||r===document.documentElement||r===document.body?window:r}function $(r){return O(r)?r.scrollX:r.scrollLeft}function We(r){return O(r)&&(r=document.documentElement),r.scrollWidth-r.clientWidth}function Z(r){return O(r)?r.scrollY:r.scrollTop}function Ve(r){return O(r)&&(r=document.documentElement),r.scrollHeight-r.clientHeight}function Xe(r,e){return!(r.x+r.width<=e.x||e.x+e.width<=r.x||r.y+r.height<=e.y||e.y+e.height<=r.y)}var Ct={width:0,height:0,x:0,y:0},Pt=50,R={direction:"none",threshold:0,distance:0,value:0,maxValue:0,duration:0,speed:0,deltaTime:0,isEnding:!1},u={x:1,y:2},H={forward:4,reverse:8},_e={none:0,left:u.x|H.reverse,right:u.x|H.forward},se={none:0,up:u.y|H.reverse,down:u.y|H.forward},E={..._e,...se};function qe(r){switch(r){case _e.none:case se.none:return"none";case _e.left:return"left";case _e.right:return"right";case se.up:return"up";case se.down:return"down";default:throw new Error(`Unknown direction value: ${r}`)}}function Mt(r,e,t){let{left:n=0,right:i=0,top:o=0,bottom:s=0}=e;return n=Math.max(0,n),i=Math.max(0,i),o=Math.max(0,o),s=Math.max(0,s),t.width=r.width+n+i,t.height=r.height+o+s,t.x=r.x-n,t.y=r.y-o,t}function Ee(r,e){return Math.ceil(r)>=Math.floor(e)}function ze(r,e){return Math.min(e/2,r)}function Be(r,e,t,n){return Math.max(0,t+r*2+n*e-n)/2}var Ye=class{constructor(){this.positionX=0,this.positionY=0,this.directionX=E.none,this.directionY=E.none,this.overlapCheckRequestTime=0}},He=class{constructor(){this.element=null,this.requestX=null,this.requestY=null,this.scrollLeft=0,this.scrollTop=0}reset(){this.requestX&&(this.requestX.action=null),this.requestY&&(this.requestY.action=null),this.element=null,this.requestX=null,this.requestY=null,this.scrollLeft=0,this.scrollTop=0}addRequest(e){u.x&e.direction?(this.requestX&&this.removeRequest(this.requestX),this.requestX=e):(this.requestY&&this.removeRequest(this.requestY),this.requestY=e),e.action=this}removeRequest(e){this.requestX===e?(this.requestX=null,e.action=null):this.requestY===e&&(this.requestY=null,e.action=null)}computeScrollValues(){this.element&&(this.scrollLeft=this.requestX?this.requestX.value:$(this.element),this.scrollTop=this.requestY?this.requestY.value:Z(this.element))}scroll(){this.element&&(this.element.scrollTo?this.element.scrollTo(this.scrollLeft,this.scrollTop):(this.element.scrollLeft=this.scrollLeft,this.element.scrollTop=this.scrollTop))}},Ne=class{constructor(){this.item=null,this.element=null,this.isActive=!1,this.isEnding=!1,this.direction=0,this.value=NaN,this.maxValue=0,this.threshold=0,this.distance=0,this.deltaTime=0,this.speed=0,this.duration=0,this.action=null}reset(){this.isActive&&this.onStop(),this.item=null,this.element=null,this.isActive=!1,this.isEnding=!1,this.direction=0,this.value=NaN,this.maxValue=0,this.threshold=0,this.distance=0,this.deltaTime=0,this.speed=0,this.duration=0,this.action=null}hasReachedEnd(){return H.forward&this.direction?Ee(this.value,this.maxValue):this.value<=0}computeCurrentScrollValue(){return this.element?this.value!==this.value?u.x&this.direction?$(this.element):Z(this.element):Math.max(0,Math.min(this.value,this.maxValue)):0}computeNextScrollValue(){let e=this.speed*(this.deltaTime/1e3),t=H.forward&this.direction?this.value+e:this.value-e;return Math.max(0,Math.min(t,this.maxValue))}computeSpeed(){if(!this.item||!this.element)return 0;let{speed:e}=this.item;return typeof e=="function"?(R.direction=qe(this.direction),R.threshold=this.threshold,R.distance=this.distance,R.value=this.value,R.maxValue=this.maxValue,R.duration=this.duration,R.speed=this.speed,R.deltaTime=this.deltaTime,R.isEnding=this.isEnding,e(this.element,R)):e}tick(e){return this.isActive||(this.isActive=!0,this.onStart()),this.deltaTime=e,this.value=this.computeCurrentScrollValue(),this.speed=this.computeSpeed(),this.value=this.computeNextScrollValue(),this.duration+=e,this.value}onStart(){if(!this.item||!this.element)return;let{onStart:e}=this.item;typeof e=="function"&&e(this.element,qe(this.direction))}onStop(){if(!this.item||!this.element)return;let{onStop:e}=this.item;typeof e=="function"&&e(this.element,qe(this.direction))}};function wt(r=500,e=.5,t=.25){let n=r*(e>0?1/e:1/0),i=r*(t>0?1/t:1/0);return function(o,s){let a=0;if(!s.isEnding)if(s.threshold>0){let d=s.threshold-Math.max(0,s.distance);a=r/s.threshold*d}else a=r;let c=s.speed;if(c===a)return a;let l=a;return c<a?(l=c+n*(s.deltaTime/1e3),Math.min(a,l)):(l=c-i*(s.deltaTime/1e3),Math.max(a,l))}}var ve=class{constructor(e={}){let{overlapCheckInterval:t=150}=e;this.items=[],this.settings={overlapCheckInterval:t},this._actions=[],this._isDestroyed=!1,this._isTicking=!1,this._tickTime=0,this._tickDeltaTime=0,this._requests={[u.x]:new Map,[u.y]:new Map},this._itemData=new Map,this._requestPool=new ie(()=>new Ne,{initialBatchCount:1,minBatchCount:1,onRelease:n=>n.reset()}),this._actionPool=new ie(()=>new He,{initialBatchCount:1,minBatchCount:1,onRelease:n=>n.reset()}),this._frameRead=this._frameRead.bind(this),this._frameWrite=this._frameWrite.bind(this)}_frameRead(e){this._isDestroyed||(e&&this._tickTime?(this._tickDeltaTime=e-this._tickTime,this._tickTime=e,this._updateItems(),this._updateRequests(),this._updateActions()):(this._tickTime=e,this._tickDeltaTime=0))}_frameWrite(){this._isDestroyed||this._applyActions()}_startTicking(){this._isTicking||(this._isTicking=!0,S.on(y.read,this._frameRead,this._frameRead),S.on(y.write,this._frameWrite,this._frameWrite))}_stopTicking(){this._isTicking&&(this._isTicking=!1,this._tickTime=0,this._tickDeltaTime=0,S.off(y.read,this._frameRead),S.off(y.write,this._frameWrite))}_requestItemScroll(e,t,n,i,o,s,a){let c=this._requests[t],l=c.get(e);l?(l.element!==n||l.direction!==i)&&l.reset():(l=this._requestPool.get(),c.set(e,l)),l.item=e,l.element=n,l.direction=i,l.threshold=o,l.distance=s,l.maxValue=a}_cancelItemScroll(e,t){let n=this._requests[t],i=n.get(e);i&&(i.action&&i.action.removeRequest(i),this._requestPool.release(i),n.delete(e))}_checkItemOverlap(e,t,n){let{inertAreaSize:i,targets:o,clientRect:s}=e;if(!o.length){t&&this._cancelItemScroll(e,u.x),n&&this._cancelItemScroll(e,u.y);return}let a=this._itemData.get(e),c=a?.directionX,l=a?.directionY;if(!c&&!l){t&&this._cancelItemScroll(e,u.x),n&&this._cancelItemScroll(e,u.y);return}let d=null,h=-1/0,f=0,p=-1/0,_=E.none,D=0,x=0,b=null,C=-1/0,J=0,Q=-1/0,xe=E.none,Ze=0,Je=0,Te=0;for(;Te<o.length;Te++){let L=o[Te],Qe=typeof L.threshold=="number"?L.threshold:Pt,Ce=!!(t&&c&&L.axis!=="y"),Pe=!!(n&&l&&L.axis!=="x"),V=L.priority||0;if((!Ce||V<h)&&(!Pe||V<C))continue;let k=Ke(L.element||L),le=Ce?We(k):-1,ce=Pe?Ve(k):-1;if(le<=0&&ce<=0)continue;let P=ke([k,"padding"],window),N=oe(s,P)||-1/0;if(N===-1/0)if(L.padding&&Xe(s,Mt(P,L.padding,Ct)))N=-(Dt(s,P)||0);else continue;if(Ce&&V>=h&&le>0&&(V>h||N>p)){let M=0,K=E.none,W=ze(Qe,P.width),ee=Be(W,i,s.width,P.width);c===E.right?(M=P.x+P.width+ee-(s.x+s.width),M<=W&&!Ee($(k),le)&&(K=E.right)):c===E.left&&(M=s.x-(P.x-ee),M<=W&&$(k)>0&&(K=E.left)),K&&(d=k,h=V,f=W,p=N,_=K,D=M,x=le)}if(Pe&&V>=C&&ce>0&&(V>C||N>Q)){let M=0,K=se.none,W=ze(Qe,P.height),ee=Be(W,i,s.height,P.height);l===E.down?(M=P.y+P.height+ee-(s.y+s.height),M<=W&&!Ee(Z(k),ce)&&(K=E.down)):l===E.up&&(M=s.y-(P.y-ee),M<=W&&Z(k)>0&&(K=E.up)),K&&(b=k,C=V,J=W,Q=N,xe=K,Ze=M,Je=ce)}}t&&(d&&_?this._requestItemScroll(e,u.x,d,_,f,D,x):this._cancelItemScroll(e,u.x)),n&&(b&&xe?this._requestItemScroll(e,u.y,b,xe,J,Ze,Je):this._cancelItemScroll(e,u.y))}_updateScrollRequest(e){let t=e.item,{inertAreaSize:n,smoothStop:i,targets:o,clientRect:s}=t,a=null,c=0;for(;c<o.length;c++){let l=o[c],d=Ke(l.element||l);if(d!==e.element)continue;let h=!!(u.x&e.direction);if(h){if(l.axis==="y")continue}else if(l.axis==="x")continue;let f=h?We(d):Ve(d);if(f<=0)break;let p=ke([d,"padding"],window);if((oe(s,p)||-1/0)===-1/0){let Q=l.scrollPadding||l.padding;if(!(Q&&Xe(s,Mt(p,Q,Ct))))break}let D=typeof l.threshold=="number"?l.threshold:Pt,x=ze(D,h?p.width:p.height),b=Be(x,n,h?s.width:s.height,h?p.width:p.height),C=0;if(e.direction===E.left?C=s.x-(p.x-b):e.direction===E.right?C=p.x+p.width+b-(s.x+s.width):e.direction===E.up?C=s.y-(p.y-b):C=p.y+p.height+b-(s.y+s.height),C>x)break;let J=h?$(d):Z(d);if(a=H.forward&e.direction?Ee(J,f):J<=0,a)break;return e.maxValue=f,e.threshold=x,e.distance=C,e.isEnding=!1,!0}return i===!0&&e.speed>0?(a===null&&(a=e.hasReachedEnd()),e.isEnding=!a):e.isEnding=!1,e.isEnding}_updateItems(){for(let e=0;e<this.items.length;e++){let t=this.items[e],n=this._itemData.get(t),{x:i,y:o}=t.position,s=n.positionX,a=n.positionY;i===s&&o===a||(n.directionX=i>s?E.right:i<s?E.left:n.directionX,n.directionY=o>a?E.down:o<a?E.up:n.directionY,n.positionX=i,n.positionY=o,n.overlapCheckRequestTime===0&&(n.overlapCheckRequestTime=this._tickTime))}}_updateRequests(){let e=this.items,t=this._requests[u.x],n=this._requests[u.y],i=0;for(;i<e.length;i++){let o=e[i],s=this._itemData.get(o),a=s.overlapCheckRequestTime,c=a>0&&this._tickTime-a>this.settings.overlapCheckInterval,l=!0,d=t.get(o);d&&d.isActive&&(l=!this._updateScrollRequest(d),l&&(c=!0,this._cancelItemScroll(o,u.x)));let h=!0,f=n.get(o);f&&f.isActive&&(h=!this._updateScrollRequest(f),h&&(c=!0,this._cancelItemScroll(o,u.y))),c&&(s.overlapCheckRequestTime=0,this._checkItemOverlap(o,l,h))}}_requestAction(e,t){let n=t===u.x,i=null,o=0;for(;o<this._actions.length;o++){if(i=this._actions[o],e.element!==i.element){i=null;continue}if(n?i.requestX:i.requestY){this._cancelItemScroll(e.item,t);return}break}i||(i=this._actionPool.get()),i.element=e.element,i.addRequest(e),e.tick(this._tickDeltaTime),this._actions.push(i)}_updateActions(){let e=0;for(e=0;e<this.items.length;e++){let t=this.items[e],n=this._requests[u.x].get(t),i=this._requests[u.y].get(t);n&&this._requestAction(n,u.x),i&&this._requestAction(i,u.y)}for(e=0;e<this._actions.length;e++)this._actions[e].computeScrollValues()}_applyActions(){if(!this._actions.length)return;let e=0;for(e=0;e<this._actions.length;e++)this._actions[e].scroll(),this._actionPool.release(this._actions[e]);this._actions.length=0}addItem(e){if(this._isDestroyed||this._itemData.has(e))return;let{x:t,y:n}=e.position,i=new Ye;i.positionX=t,i.positionY=n,i.directionX=E.none,i.directionY=E.none,i.overlapCheckRequestTime=this._tickTime,this._itemData.set(e,i),this.items.push(e),this._isTicking||this._startTicking()}removeItem(e){if(this._isDestroyed)return;let t=this.items.indexOf(e);t!==-1&&(this._requests[u.x].get(e)&&(this._cancelItemScroll(e,u.x),this._requests[u.x].delete(e)),this._requests[u.y].get(e)&&(this._cancelItemScroll(e,u.y),this._requests[u.y].delete(e)),this._itemData.delete(e),this.items.splice(t,1),this._isTicking&&!this.items.length&&this._stopTicking())}isDestroyed(){return this._isDestroyed}isItemScrollingX(e){return!!this._requests[u.x].get(e)?.isActive}isItemScrollingY(e){return!!this._requests[u.y].get(e)?.isActive}isItemScrolling(e){return this.isItemScrollingX(e)||this.isItemScrollingY(e)}updateSettings(e={}){let{overlapCheckInterval:t=this.settings.overlapCheckInterval}=e;this.settings.overlapCheckInterval=t}destroy(){if(this._isDestroyed)return;let e=this.items.slice(0),t=0;for(;t<e.length;t++)this.removeItem(e[t]);this._actions.length=0,this._requestPool.destroy(),this._actionPool.destroy(),this._isDestroyed=!0}};var Ge=new ve;var Ue={x:0,y:0},ae={width:0,height:0,x:0,y:0};function tn(){return{targets:[],inertAreaSize:.2,speed:wt(),smoothStop:!1,getPosition:r=>{let{drag:e}=r,t=e?.items[0];if(t)return t.position;let n=e&&(e.moveEvent||e.startEvent);return Ue.x=n?n.x:0,Ue.y=n?n.y:0,Ue},getClientRect:r=>{let{drag:e}=r,t=r.getClientRect();if(t)return t;let n=e&&(e.moveEvent||e.startEvent);return ae.width=n?50:0,ae.height=n?50:0,ae.x=n?n.x-25:0,ae.y=n?n.y-25:0,ae},onStart:null,onStop:null}}var Fe=class{constructor(e,t){this._draggableAutoScroll=e,this._draggable=t,this._position={x:0,y:0},this._clientRect={width:0,height:0,x:0,y:0}}_getSettings(){return this._draggableAutoScroll.settings}get targets(){let{targets:e}=this._getSettings();return typeof e=="function"&&(e=e(this._draggable)),e}get position(){let e=this._position,{getPosition:t}=this._getSettings();return typeof t=="function"?Object.assign(e,t(this._draggable)):(e.x=0,e.y=0),e}get clientRect(){let e=this._clientRect,{getClientRect:t}=this._getSettings();return typeof t=="function"?Object.assign(e,t(this._draggable)):(e.width=0,e.height=0,e.x=0,e.y=0),e}get inertAreaSize(){return this._getSettings().inertAreaSize}get smoothStop(){return this._getSettings().smoothStop}get speed(){return this._getSettings().speed}get onStart(){return this._getSettings().onStart}get onStop(){return this._getSettings().onStop}},je=class{constructor(e,t={}){this.name="autoscroll",this.version="0.0.3",this.settings=this._parseSettings(t),this._autoScrollProxy=null,e.on(v.Start,()=>{this._autoScrollProxy||(this._autoScrollProxy=new Fe(this,e),Ge.addItem(this._autoScrollProxy))}),e.on(v.End,()=>{this._autoScrollProxy&&(Ge.removeItem(this._autoScrollProxy),this._autoScrollProxy=null)})}_parseSettings(e,t=tn()){let{targets:n=t.targets,inertAreaSize:i=t.inertAreaSize,speed:o=t.speed,smoothStop:s=t.smoothStop,getPosition:a=t.getPosition,getClientRect:c=t.getClientRect,onStart:l=t.onStart,onStop:d=t.onStop}=e||{};return{targets:n,inertAreaSize:i,speed:o,smoothStop:s,getPosition:a,getClientRect:c,onStart:l,onStop:d}}updateSettings(e={}){this.settings=this._parseSettings(e,this.settings)}};function Mo(r){return e=>{let t=new je(e,r),n=e;return n.plugins[t.name]=t,n}}import{Emitter as rn}from"eventti";import{Emitter as nn}from"eventti";var be={Destroy:"destroy"},$e={accept:()=>!0,parent:null,data:{}},It=class{constructor(e,t={}){let{accept:n=$e.accept,parent:i=$e.parent,data:o=$e.data}=t;this.id=Symbol(),this.element=e,this.parent=i,this.children=new Set,this.accept=n,this.data={...o},this.isDestroyed=!1,this._clientRect={x:0,y:0,width:0,height:0},this._emitter=new nn,this.setParent(i),this.updateClientRect()}_isDescendantOf(e){let t=e;for(;t;){if(t===this)return!0;t=t.parent}return!1}on(e,t,n){return this._emitter.on(e,t,n)}off(e,t){this._emitter.off(e,t)}setParent(e){if(this.parent!==e){if(e===this)throw new Error("Droppable cannot be its own parent.");if(e&&e._isDescendantOf(this))throw new Error("Cannot set a descendant as parent.");this.parent&&this.parent.children.delete(this),e&&e.children.add(this),this.parent=e}}getClientRect(){return this._clientRect}updateClientRect(e){let t=e||this.element.getBoundingClientRect(),{_clientRect:n}=this;n.x=t.x,n.y=t.y,n.width=t.width,n.height=t.height}destroy(){this.isDestroyed||(this.isDestroyed=!0,this._emitter.emit(be.Destroy),this._emitter.off(),this.setParent(null),this.children.forEach(e=>{e.parent===this&&e.setParent(null)}),this.children.clear())}};var De=class{constructor(e,t){this.createItem=e;this.updateItem=t;this.items=[];this.index=0}get(...e){return this.index>=this.items.length?this.items[this.index++]=this.createItem(...e):this.updateItem(this.items[this.index++],...e)}resetPointer(){this.index=0}resetItems(e=0){let t=Math.max(0,Math.min(e,this.items.length));this.index=Math.min(this.index,t),this.items.length=t}};function At(r,{getCollisionScore:e=(n,i)=>{let o=n.getClientRect();if(!o)return null;let s=oe(o,i.getClientRect());return s>0?s:null},sortCollisions:t=(n,i)=>i.sort((o,s)=>{let a=s.score-o.score;return a!==0?a:o.width*o.height-s.width*s.height})}={}){let n=r._droppables,i=new De((a,c)=>({id:a.id,...a.getClientRect(),score:c}),(a,c,l)=>(Object.assign(a,c.getClientRect()),a.id=c.id,a.score=l,a)),o=a=>a.parent===null,s=a=>n.get(a.id);return r.on("removeDroppable",()=>{i.resetItems(n.size)}),r.on("destroy",()=>{i.resetItems()}),(a,c)=>{let l=Array.from(c).filter(o),d=[];for(;l.length>0;){let h=[];for(let f of l){let p=e(a,f);p!==null&&h.push(i.get(f,p))}if(!h.length)break;t(a,h),d=h,l=Array.from(n.get(h[0].id).children)}return i.resetPointer(),new Set(d.map(s))}}var g={Start:"start",Move:"move",Enter:"enter",Leave:"leave",Over:"over",Drop:"drop",End:"end",Cancel:"cancel",AddDraggable:"addDraggable",RemoveDraggable:"removeDraggable",AddDroppable:"addDroppable",RemoveDroppable:"removeDroppable",Destroy:"destroy"},on={collisionDetection:void 0},Ot=class{constructor(e={}){let{collisionDetection:t=on.collisionDetection}=e;this._listenerId=Symbol(),this._draggables=new Set,this._droppables=new Map,this._dragData=new Map,this._isCheckingCollisions=!1,this._emitter=new rn,this._collisionDetection=t||At(this)}_isTarget(e,t){let n=typeof t.accept=="function"?t.accept(e):t.accept.includes(e.settings.group);return n&&e.drag?.items.some(i=>i.element===t.element)&&(n=!1),n}_getTargets(e){let t=this._dragData.get(e);if(t?.targets)return t.targets;let n=new Set;for(let[i,o]of this._droppables)this._isTarget(e,o)&&n.add(o);return t&&(t.targets=n),n}_onDragStart(e){if(!this._draggables.has(e)||this._dragData.get(e))return;let t=this._getTargets(e),n=this._collisionDetection(e,t),i={targets:t,collisions:n,data:{}};this._dragData.set(e,i),this._emitter.listenerCount(g.Start)&&this._emitter.emit(g.Start,{draggable:e,targets:Array.from(t)}),n.size&&this._emitter.listenerCount(g.Enter)&&this._emitter.emit(g.Enter,{draggable:e,targets:Array.from(t),collisions:Array.from(n),addedCollisions:Array.from(n)})}_onDragMove(e){if(this._dragData.get(e)){if(this._emitter.listenerCount(g.Move)){let n=this._getTargets(e);this._emitter.emit(g.Move,{draggable:e,targets:Array.from(n)})}this.detectCollisions(e)}}_onDragEnd(e){let t=this._dragData.get(e);if(!t)return;let n=this._getTargets(e),i=t.collisions;i&&i.size>0&&this._emitter.listenerCount(g.Drop)&&this._emitter.emit(g.Drop,{draggable:e,targets:Array.from(n),collisions:Array.from(i)}),this._emitter.listenerCount(g.End)&&this._emitter.emit(g.End,{draggable:e,targets:Array.from(n)}),this._dragData.delete(e)}_onDragCancel(e){if(this._dragData.get(e)){if(this._emitter.listenerCount(g.Cancel)){let n=this._getTargets(e);this._emitter.emit(g.Cancel,{draggable:e,targets:Array.from(n)})}this._dragData.delete(e)}}_onDragDestroy(e){this.removeDraggable(e)}on(e,t,n){return this._emitter.on(e,t,n)}off(e,t){this._emitter.off(e,t)}getData(e){let t=this._dragData.get(e);return t?t.data:null}clearTargets(e){let t=this._dragData.get(e);t&&(t.targets=null)}detectCollisions(e){let t=this._dragData.get(e);if(!t)return;if(this._isCheckingCollisions)throw new Error("Cannot detect collisions while already checking collisions.");this._isCheckingCollisions=!0;let n=this._getTargets(e),i=t.collisions,o=this._collisionDetection(e,n);if(t.collisions=o,this._emitter.listenerCount(g.Leave)){let s=i?i.difference(o):new Set;s.size>0&&this._emitter.emit(g.Leave,{draggable:e,targets:Array.from(n),collisions:Array.from(o),removedCollisions:Array.from(s)})}if(this._emitter.listenerCount(g.Enter)){let s=i?o.difference(i):o;s.size>0&&this._emitter.emit(g.Enter,{draggable:e,targets:Array.from(n),collisions:Array.from(o),addedCollisions:Array.from(s)})}if(this._emitter.listenerCount(g.Over)){let s=i?o.intersection(i):new Set;s.size>0&&this._emitter.emit(g.Over,{draggable:e,targets:Array.from(n),collisions:Array.from(o),persistedCollisions:Array.from(s)})}this._isCheckingCollisions=!1}addDraggable(e){this._draggables.has(e)||(this._draggables.add(e),e.on(v.Start,()=>{this._onDragStart(e)},this._listenerId),e.on(v.Move,()=>{this._onDragMove(e)},this._listenerId),e.on(v.End,t=>{t?.type===m.End?this._onDragEnd(e):t?.type===m.Cancel&&this._onDragCancel(e)},this._listenerId),e.on(v.Destroy,()=>{this._onDragDestroy(e)},this._listenerId),this._emitter.emit(g.AddDraggable,{draggable:e}),e.drag&&!e.drag.isEnded&&this._onDragStart(e))}removeDraggable(e){if(!this._draggables.has(e))return;e.off(v.Start,this._listenerId),e.off(v.Move,this._listenerId),e.off(v.End,this._listenerId),e.off(v.Destroy,this._listenerId);let t=this._dragData.get(e);t&&(t.collisions.size&&this._emitter.listenerCount(g.Leave)&&this._emitter.emit(g.Leave,{draggable:e,targets:Array.from(this._getTargets(e)),collisions:[],removedCollisions:Array.from(t.collisions)}),this._emitter.listenerCount(g.Cancel)&&this._emitter.emit(g.Cancel,{draggable:e,targets:Array.from(this._getTargets(e))})),this._dragData.delete(e),this._draggables.delete(e),this._emitter.emit(g.RemoveDraggable,{draggable:e})}addDroppable(e){this._droppables.has(e.id)||(this._droppables.set(e.id,e),e.on(be.Destroy,()=>{this.removeDroppable(e)},this._listenerId),this._dragData.forEach(({targets:t},n)=>{t&&this._isTarget(n,e)&&t.add(e)}),this._emitter.emit(g.AddDroppable,{droppable:e}))}removeDroppable(e){this._droppables.has(e.id)&&(this._droppables.delete(e.id),e.off(be.Destroy,this._listenerId),this._dragData.forEach(({targets:t})=>{t?.delete(e)}),this._emitter.listenerCount(g.Leave)&&this._dragData.forEach(({collisions:t},n)=>{t.has(e)&&(t.delete(e),this._emitter.emit(g.Leave,{draggable:n,targets:Array.from(this._getTargets(n)),collisions:Array.from(t),removedCollisions:[e]}))}),this._emitter.emit(g.RemoveDroppable,{droppable:e}))}destroy(){this._emitter.emit(g.Destroy),this._emitter.off()}};export{u as AUTO_SCROLL_AXIS,H as AUTO_SCROLL_AXIS_DIRECTION,E as AUTO_SCROLL_DIRECTION,ve as AutoScroll,de as BaseMotionSensor,G as BaseSensor,Ot as DndContext,g as DndContextEventType,yt as Draggable,q as DraggableApplyPositionPhase,je as DraggableAutoScroll,Gt as DraggableDefaultSettings,v as DraggableEventType,Le as DraggableModifierPhase,It as Droppable,be as DroppableEventType,st as KeyboardMotionSensor,ot as KeyboardSensor,X as PointerSensor,et as Sensor,m as SensorEventType,Ge as autoScroll,Mo as autoScrollPlugin,wt as autoScrollSmoothSpeed,At as createCollisionDetection,Ri as createContainmentModifier,Mi as createSnapModifier,Ci as createTouchDelayPredicate,on as defaultDndContextOptions,$e as defaultDroppableOptions,w as keyboardMotionSensorDefaults,z as keyboardSensorDefaults,yn as setTicker,S as ticker,y as tickerPhases};
