var _={start:"start",move:"move",cancel:"cancel",end:"end",destroy:"destroy"};import{Emitter as yt}from"eventti";var X=class{constructor(){this.drag=null,this.isDestroyed=!1,this._emitter=new yt}_createDragData(e){return{x:e.x,y:e.y}}_updateDragData(e){this.drag&&(this.drag.x=e.x,this.drag.y=e.y)}_resetDragData(){this.drag=null}_start(e){this.isDestroyed||this.drag||(this.drag=this._createDragData(e),this._emitter.emit(_.start,e))}_move(e){this.drag&&(this._updateDragData(e),this._emitter.emit(_.move,e))}_end(e){this.drag&&(this._updateDragData(e),this._emitter.emit(_.end,e),this._resetDragData())}_cancel(e){this.drag&&(this._updateDragData(e),this._emitter.emit(_.cancel,e),this._resetDragData())}on(e,t,n){return this._emitter.on(e,t,n)}off(e,t){this._emitter.off(e,t)}cancel(){this.drag&&this._cancel({type:_.cancel,x:this.drag.x,y:this.drag.y})}destroy(){this.isDestroyed||(this.isDestroyed=!0,this.cancel(),this._emitter.emit(_.destroy,{type:_.destroy}),this._emitter.off())}};import{AutoTicker as vt}from"tikki";var g={read:Symbol(),write:Symbol()},S=new vt({phases:[g.read,g.write]});function jt(i,e){S=i,Object.assign(g,e)}var re=class extends X{constructor(){super(),this.drag=null,this._direction={x:0,y:0},this._speed=0,this._tick=this._tick.bind(this)}_createDragData(e){return{...super._createDragData(e),time:0,deltaTime:0}}_start(e){this.isDestroyed||this.drag||(super._start(e),S.on(g.read,this._tick,this._tick))}_end(e){this.drag&&(S.off(g.read,this._tick),super._end(e))}_cancel(e){this.drag&&(S.off(g.read,this._tick),super._cancel(e))}_tick(e){if(this.drag)if(e&&this.drag.time){this.drag.deltaTime=e-this.drag.time,this.drag.time=e;let t={type:"tick",time:this.drag.time,deltaTime:this.drag.deltaTime};if(this._emitter.emit("tick",t),!this.drag)return;let n=this._speed*(this.drag.deltaTime/1e3),r=this._direction.x*n,s=this._direction.y*n;(r||s)&&this._move({type:"move",x:this.drag.x+r,y:this.drag.y+s})}else this.drag.time=e,this.drag.deltaTime=0}};import{Emitter as _t}from"eventti";function ve(i,e){if("pointerId"in i)return i.pointerId===e?i:null;if("changedTouches"in i){let t=0;for(;t<i.changedTouches.length;t++)if(i.changedTouches[t].identifier===e)return i.changedTouches[t];return null}return i}function ze(i){return"pointerType"in i?i.pointerType:"touches"in i?"touch":"mouse"}function Fe(i){return"pointerId"in i?i.pointerId:"changedTouches"in i?i.changedTouches[0]?i.changedTouches[0].identifier:null:-1}var _e=typeof window<"u"&&typeof window.document<"u",oe=(()=>{let i=!1;try{let e=Object.defineProperty({},"passive",{get:function(){i=!0}});window.addEventListener("testPassive",null,e),window.removeEventListener("testPassive",null,e)}catch{}return i})(),je=_e&&"ontouchstart"in window,$e=_e&&!!window.PointerEvent,on=!!(_e&&navigator.vendor&&navigator.vendor.indexOf("Apple")>-1&&navigator.userAgent&&navigator.userAgent.indexOf("CriOS")==-1&&navigator.userAgent.indexOf("FxiOS")==-1);function xe(i={}){let{capture:e=!0,passive:t=!0}=i;return oe?{capture:e,passive:t}:{capture:e}}function be(i){return i==="auto"||i===void 0?$e?"pointer":je?"touch":"mouse":i}var xt={start:"pointerdown",move:"pointermove",cancel:"pointercancel",end:"pointerup"},bt={start:"touchstart",move:"touchmove",cancel:"touchcancel",end:"touchend"},Dt={start:"mousedown",move:"mousemove",cancel:"",end:"mouseup"},Y={pointer:xt,touch:bt,mouse:Dt},H=class{constructor(e,t={}){let{listenerOptions:n={},sourceEvents:r="auto",startPredicate:s=o=>!("button"in o&&o.button>0)}=t;this.element=e,this.drag=null,this.isDestroyed=!1,this._areWindowListenersBound=!1,this._startPredicate=s,this._listenerOptions=xe(n),this._sourceEvents=be(r),this._emitter=new _t,this._onStart=this._onStart.bind(this),this._onMove=this._onMove.bind(this),this._onCancel=this._onCancel.bind(this),this._onEnd=this._onEnd.bind(this),e.addEventListener(Y[this._sourceEvents].start,this._onStart,this._listenerOptions)}_getTrackedPointerEventData(e){return this.drag?ve(e,this.drag.pointerId):null}_onStart(e){if(this.isDestroyed||this.drag||!this._startPredicate(e))return;let t=Fe(e);if(t===null)return;let n=ve(e,t);if(n===null)return;let r={pointerId:t,pointerType:ze(e),x:n.clientX,y:n.clientY};this.drag=r;let s={...r,type:_.start,srcEvent:e,target:n.target};this._emitter.emit(s.type,s),this.drag&&this._bindWindowListeners()}_onMove(e){if(!this.drag)return;let t=this._getTrackedPointerEventData(e);if(!t)return;this.drag.x=t.clientX,this.drag.y=t.clientY;let n={type:_.move,srcEvent:e,target:t.target,...this.drag};this._emitter.emit(n.type,n)}_onCancel(e){if(!this.drag)return;let t=this._getTrackedPointerEventData(e);if(!t)return;this.drag.x=t.clientX,this.drag.y=t.clientY;let n={type:_.cancel,srcEvent:e,target:t.target,...this.drag};this._emitter.emit(n.type,n),this._resetDrag()}_onEnd(e){if(!this.drag)return;let t=this._getTrackedPointerEventData(e);if(!t)return;this.drag.x=t.clientX,this.drag.y=t.clientY;let n={type:_.end,srcEvent:e,target:t.target,...this.drag};this._emitter.emit(n.type,n),this._resetDrag()}_bindWindowListeners(){if(this._areWindowListenersBound)return;let{move:e,end:t,cancel:n}=Y[this._sourceEvents];window.addEventListener(e,this._onMove,this._listenerOptions),window.addEventListener(t,this._onEnd,this._listenerOptions),n&&window.addEventListener(n,this._onCancel,this._listenerOptions),this._areWindowListenersBound=!0}_unbindWindowListeners(){if(this._areWindowListenersBound){let{move:e,end:t,cancel:n}=Y[this._sourceEvents];window.removeEventListener(e,this._onMove,this._listenerOptions),window.removeEventListener(t,this._onEnd,this._listenerOptions),n&&window.removeEventListener(n,this._onCancel,this._listenerOptions),this._areWindowListenersBound=!1}}_resetDrag(){this.drag=null,this._unbindWindowListeners()}cancel(){if(!this.drag)return;let e={type:_.cancel,srcEvent:null,target:null,...this.drag};this._emitter.emit(e.type,e),this._resetDrag()}updateSettings(e){if(this.isDestroyed)return;let{listenerOptions:t,sourceEvents:n,startPredicate:r}=e,s=be(n),o=xe(t);r&&this._startPredicate!==r&&(this._startPredicate=r),(t&&(this._listenerOptions.capture!==o.capture||this._listenerOptions.passive===o.passive)||n&&this._sourceEvents!==s)&&(this.element.removeEventListener(Y[this._sourceEvents].start,this._onStart,this._listenerOptions),this._unbindWindowListeners(),this.cancel(),n&&(this._sourceEvents=s),t&&o&&(this._listenerOptions=o),this.element.addEventListener(Y[this._sourceEvents].start,this._onStart,this._listenerOptions))}on(e,t,n){return this._emitter.on(e,t,n)}off(e,t){this._emitter.off(e,t)}destroy(){this.isDestroyed||(this.isDestroyed=!0,this.cancel(),this._emitter.emit(_.destroy,{type:_.destroy}),this._emitter.off(),this.element.removeEventListener(Y[this._sourceEvents].start,this._onStart,this._listenerOptions))}};var K={moveDistance:25,cancelOnBlur:!0,cancelOnVisibilityChange:!0,startPredicate:(i,e)=>{if(e.element&&(i.key==="Enter"||i.key===" ")&&document.activeElement===e.element){let{x:t,y:n}=e.element.getBoundingClientRect();return{x:t,y:n}}return null},movePredicate:(i,e)=>{if(!e.drag)return null;switch(i.key){case"ArrowLeft":return{x:e.drag.x-e.moveDistance.x,y:e.drag.y};case"ArrowRight":return{x:e.drag.x+e.moveDistance.x,y:e.drag.y};case"ArrowUp":return{x:e.drag.x,y:e.drag.y-e.moveDistance.y};case"ArrowDown":return{x:e.drag.x,y:e.drag.y+e.moveDistance.y};default:return null}},cancelPredicate:(i,e)=>{if(e.drag&&i.key==="Escape"){let{x:t,y:n}=e.drag;return{x:t,y:n}}return null},endPredicate:(i,e)=>{if(e.drag&&(i.key==="Enter"||i.key===" ")){let{x:t,y:n}=e.drag;return{x:t,y:n}}return null}},Je=class extends X{constructor(e,t={}){super();let{moveDistance:n=K.moveDistance,cancelOnBlur:r=K.cancelOnBlur,cancelOnVisibilityChange:s=K.cancelOnVisibilityChange,startPredicate:o=K.startPredicate,movePredicate:a=K.movePredicate,cancelPredicate:c=K.cancelPredicate,endPredicate:l=K.endPredicate}=t;this.element=e,this.moveDistance=typeof n=="number"?{x:n,y:n}:{...n},this._cancelOnBlur=r,this._cancelOnVisibilityChange=s,this._startPredicate=o,this._movePredicate=a,this._cancelPredicate=c,this._endPredicate=l,this._onKeyDown=this._onKeyDown.bind(this),this._internalCancel=this._internalCancel.bind(this),this._blurCancelHandler=this._blurCancelHandler.bind(this),document.addEventListener("keydown",this._onKeyDown),r&&e?.addEventListener("blur",this._blurCancelHandler),s&&document.addEventListener("visibilitychange",this._internalCancel)}_internalCancel(){this.cancel()}_blurCancelHandler(){queueMicrotask(()=>{document.activeElement!==this.element&&this.cancel()})}_onKeyDown(e){if(!this.drag){let s=this._startPredicate(e,this);s&&(e.preventDefault(),this._start({type:"start",x:s.x,y:s.y,srcEvent:e}));return}let t=this._cancelPredicate(e,this);if(t){e.preventDefault(),this._cancel({type:"cancel",x:t.x,y:t.y,srcEvent:e});return}let n=this._endPredicate(e,this);if(n){e.preventDefault(),this._end({type:"end",x:n.x,y:n.y,srcEvent:e});return}let r=this._movePredicate(e,this);if(r){e.preventDefault(),this._move({type:"move",x:r.x,y:r.y,srcEvent:e});return}}updateSettings(e={}){let{moveDistance:t,cancelOnBlur:n,cancelOnVisibilityChange:r,startPredicate:s,movePredicate:o,cancelPredicate:a,endPredicate:c}=e;t!==void 0&&(typeof t=="number"?this.moveDistance.x=this.moveDistance.y=t:(this.moveDistance.x=t.x,this.moveDistance.y=t.y)),n!==void 0&&this._cancelOnBlur!==n&&(this._cancelOnBlur=n,n?this.element?.addEventListener("blur",this._blurCancelHandler):this.element?.removeEventListener("blur",this._blurCancelHandler)),r!==void 0&&this._cancelOnVisibilityChange!==r&&(this._cancelOnVisibilityChange=r,r?document.addEventListener("visibilitychange",this._internalCancel):document.removeEventListener("visibilitychange",this._internalCancel)),s&&(this._startPredicate=s),o&&(this._movePredicate=o),a&&(this._cancelPredicate=a),c&&(this._endPredicate=c)}destroy(){this.isDestroyed||(super.destroy(),document.removeEventListener("keydown",this._onKeyDown),this._cancelOnBlur&&this.element?.removeEventListener("blur",this._blurCancelHandler),this._cancelOnVisibilityChange&&document.removeEventListener("visibilitychange",this._internalCancel))}};var Pt=["start","cancel","end","moveLeft","moveRight","moveUp","moveDown"];function se(i,e){if(!i.size||!e.size)return 1/0;let t=1/0;for(let n of i){let r=e.get(n);r!==void 0&&r<t&&(t=r)}return t}var T={startKeys:[" ","Enter"],moveLeftKeys:["ArrowLeft"],moveRightKeys:["ArrowRight"],moveUpKeys:["ArrowUp"],moveDownKeys:["ArrowDown"],cancelKeys:["Escape"],endKeys:[" ","Enter"],cancelOnBlur:!0,cancelOnVisibilityChange:!0,computeSpeed:()=>500,startPredicate:(i,e)=>{if(e.element&&document.activeElement===e.element){let{left:t,top:n}=e.element.getBoundingClientRect();return{x:t,y:n}}return null}},Ze=class extends re{constructor(e,t={}){super();let{startPredicate:n=T.startPredicate,computeSpeed:r=T.computeSpeed,cancelOnVisibilityChange:s=T.cancelOnVisibilityChange,cancelOnBlur:o=T.cancelOnBlur,startKeys:a=T.startKeys,moveLeftKeys:c=T.moveLeftKeys,moveRightKeys:l=T.moveRightKeys,moveUpKeys:d=T.moveUpKeys,moveDownKeys:p=T.moveDownKeys,cancelKeys:f=T.cancelKeys,endKeys:h=T.endKeys}=t;this.element=e,this._startKeys=new Set(a),this._cancelKeys=new Set(f),this._endKeys=new Set(h),this._moveLeftKeys=new Set(c),this._moveRightKeys=new Set(l),this._moveUpKeys=new Set(d),this._moveDownKeys=new Set(p),this._moveKeys=new Set([...c,...l,...d,...p]),this._moveKeyTimestamps=new Map,this._cancelOnBlur=o,this._cancelOnVisibilityChange=s,this._computeSpeed=r,this._startPredicate=n,this._onKeyDown=this._onKeyDown.bind(this),this._onKeyUp=this._onKeyUp.bind(this),this._onTick=this._onTick.bind(this),this._internalCancel=this._internalCancel.bind(this),this._blurCancelHandler=this._blurCancelHandler.bind(this),this.on("tick",this._onTick,this._onTick),document.addEventListener("keydown",this._onKeyDown),document.addEventListener("keyup",this._onKeyUp),o&&e?.addEventListener("blur",this._blurCancelHandler),s&&document.addEventListener("visibilitychange",this._internalCancel)}_end(e){this.drag&&(this._moveKeyTimestamps.clear(),this._direction.x=0,this._direction.y=0,super._end(e))}_cancel(e){this.drag&&(this._moveKeyTimestamps.clear(),this._direction.x=0,this._direction.y=0,super._cancel(e))}_internalCancel(){this.cancel()}_blurCancelHandler(){queueMicrotask(()=>{document.activeElement!==this.element&&this.cancel()})}_updateDirection(){let e=se(this._moveLeftKeys,this._moveKeyTimestamps),t=se(this._moveRightKeys,this._moveKeyTimestamps),n=se(this._moveUpKeys,this._moveKeyTimestamps),r=se(this._moveDownKeys,this._moveKeyTimestamps),s=e===t?0:e<t?-1:1,o=n===r?0:n<r?-1:1;if(!(s===0||o===0)){let a=1/(Math.sqrt(s*s+o*o)||1);s*=a,o*=a}this._direction.x=s,this._direction.y=o}_onTick(){this._speed=this._computeSpeed(this)}_onKeyUp(e){this._moveKeyTimestamps.get(e.key)&&(this._moveKeyTimestamps.delete(e.key),this._updateDirection())}_onKeyDown(e){if(!this.drag){if(this._startKeys.has(e.key)){let t=this._startPredicate(e,this);t&&(e.preventDefault(),this._start({type:"start",x:t.x,y:t.y}))}return}if(this._cancelKeys.has(e.key)){e.preventDefault(),this._internalCancel();return}if(this._endKeys.has(e.key)){e.preventDefault(),this._end({type:"end",x:this.drag.x,y:this.drag.y});return}if(this._moveKeys.has(e.key)){e.preventDefault(),this._moveKeyTimestamps.get(e.key)||(this._moveKeyTimestamps.set(e.key,Date.now()),this._updateDirection());return}}updateSettings(e={}){let t=!1,{cancelOnBlur:n,cancelOnVisibilityChange:r,startPredicate:s,computeSpeed:o}=e;if(n!==void 0&&this._cancelOnBlur!==n&&(this._cancelOnBlur=n,n?this.element?.addEventListener("blur",this._blurCancelHandler):this.element?.removeEventListener("blur",this._blurCancelHandler)),r!==void 0&&this._cancelOnVisibilityChange!==r&&(this._cancelOnVisibilityChange=r,r?document.addEventListener("visibilitychange",this._internalCancel):document.removeEventListener("visibilitychange",this._internalCancel)),s!==void 0&&(this._startPredicate=s),o!==void 0&&(this._computeSpeed=o),Pt.forEach((a,c)=>{let l=`${a}Keys`,d=e[l];d!==void 0&&(this[`_${l}`]=new Set(d),c>=3&&(t=!0))}),t){let a=[...this._moveLeftKeys,...this._moveRightKeys,...this._moveUpKeys,...this._moveDownKeys];[...this._moveKeys].every((l,d)=>a[d]===l)||(this._moveKeys=new Set(a),this._moveKeyTimestamps.clear(),this._updateDirection())}}destroy(){this.isDestroyed||(super.destroy(),this.off("tick",this._onTick),document.removeEventListener("keydown",this._onKeyDown),document.removeEventListener("keyup",this._onKeyUp),this._cancelOnBlur&&this.element?.removeEventListener("blur",this._blurCancelHandler),this._cancelOnVisibilityChange&&document.removeEventListener("visibilitychange",this._internalCancel))}};import{Emitter as Ot}from"eventti";var $=class{constructor(){this.cache=new Map;this.validation=new Map;this.cache=new Map,this.validation=new Map}set(e,t){this.cache.set(e,t),this.validation.set(e,void 0)}get(e){return this.cache.get(e)}has(e){return this.cache.has(e)}delete(e){this.cache.delete(e),this.validation.delete(e)}isValid(e){return this.validation.has(e)}invalidate(e){e===void 0?this.validation.clear():this.validation.delete(e)}clear(){this.cache.clear(),this.validation.clear()}};var ae=class{constructor(e,t){this.sensor=e,this.isEnded=!1,this.event=t,this.prevEvent=t,this.startEvent=t,this.endEvent=null,this.items=[],this._matrixCache=new $,this._clientOffsetCache=new $}};import{getOffsetContainer as rt}from"mezr";var Qe=new WeakMap;function k(i){let e=Qe.get(i)?.deref();return e||(e=window.getComputedStyle(i,null),Qe.set(i,new WeakRef(e))),e}function V(i,e={x:0,y:0}){if(e.x=0,e.y=0,i instanceof Window)return e;if(i instanceof Document)return e.x=window.scrollX*-1,e.y=window.scrollY*-1,e;let{x:t,y:n}=i.getBoundingClientRect(),r=k(i);return e.x=t+(parseFloat(r.borderLeftWidth)||0),e.y=n+(parseFloat(r.borderTopWidth)||0),e}function De(i){return typeof i=="object"&&i!==null&&"x"in i&&"y"in i}var Tt={x:0,y:0},wt={x:0,y:0};function et(i,e,t={x:0,y:0}){let n=De(i)?i:V(i,Tt),r=De(e)?e:V(e,wt);return t.x=r.x-n.x,t.y=r.y-n.y,t}function le(i){let e=i.split(" "),t="",n="",r="";return e.length===1?t=n=e[0]:e.length===2?[t,n]=e:[t,n,r]=e,{x:parseFloat(t)||0,y:parseFloat(n)||0,z:parseFloat(r)||0}}var Ct="scale(1, 1)";function B(i){return i.setMatrixValue(Ct)}var W=new DOMMatrix;function tt(i,e=new DOMMatrix){let t=i;for(B(e);t;){let{transform:n,transformOrigin:r}=k(t);if(n&&n!=="none"&&(W.setMatrixValue(n),!W.isIdentity)){let{x:s,y:o,z:a}=le(r);a===0?W.setMatrixValue(`translate(${s}px, ${o}px) ${W} translate(${s*-1}px, ${o*-1}px)`):W.setMatrixValue(`translate3d(${s}px, ${o}px, ${a}px) ${W} translate3d(${s*-1}px, ${o*-1}px, ${a*-1}px)`),e.preMultiplySelf(W)}t=t.parentElement}return e}function nt(i,e,t=!1){let{style:n}=i;for(let r in e)n.setProperty(r,e[r],t?"important":"")}function it(){let i=document.createElement("div");return i.classList.add("dragdoll-measure"),nt(i,{display:"block",position:"absolute",inset:"0px",padding:"0px",margin:"0px",border:"none",opacity:"0",transform:"none","transform-origin":"0 0",transition:"none",animation:"none","pointer-events":"none"},!0),i}function J(i){return i.m11!==1||i.m12!==0||i.m13!==0||i.m14!==0||i.m21!==0||i.m22!==1||i.m23!==0||i.m24!==0||i.m31!==0||i.m32!==0||i.m33!==1||i.m34!==0||i.m43!==0||i.m44!==1}var ce=it(),de=class{constructor(e,t){if(!e.isConnected)throw new Error("Element is not connected");let{drag:n}=t;if(!n)throw new Error("Drag is not defined");let r=k(e),s=e.getBoundingClientRect();this.data={},this.element=e,this.elementTransformOrigin=le(r.transformOrigin),this.elementTransformMatrix=new DOMMatrix().setMatrixValue(r.transform),this.frozenProps=null,this.unfrozenProps=null,this.position={x:0,y:0},this.containerOffset={x:0,y:0},this.startOffset={x:0,y:0},this._moveDiff={x:0,y:0},this._alignDiff={x:0,y:0},this._matrixCache=n._matrixCache,this._clientOffsetCache=n._clientOffsetCache;let o=e.parentElement;if(!o)throw new Error("Dragged element does not have a parent element.");this.elementContainer=o;let a=t.settings.container||o;if(this.dragContainer=a,o!==a){let{position:h}=r;if(h!=="fixed"&&h!=="absolute")throw new Error(`Dragged element has "${h}" position, but only "fixed" or "absolute" are allowed when using a custom drag container.`)}let c=rt(e)||e;this.elementOffsetContainer=c;let l=a===o?c:rt(e,{container:a});this.dragOffsetContainer=l;{let{width:h,height:m,x,y:v}=s;this.clientRect={width:h,height:m,x,y:v}}this._computeContainerMatrices(),this.updateContainerOffset();let{x:d,y:p}=t.settings.getStartPosition({draggable:t,sensor:n.sensor,item:this,style:r});this.position.x=d,this.position.y=p;let f=t.settings.getFrozenProps({draggable:t,sensor:n.sensor,item:this,style:r});if(Array.isArray(f))if(f.length){let h={};for(let m of f)h[m]=r[m];this.frozenProps=h}else this.frozenProps=null;else this.frozenProps=f;if(this.frozenProps){let h={};for(let m in this.frozenProps)this.frozenProps.hasOwnProperty(m)&&(h[m]=e.style[m]);this.unfrozenProps=h}}_computeContainerMatrices(){[this.elementContainer,this.dragContainer].forEach(e=>{if(!this._matrixCache.isValid(e)){let t=this._matrixCache.get(e)||[new DOMMatrix,new DOMMatrix],[n,r]=t;tt(e,n),r.setMatrixValue(n.toString()).invertSelf(),this._matrixCache.set(e,t)}})}getContainerMatrix(){return this._matrixCache.get(this.elementContainer)}getDragContainerMatrix(){return this._matrixCache.get(this.dragContainer)}updateContainerOffset(e=!1){let{elementOffsetContainer:t,elementContainer:n,dragOffsetContainer:r,dragContainer:s,containerOffset:o,_clientOffsetCache:a,_matrixCache:c}=this;if(e&&(a.invalidate(r),a.invalidate(t)),t!==r){let[l,d]=[[s,r],[n,t]].map(([p,f])=>{let h=a.get(f)||{x:0,y:0};if(!a.isValid(f)){let m=c.get(p);f instanceof HTMLElement&&m&&!m[0].isIdentity?J(m[0])?(ce.style.setProperty("transform",m[1].toString(),"important"),f.append(ce),V(ce,h),ce.remove()):(V(f,h),h.x-=m[0].m41,h.y-=m[0].m42):V(f,h)}return a.set(f,h),h});et(l,d,o)}else o.x=0,o.y=0}updateSize(e){if(e)this.clientRect.width=e.width,this.clientRect.height=e.height;else{let{width:t,height:n}=this.element.getBoundingClientRect();this.clientRect.width=t,this.clientRect.height=n}}};function Pe(i,e,t){let n=document.activeElement,r=i.contains(n);t&&t.append(i),e.append(t||i),r&&document.activeElement!==n&&n.focus({preventScroll:!0})}function Te(i,e=0){let t=Math.pow(10,e);return Math.round((i+Number.EPSILON)*t)/t}function ot(i,e){return i.isIdentity&&e.isIdentity?!0:i.is2D&&e.is2D?i.a===e.a&&i.b===e.b&&i.c===e.c&&i.d===e.d&&i.e===e.e&&i.f===e.f:i.m11===e.m11&&i.m12===e.m12&&i.m13===e.m13&&i.m14===e.m14&&i.m21===e.m21&&i.m22===e.m22&&i.m23===e.m23&&i.m24===e.m24&&i.m31===e.m31&&i.m32===e.m32&&i.m33===e.m33&&i.m34===e.m34&&i.m41===e.m41&&i.m42===e.m42&&i.m43===e.m43&&i.m44===e.m44}var st=oe?{capture:!0,passive:!0}:!0,we={x:0,y:0},w=new DOMMatrix,he=new DOMMatrix;var Mt={container:null,startPredicate:()=>!0,getElements:()=>null,releaseElements:()=>null,getFrozenProps:()=>null,getStartPosition:()=>({x:0,y:0}),setPosition:({item:i,x:e,y:t,phase:n})=>{let r=n==="end",[s,o]=i.getContainerMatrix(),[a,c]=i.getDragContainerMatrix(),{startOffset:l,containerOffset:d,elementTransformMatrix:p,elementTransformOrigin:f}=i,{x:h,y:m,z:x}=f,v=!p.isIdentity&&(h!==0||m!==0||x!==0),y=r?e:d.x+(e-l.x),b=r?t:d.y+(t-l.y);B(w),v&&(x===0?w.translateSelf(h*-1,m*-1):w.translateSelf(h*-1,m*-1,x*-1)),r?o.isIdentity||w.multiplySelf(o):c.isIdentity||w.multiplySelf(c),B(he).translateSelf(y,b),w.multiplySelf(he),s.isIdentity||w.multiplySelf(s),v&&(B(he).translateSelf(h,m,x),w.multiplySelf(he)),p.isIdentity||w.multiplySelf(p),i.element.style.transform=`${w}`},getPositionChange:({event:i,prevEvent:e})=>(we.x=i.x-e.x,we.y=i.y-e.y,we)},at=class{constructor(e,t={}){this.sensors=e,this.settings=this._parseSettings(t),this.plugins={},this.drag=null,this.isDestroyed=!1,this._sensorData=new Map,this._emitter=new Ot,this._startPhase=0,this._startId=Symbol(),this._moveId=Symbol(),this._alignId=Symbol(),this._onMove=this._onMove.bind(this),this._onScroll=this._onScroll.bind(this),this._onEnd=this._onEnd.bind(this),this._prepareStart=this._prepareStart.bind(this),this._applyStart=this._applyStart.bind(this),this._prepareMove=this._prepareMove.bind(this),this._applyMove=this._applyMove.bind(this),this._prepareAlign=this._prepareAlign.bind(this),this._applyAlign=this._applyAlign.bind(this),this.sensors.forEach(n=>{this._sensorData.set(n,{predicateState:0,predicateEvent:null,onMove:o=>this._onMove(o,n),onEnd:o=>this._onEnd(o,n)});let{onMove:r,onEnd:s}=this._sensorData.get(n);n.on("start",r,r),n.on("move",r,r),n.on("cancel",s,s),n.on("end",s,s),n.on("destroy",s,s)})}_parseSettings(e,t=Mt){let{container:n=t.container,startPredicate:r=t.startPredicate,getElements:s=t.getElements,releaseElements:o=t.releaseElements,getFrozenProps:a=t.getFrozenProps,getStartPosition:c=t.getStartPosition,setPosition:l=t.setPosition,getPositionChange:d=t.getPositionChange}=e||{};return{container:n,startPredicate:r,getElements:s,releaseElements:o,getFrozenProps:a,getStartPosition:c,setPosition:l,getPositionChange:d}}_emit(e,...t){this._emitter.emit(e,...t)}_onMove(e,t){let n=this._sensorData.get(t);if(n)switch(n.predicateState){case 0:{n.predicateEvent=e;let r=this.settings.startPredicate({draggable:this,sensor:t,event:e});r===!0?this.resolveStartPredicate(t):r===!1&&this.rejectStartPredicate(t);break}case 1:{this.drag&&(this.drag.event=e,S.once(g.read,this._prepareMove,this._moveId),S.once(g.write,this._applyMove,this._moveId));break}}}_onScroll(){this.align()}_onEnd(e,t){let n=this._sensorData.get(t);n&&(this.drag?n.predicateState===1&&(this.drag.endEvent=e,this._sensorData.forEach(r=>{r.predicateState=0,r.predicateEvent=null}),this.stop()):(n.predicateState=0,n.predicateEvent=null))}_prepareStart(){let e=this.drag;if(!e)return;this._startPhase=2;let t=this.settings.getElements({draggable:this,sensor:e.sensor,startEvent:e.startEvent})||[];e.items=t.map(n=>new de(n,this)),this._emit("preparestart",e.startEvent)}_applyStart(){let e=this.drag;if(e){for(let t of e.items)t.dragContainer!==t.elementContainer&&Pe(t.element,t.dragContainer),t.frozenProps&&Object.assign(t.element.style,t.frozenProps),this.settings.setPosition({phase:"start",draggable:this,sensor:e.sensor,item:t,x:t.position.x,y:t.position.y});for(let t of e.items){let n=t.getContainerMatrix()[0],r=t.getDragContainerMatrix()[0];if(ot(n,r)||!J(n)&&!J(r))continue;let s=t.element.getBoundingClientRect(),{startOffset:o}=t;o.x=Te(s.x-t.clientRect.x,3),o.y=Te(s.y-t.clientRect.y,3)}for(let t of e.items){let{startOffset:n}=t;(n.x!==0||n.y!==0)&&this.settings.setPosition({phase:"start-align",draggable:this,sensor:e.sensor,item:t,x:t.position.x,y:t.position.y})}window.addEventListener("scroll",this._onScroll,st),this._startPhase=3,this._emit("start",e.startEvent)}}_prepareMove(){let e=this.drag;if(!e)return;let{event:t,prevEvent:n,startEvent:r,sensor:s}=e;if(t!==n){for(let o of e.items){let{x:a,y:c}=this.settings.getPositionChange({draggable:this,sensor:s,item:o,event:t,prevEvent:n,startEvent:r});a&&(o.position.x+=a,o.clientRect.x+=a,o._moveDiff.x+=a),c&&(o.position.y+=c,o.clientRect.y+=c,o._moveDiff.y+=c)}e.prevEvent=t,this._emit("preparemove",t)}}_applyMove(){let e=this.drag;if(e){for(let t of e.items)t._moveDiff.x=0,t._moveDiff.y=0,this.settings.setPosition({phase:"move",draggable:this,sensor:e.sensor,item:t,x:t.position.x,y:t.position.y});e.event&&this._emit("move",e.event)}}_prepareAlign(){let{drag:e}=this;if(e)for(let t of e.items){let{x:n,y:r}=t.element.getBoundingClientRect(),s=t.clientRect.x-t._moveDiff.x-n;t.position.x=t.position.x-t._alignDiff.x+s,t._alignDiff.x=s;let o=t.clientRect.y-t._moveDiff.y-r;t.position.y=t.position.y-t._alignDiff.y+o,t._alignDiff.y=o}}_applyAlign(){let{drag:e}=this;if(e)for(let t of e.items)t._alignDiff.x=0,t._alignDiff.y=0,this.settings.setPosition({phase:"align",draggable:this,sensor:e.sensor,item:t,x:t.position.x,y:t.position.y})}on(e,t,n){return this._emitter.on(e,t,n)}off(e,t){this._emitter.off(e,t)}resolveStartPredicate(e,t){let n=this._sensorData.get(e);if(!n)return;let r=t||n.predicateEvent;n.predicateState===0&&r&&(this._startPhase=1,n.predicateState=1,n.predicateEvent=null,this.drag=new ae(e,r),this._sensorData.forEach((s,o)=>{o!==e&&(s.predicateState=2,s.predicateEvent=null)}),S.once(g.read,this._prepareStart,this._startId),S.once(g.write,this._applyStart,this._startId))}rejectStartPredicate(e){let t=this._sensorData.get(e);t?.predicateState===0&&(t.predicateState=2,t.predicateEvent=null)}stop(){let e=this.drag;if(!e||e.isEnded)return;if(this._startPhase===2){this.off("start",this._startId),this.on("start",()=>this.stop(),this._startId);return}this._startPhase=0,e.isEnded=!0,S.off(g.read,this._startId),S.off(g.write,this._startId),S.off(g.read,this._moveId),S.off(g.write,this._moveId),S.off(g.read,this._alignId),S.off(g.write,this._alignId),window.removeEventListener("scroll",this._onScroll,st),e._clientOffsetCache.clear();for(let n of e.items)if(n.elementContainer!==n.dragContainer){let{x:r,y:s}=n.containerOffset;n.updateContainerOffset();let{x:o,y:a}=n.containerOffset;n.position.x+=(o-r)*-1,n.position.y+=(a-s)*-1,n.containerOffset.x=0,n.containerOffset.y=0}let t=[];for(let n of e.items){if(t.push(n.element),n.elementContainer!==n.dragContainer&&Pe(n.element,n.elementContainer),n.unfrozenProps)for(let r in n.unfrozenProps)n.element.style[r]=n.unfrozenProps[r]||"";this.settings.setPosition({phase:"end",draggable:this,sensor:e.sensor,item:n,x:n.position.x,y:n.position.y})}t.length&&this.settings.releaseElements({draggable:this,sensor:e.sensor,elements:t}),this._emit("end",e.endEvent),this.drag=null}align(e=!1){this.drag&&(e?(this._prepareAlign(),this._applyAlign()):(S.once(g.read,this._prepareAlign,this._alignId),S.once(g.write,this._applyAlign,this._alignId)))}updateSettings(e={}){this.settings=this._parseSettings(e,this.settings)}use(e){return e(this)}destroy(){this.isDestroyed||(this.isDestroyed=!0,this.stop(),this._sensorData.forEach(({onMove:e,onEnd:t},n)=>{n.off("start",e),n.off("move",e),n.off("cancel",t),n.off("end",t),n.off("destroy",t)}),this._sensorData.clear(),this._emit("destroy"),this._emitter.off())}};var Z=class{constructor(e,t){this._data=[],this._createObject=e,this._onPut=t}pick(){return this._data.length?this._data.pop():this._createObject()}put(e){this._data.indexOf(e)===-1&&(this._onPut&&this._onPut(e),this._data.push(e))}reset(){this._data.length=0}};import{getDistance as It}from"mezr";function Q(i,e={width:0,height:0,x:0,y:0,left:0,top:0,right:0,bottom:0}){return i&&(e.width=i.width,e.height=i.height,e.x=i.x,e.y=i.y,e.left=i.x,e.top=i.y,e.right=i.x+i.width,e.bottom=i.y+i.height),e}var At=Q(),Lt=Q();function lt(i,e){return It(Q(i,At),Q(e,Lt))}function ct(i,e,t={width:0,height:0,x:0,y:0}){let n=Math.max(i.x,e.x),r=Math.min(i.x+i.width,e.x+e.width);if(r<=n)return null;let s=Math.max(i.y,e.y),o=Math.min(i.y+i.height,e.y+e.height);return o<=s?null:(t.x=n,t.y=s,t.width=r-n,t.height=o-s,t)}function dt(i,e){let t=ct(i,e);return t?t.width*t.height:0}function Ce(i,e){let t=dt(i,e);if(!t)return 0;let n=Math.min(i.width,e.width)*Math.min(i.height,e.height);return t/n*100}import{getRect as Rt}from"mezr";function Oe(...i){let{width:e,height:t,left:n,top:r}=Rt(...i);return{width:e,height:t,x:n,y:r}}function C(i){return i instanceof Window}function Me(i){return C(i)||i===document.documentElement||i===document.body?window:i}function U(i){return C(i)?i.scrollX:i.scrollLeft}function Ie(i){return C(i)&&(i=document.documentElement),i.scrollWidth-i.clientWidth}function G(i){return C(i)?i.scrollY:i.scrollTop}function Ae(i){return C(i)&&(i=document.documentElement),i.scrollHeight-i.clientHeight}function Le(i,e){return!(i.x+i.width<=e.x||e.x+e.width<=i.x||i.y+i.height<=e.y||e.y+e.height<=i.y)}var ht={width:0,height:0,x:0,y:0},mt=50,O={direction:"none",threshold:0,distance:0,value:0,maxValue:0,duration:0,speed:0,deltaTime:0,isEnding:!1},u={x:1,y:2},N={forward:4,reverse:8},me={none:0,left:u.x|N.reverse,right:u.x|N.forward},ee={none:0,up:u.y|N.reverse,down:u.y|N.forward},E={...me,...ee};function Re(i){switch(i){case me.none:case ee.none:return"none";case me.left:return"left";case me.right:return"right";case ee.up:return"up";case ee.down:return"down";default:throw new Error(`Unknown direction value: ${i}`)}}function ut(i,e,t){let{left:n=0,right:r=0,top:s=0,bottom:o=0}=e;return n=Math.max(0,n),r=Math.max(0,r),s=Math.max(0,s),o=Math.max(0,o),t.width=i.width+n+r,t.height=i.height+s+o,t.x=i.x-n,t.y=i.y-s,t}function ue(i,e){return Math.ceil(i)>=Math.floor(e)}function ke(i,e){return Math.min(e/2,i)}function Ke(i,e,t,n){return Math.max(0,t+i*2+n*e-n)/2}var Ve=class{constructor(){this.positionX=0,this.positionY=0,this.directionX=E.none,this.directionY=E.none,this.overlapCheckRequestTime=0}},We=class{constructor(){this.element=null,this.requestX=null,this.requestY=null,this.scrollLeft=0,this.scrollTop=0}reset(){this.requestX&&(this.requestX.action=null),this.requestY&&(this.requestY.action=null),this.element=null,this.requestX=null,this.requestY=null,this.scrollLeft=0,this.scrollTop=0}addRequest(e){u.x&e.direction?(this.requestX&&this.removeRequest(this.requestX),this.requestX=e):(this.requestY&&this.removeRequest(this.requestY),this.requestY=e),e.action=this}removeRequest(e){this.requestX===e?(this.requestX=null,e.action=null):this.requestY===e&&(this.requestY=null,e.action=null)}computeScrollValues(){this.element&&(this.scrollLeft=this.requestX?this.requestX.value:U(this.element),this.scrollTop=this.requestY?this.requestY.value:G(this.element))}scroll(){this.element&&(this.element.scrollTo?this.element.scrollTo(this.scrollLeft,this.scrollTop):(this.element.scrollLeft=this.scrollLeft,this.element.scrollTop=this.scrollTop))}},Ne=class{constructor(){this.item=null,this.element=null,this.isActive=!1,this.isEnding=!1,this.direction=0,this.value=NaN,this.maxValue=0,this.threshold=0,this.distance=0,this.deltaTime=0,this.speed=0,this.duration=0,this.action=null}reset(){this.isActive&&this.onStop(),this.item=null,this.element=null,this.isActive=!1,this.isEnding=!1,this.direction=0,this.value=NaN,this.maxValue=0,this.threshold=0,this.distance=0,this.deltaTime=0,this.speed=0,this.duration=0,this.action=null}hasReachedEnd(){return N.forward&this.direction?ue(this.value,this.maxValue):this.value<=0}computeCurrentScrollValue(){return this.element?this.value!==this.value?u.x&this.direction?U(this.element):G(this.element):Math.max(0,Math.min(this.value,this.maxValue)):0}computeNextScrollValue(){let e=this.speed*(this.deltaTime/1e3),t=N.forward&this.direction?this.value+e:this.value-e;return Math.max(0,Math.min(t,this.maxValue))}computeSpeed(){if(!this.item||!this.element)return 0;let{speed:e}=this.item;return typeof e=="function"?(O.direction=Re(this.direction),O.threshold=this.threshold,O.distance=this.distance,O.value=this.value,O.maxValue=this.maxValue,O.duration=this.duration,O.speed=this.speed,O.deltaTime=this.deltaTime,O.isEnding=this.isEnding,e(this.element,O)):e}tick(e){return this.isActive||(this.isActive=!0,this.onStart()),this.deltaTime=e,this.value=this.computeCurrentScrollValue(),this.speed=this.computeSpeed(),this.value=this.computeNextScrollValue(),this.duration+=e,this.value}onStart(){if(!this.item||!this.element)return;let{onStart:e}=this.item;typeof e=="function"&&e(this.element,Re(this.direction))}onStop(){if(!this.item||!this.element)return;let{onStop:e}=this.item;typeof e=="function"&&e(this.element,Re(this.direction))}};function pt(i=500,e=.5,t=.25){let n=i*(e>0?1/e:1/0),r=i*(t>0?1/t:1/0);return function(s,o){let a=0;if(!o.isEnding)if(o.threshold>0){let d=o.threshold-Math.max(0,o.distance);a=i/o.threshold*d}else a=i;let c=o.speed;if(c===a)return a;let l=a;return c<a?(l=c+n*(o.deltaTime/1e3),Math.min(a,l)):(l=c-r*(o.deltaTime/1e3),Math.max(a,l))}}var pe=class{constructor(e={}){let{overlapCheckInterval:t=150}=e;this.items=[],this.settings={overlapCheckInterval:t},this._actions=[],this._isDestroyed=!1,this._isTicking=!1,this._tickTime=0,this._tickDeltaTime=0,this._requests={[u.x]:new Map,[u.y]:new Map},this._itemData=new Map,this._requestPool=new Z(()=>new Ne,n=>n.reset()),this._actionPool=new Z(()=>new We,n=>n.reset()),this._frameRead=this._frameRead.bind(this),this._frameWrite=this._frameWrite.bind(this)}_frameRead(e){this._isDestroyed||(e&&this._tickTime?(this._tickDeltaTime=e-this._tickTime,this._tickTime=e,this._updateItems(),this._updateRequests(),this._updateActions()):(this._tickTime=e,this._tickDeltaTime=0))}_frameWrite(){this._isDestroyed||this._applyActions()}_startTicking(){this._isTicking||(this._isTicking=!0,S.on(g.read,this._frameRead,this._frameRead),S.on(g.write,this._frameWrite,this._frameWrite))}_stopTicking(){this._isTicking&&(this._isTicking=!1,this._tickTime=0,this._tickDeltaTime=0,S.off(g.read,this._frameRead),S.off(g.write,this._frameWrite))}_requestItemScroll(e,t,n,r,s,o,a){let c=this._requests[t],l=c.get(e);l?(l.element!==n||l.direction!==r)&&l.reset():(l=this._requestPool.pick(),c.set(e,l)),l.item=e,l.element=n,l.direction=r,l.threshold=s,l.distance=o,l.maxValue=a}_cancelItemScroll(e,t){let n=this._requests[t],r=n.get(e);r&&(r.action&&r.action.removeRequest(r),this._requestPool.put(r),n.delete(e))}_checkItemOverlap(e,t,n){let{inertAreaSize:r,targets:s,clientRect:o}=e;if(!s.length){t&&this._cancelItemScroll(e,u.x),n&&this._cancelItemScroll(e,u.y);return}let a=this._itemData.get(e),c=a?.directionX,l=a?.directionY;if(!c&&!l){t&&this._cancelItemScroll(e,u.x),n&&this._cancelItemScroll(e,u.y);return}let d=null,p=-1/0,f=0,h=-1/0,m=E.none,x=0,v=0,y=null,b=-1/0,z=0,F=-1/0,ge=E.none,Be=0,Ue=0,Se=0;for(;Se<s.length;Se++){let M=s[Se],Ge=typeof M.threshold=="number"?M.threshold:mt,Ee=!!(t&&c&&M.axis!=="y"),ye=!!(n&&l&&M.axis!=="x"),R=M.priority||0;if((!Ee||R<p)&&(!ye||R<b))continue;let I=Me(M.element||M),ne=Ee?Ie(I):-1,ie=ye?Ae(I):-1;if(ne<=0&&ie<=0)continue;let D=Oe([I,"padding"],window),q=Ce(o,D)||-1/0;if(q===-1/0)if(M.padding&&Le(o,ut(D,M.padding,ht)))q=-(lt(o,D)||0);else continue;if(Ee&&R>=p&&ne>0&&(R>p||q>h)){let P=0,A=E.none,L=ke(Ge,D.width),j=Ke(L,r,o.width,D.width);c===E.right?(P=D.x+D.width+j-(o.x+o.width),P<=L&&!ue(U(I),ne)&&(A=E.right)):c===E.left&&(P=o.x-(D.x-j),P<=L&&U(I)>0&&(A=E.left)),A&&(d=I,p=R,f=L,h=q,m=A,x=P,v=ne)}if(ye&&R>=b&&ie>0&&(R>b||q>F)){let P=0,A=ee.none,L=ke(Ge,D.height),j=Ke(L,r,o.height,D.height);l===E.down?(P=D.y+D.height+j-(o.y+o.height),P<=L&&!ue(G(I),ie)&&(A=E.down)):l===E.up&&(P=o.y-(D.y-j),P<=L&&G(I)>0&&(A=E.up)),A&&(y=I,b=R,z=L,F=q,ge=A,Be=P,Ue=ie)}}t&&(d&&m?this._requestItemScroll(e,u.x,d,m,f,x,v):this._cancelItemScroll(e,u.x)),n&&(y&&ge?this._requestItemScroll(e,u.y,y,ge,z,Be,Ue):this._cancelItemScroll(e,u.y))}_updateScrollRequest(e){let t=e.item,{inertAreaSize:n,smoothStop:r,targets:s,clientRect:o}=t,a=null,c=0;for(;c<s.length;c++){let l=s[c],d=Me(l.element||l);if(d!==e.element)continue;let p=!!(u.x&e.direction);if(p){if(l.axis==="y")continue}else if(l.axis==="x")continue;let f=p?Ie(d):Ae(d);if(f<=0)break;let h=Oe([d,"padding"],window);if((Ce(o,h)||-1/0)===-1/0){let F=l.scrollPadding||l.padding;if(!(F&&Le(o,ut(h,F,ht))))break}let x=typeof l.threshold=="number"?l.threshold:mt,v=ke(x,p?h.width:h.height),y=Ke(v,n,p?o.width:o.height,p?h.width:h.height),b=0;if(e.direction===E.left?b=o.x-(h.x-y):e.direction===E.right?b=h.x+h.width+y-(o.x+o.width):e.direction===E.up?b=o.y-(h.y-y):b=h.y+h.height+y-(o.y+o.height),b>v)break;let z=p?U(d):G(d);if(a=N.forward&e.direction?ue(z,f):z<=0,a)break;return e.maxValue=f,e.threshold=v,e.distance=b,e.isEnding=!1,!0}return r===!0&&e.speed>0?(a===null&&(a=e.hasReachedEnd()),e.isEnding=!a):e.isEnding=!1,e.isEnding}_updateItems(){for(let e=0;e<this.items.length;e++){let t=this.items[e],n=this._itemData.get(t),{x:r,y:s}=t.position,o=n.positionX,a=n.positionY;r===o&&s===a||(n.directionX=r>o?E.right:r<o?E.left:n.directionX,n.directionY=s>a?E.down:s<a?E.up:n.directionY,n.positionX=r,n.positionY=s,n.overlapCheckRequestTime===0&&(n.overlapCheckRequestTime=this._tickTime))}}_updateRequests(){let e=this.items,t=this._requests[u.x],n=this._requests[u.y],r=0;for(;r<e.length;r++){let s=e[r],o=this._itemData.get(s),a=o.overlapCheckRequestTime,c=a>0&&this._tickTime-a>this.settings.overlapCheckInterval,l=!0,d=t.get(s);d&&d.isActive&&(l=!this._updateScrollRequest(d),l&&(c=!0,this._cancelItemScroll(s,u.x)));let p=!0,f=n.get(s);f&&f.isActive&&(p=!this._updateScrollRequest(f),p&&(c=!0,this._cancelItemScroll(s,u.y))),c&&(o.overlapCheckRequestTime=0,this._checkItemOverlap(s,l,p))}}_requestAction(e,t){let n=t===u.x,r=null,s=0;for(;s<this._actions.length;s++){if(r=this._actions[s],e.element!==r.element){r=null;continue}if(n?r.requestX:r.requestY){this._cancelItemScroll(e.item,t);return}break}r||(r=this._actionPool.pick()),r.element=e.element,r.addRequest(e),e.tick(this._tickDeltaTime),this._actions.push(r)}_updateActions(){let e=0;for(e=0;e<this.items.length;e++){let t=this.items[e],n=this._requests[u.x].get(t),r=this._requests[u.y].get(t);n&&this._requestAction(n,u.x),r&&this._requestAction(r,u.y)}for(e=0;e<this._actions.length;e++)this._actions[e].computeScrollValues()}_applyActions(){if(!this._actions.length)return;let e=0;for(e=0;e<this._actions.length;e++)this._actions[e].scroll(),this._actionPool.put(this._actions[e]);this._actions.length=0}addItem(e){if(this._isDestroyed||this._itemData.has(e))return;let{x:t,y:n}=e.position,r=new Ve;r.positionX=t,r.positionY=n,r.directionX=E.none,r.directionY=E.none,r.overlapCheckRequestTime=this._tickTime,this._itemData.set(e,r),this.items.push(e),this._isTicking||this._startTicking()}removeItem(e){if(this._isDestroyed)return;let t=this.items.indexOf(e);t!==-1&&(this._requests[u.x].get(e)&&(this._cancelItemScroll(e,u.x),this._requests[u.x].delete(e)),this._requests[u.y].get(e)&&(this._cancelItemScroll(e,u.y),this._requests[u.y].delete(e)),this._itemData.delete(e),this.items.splice(t,1),this._isTicking&&!this.items.length&&this._stopTicking())}isDestroyed(){return this._isDestroyed}isItemScrollingX(e){return!!this._requests[u.x].get(e)?.isActive}isItemScrollingY(e){return!!this._requests[u.y].get(e)?.isActive}isItemScrolling(e){return this.isItemScrollingX(e)||this.isItemScrollingY(e)}updateSettings(e={}){let{overlapCheckInterval:t=this.settings.overlapCheckInterval}=e;this.settings.overlapCheckInterval=t}destroy(){if(this._isDestroyed)return;let e=this.items.slice(0),t=0;for(;t<e.length;t++)this.removeItem(e[t]);this._actions.length=0,this._requestPool.reset(),this._actionPool.reset(),this._isDestroyed=!0}};var qe=new pe;var Xe={x:0,y:0},te={width:0,height:0,x:0,y:0};function kt(){return{targets:[],inertAreaSize:.2,speed:pt(),smoothStop:!1,getPosition:i=>{let{drag:e}=i,t=e?.items[0];if(t)return t.position;let n=e&&(e.event||e.startEvent);return Xe.x=n?n.x:0,Xe.y=n?n.y:0,Xe},getClientRect:i=>{let{drag:e}=i,t=e?.items[0];if(t&&t.element)return t.clientRect;let n=e&&(e.event||e.startEvent);return te.width=n?50:0,te.height=n?50:0,te.x=n?n.x-25:0,te.y=n?n.y-25:0,te},onStart:null,onStop:null}}var Ye=class{constructor(e,t){this._draggableAutoScroll=e,this._draggable=t,this._position={x:0,y:0},this._clientRect={width:0,height:0,x:0,y:0}}_getSettings(){return this._draggableAutoScroll.settings}get targets(){let{targets:e}=this._getSettings();return typeof e=="function"&&(e=e(this._draggable)),e}get position(){let e=this._position,{getPosition:t}=this._getSettings();return typeof t=="function"?Object.assign(e,t(this._draggable)):(e.x=0,e.y=0),e}get clientRect(){let e=this._clientRect,{getClientRect:t}=this._getSettings();return typeof t=="function"?Object.assign(e,t(this._draggable)):(e.width=0,e.height=0,e.x=0,e.y=0),e}get inertAreaSize(){return this._getSettings().inertAreaSize}get smoothStop(){return this._getSettings().smoothStop}get speed(){return this._getSettings().speed}get onStart(){return this._getSettings().onStart}get onStop(){return this._getSettings().onStop}},He=class{constructor(e,t={}){this.name="autoscroll",this.version="0.0.3",this.settings=this._parseSettings(t),this._autoScrollProxy=null,e.on("start",()=>{this._autoScrollProxy||(this._autoScrollProxy=new Ye(this,e),qe.addItem(this._autoScrollProxy))}),e.on("end",()=>{this._autoScrollProxy&&(qe.removeItem(this._autoScrollProxy),this._autoScrollProxy=null)})}_parseSettings(e,t=kt()){let{targets:n=t.targets,inertAreaSize:r=t.inertAreaSize,speed:s=t.speed,smoothStop:o=t.smoothStop,getPosition:a=t.getPosition,getClientRect:c=t.getClientRect,onStart:l=t.onStart,onStop:d=t.onStop}=e||{};return{targets:n,inertAreaSize:r,speed:s,smoothStop:o,getPosition:a,getClientRect:c,onStart:l,onStop:d}}updateSettings(e={}){this.settings=this._parseSettings(e,this.settings)}};function mr(i){return e=>{let t=new He(e,i),n=e;return n.plugins[t.name]=t,n}}var ft=new Set(["auto","scroll","overlay"]);function fe(i){let e=k(i);return!!(ft.has(e.overflowY)||ft.has(e.overflowX))}function gt(i){return i instanceof Document}function St(i,e=[]){let t=i?.parentNode;for(;t&&!gt(t);)t instanceof Element?(fe(t)&&e.push(t),t=t.parentNode):t instanceof ShadowRoot?t=t.host:t=t.parentNode;return e.push(window),e}function Kt(i){let e=[];return fe(i)&&e.push(i),St(i,e),e}function Dr(i={}){let e,t=0,n=null,r,{timeout:s=250,fallback:o=()=>!0}=i,a=d=>d.preventDefault(),c=d=>{if(t){if(e){d.cancelable&&d.preventDefault();return}e===void 0&&(d.cancelable&&d.timeStamp-t>s?(e=!0,d.preventDefault()):e=!1)}};return d=>{if(!(d.sensor instanceof H))return o(d);let{draggable:p,sensor:f,event:h}=d,m=h;if(m.pointerType==="touch"){if(m.type==="start"&&(m.srcEvent.type==="pointerdown"||m.srcEvent.type==="touchstart")){n=m.target;let x=n?Kt(n):[];x.forEach(y=>{y.addEventListener("touchmove",c,{passive:!1,capture:!0})});let v=()=>{t&&(p.off("end",v),p.sensors.forEach(y=>{y instanceof H&&y.off("end",v)}),n?.removeEventListener("contextmenu",a),x.forEach(y=>{y.removeEventListener("touchmove",c,{capture:!0})}),t=0,e=void 0,n=null,r=void window.clearTimeout(r))};e=void 0,t=m.srcEvent.timeStamp,n?.addEventListener("contextmenu",a),p.on("end",v),p.sensors.forEach(y=>{y instanceof H&&y.off("end",v)}),s>0&&(r=window.setTimeout(()=>{p.resolveStartPredicate(f),e=!0,r=void 0},s))}return e}return m.type==="start"&&!m.srcEvent.button}}function Vt(i,e){return Math.round(i/e)*e}function Et(i,e,t){let n=t-e,r=Math.abs(n);if(r>=i){let s=r%i;return Vt(n>0?n-s:n+s,i)}return 0}function Tr(i,e){return function({item:n,event:r,startEvent:s}){let{__snapX__:o=s.x,__snapY__:a=s.y}=n.data,c=Et(i,o,r.x),l=Et(e,a,r.y);return c&&(n.data.__snapX__=o+c),l&&(n.data.__snapY__=a+l),{x:c,y:l}}}export{u as AUTO_SCROLL_AXIS,N as AUTO_SCROLL_AXIS_DIRECTION,E as AUTO_SCROLL_DIRECTION,pe as AutoScroll,re as BaseMotionSensor,X as BaseSensor,at as Draggable,He as DraggableAutoScroll,Mt as DraggableDefaultSettings,Ze as KeyboardMotionSensor,Je as KeyboardSensor,H as PointerSensor,_ as SensorEventType,qe as autoScroll,mr as autoScrollPlugin,pt as autoScrollSmoothSpeed,Dr as createPointerSensorStartPredicate,Tr as createSnapModifier,T as keyboardMotionSensorDefaults,K as keyboardSensorDefaults,jt as setTicker,S as ticker,g as tickerPhases};
