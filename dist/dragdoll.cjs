"use strict";var ue=Object.defineProperty;var lt=Object.getOwnPropertyDescriptor;var ct=Object.getOwnPropertyNames;var dt=Object.prototype.hasOwnProperty;var ht=(r,e)=>{for(var t in e)ue(r,t,{get:e[t],enumerable:!0})},mt=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of ct(e))!dt.call(r,i)&&i!==t&&ue(r,i,{get:()=>e[i],enumerable:!(n=lt(e,i))||n.enumerable});return r};var ut=r=>mt(ue({},"__esModule",{value:!0}),r);var Tt={};ht(Tt,{AUTO_SCROLL_AXIS:()=>h,AUTO_SCROLL_AXIS_DIRECTION:()=>M,AUTO_SCROLL_DIRECTION:()=>p,AutoScroll:()=>j,BaseMotionSensor:()=>B,BaseSensor:()=>O,Draggable:()=>xe,DraggableAutoScroll:()=>ae,KeyboardMotionSensor:()=>ve,KeyboardSensor:()=>Ee,PointerSensor:()=>W,SensorEventType:()=>_,autoScroll:()=>se,autoScrollPlugin:()=>Dt,autoScrollSmoothSpeed:()=>We,createPointerSensorStartPredicate:()=>Pt,setTicker:()=>pt,ticker:()=>u,tickerReadPhase:()=>S,tickerWritePhase:()=>D});module.exports=ut(Tt);var _={start:"start",move:"move",cancel:"cancel",end:"end",destroy:"destroy"};var Ve=require("eventti");var O=class{constructor(){this.drag=null,this.isDestroyed=!1,this._emitter=new Ve.Emitter}_createDragData(e){return{x:e.x,y:e.y}}_updateDragData(e){this.drag&&(this.drag.x=e.x,this.drag.y=e.y)}_resetDragData(){this.drag=null}_start(e){this.isDestroyed||this.drag||(this.drag=this._createDragData(e),this._emitter.emit(_.start,e))}_move(e){this.drag&&(this._updateDragData(e),this._emitter.emit(_.move,e))}_end(e){this.drag&&(this._updateDragData(e),this._emitter.emit(_.end,e),this._resetDragData())}_cancel(e){this.drag&&(this._updateDragData(e),this._emitter.emit(_.cancel,e),this._resetDragData())}on(e,t,n){return this._emitter.on(e,t,n)}off(e,t){this._emitter.off(e,t)}cancel(){this.drag&&(this._emitter.emit(_.cancel,{type:_.cancel,x:this.drag.x,y:this.drag.y}),this._resetDragData())}destroy(){this.isDestroyed||(this.isDestroyed=!0,this.cancel(),this._emitter.emit(_.destroy,{type:_.destroy}),this._emitter.off())}};var Ue=require("tikki"),S=Symbol(),D=Symbol(),u=new Ue.Ticker({phases:[S,D]});function pt(r,e,t){S=e,D=t,u=r}var B=class extends O{constructor(){super();this.drag=null,this._direction={x:0,y:0},this._speed=0,this._tick=this._tick.bind(this)}_createDragData(t){return{...super._createDragData(t),time:0,deltaTime:0}}_start(t){this.isDestroyed||this.drag||(super._start(t),u.on(S,this._tick))}_end(t){this.drag&&(u.off(S,this._tick),super._end(t))}_cancel(t){this.drag&&(u.off(S,this._tick),super._cancel(t))}_tick(t){if(this.drag)if(t&&this.drag.time){this.drag.deltaTime=t-this.drag.time,this.drag.time=t;let n={type:"tick",time:this.drag.time,deltaTime:this.drag.deltaTime};if(this._emitter.emit("tick",n),!this.drag)return;let i=this._speed*(this.drag.deltaTime/1e3),s=this._direction.x*i,o=this._direction.y*i;(s||o)&&this._move({type:"move",x:this.drag.x+s,y:this.drag.y+o})}else this.drag.time=t,this.drag.deltaTime=0}};var Fe=require("eventti");function pe(r,e){if("pointerId"in r)return r.pointerId===e?r:null;if("changedTouches"in r){let t=0;for(;t<r.changedTouches.length;t++)if(r.changedTouches[t].identifier===e)return r.changedTouches[t];return null}return r}function ze(r){return"pointerType"in r?r.pointerType:"touches"in r?"touch":"mouse"}function Be(r){return"pointerId"in r?r.pointerId:"changedTouches"in r?r.changedTouches[0]?r.changedTouches[0].identifier:null:-1}var fe=typeof window<"u"&&typeof window.document<"u",Z=(()=>{let r=!1;try{let e=Object.defineProperty({},"passive",{get:function(){r=!0}});window.addEventListener("testPassive",null,e),window.removeEventListener("testPassive",null,e)}catch{}return r})(),He=fe&&"ontouchstart"in window,Ge=fe&&!!window.PointerEvent,zt=!!(fe&&navigator.vendor&&navigator.vendor.indexOf("Apple")>-1&&navigator.userAgent&&navigator.userAgent.indexOf("CriOS")==-1&&navigator.userAgent.indexOf("FxiOS")==-1);function ge(r={}){let{capture:e=!0,passive:t=!0}=r;return Z?{capture:e,passive:t}:{capture:e}}function Se(r){return r==="auto"||r===void 0?Ge?"pointer":He?"touch":"mouse":r}var ft={start:"pointerdown",move:"pointermove",cancel:"pointercancel",end:"pointerup"},gt={start:"touchstart",move:"touchmove",cancel:"touchcancel",end:"touchend"},St={start:"mousedown",move:"mousemove",cancel:"",end:"mouseup"},Y={pointer:ft,touch:gt,mouse:St},W=class{constructor(e,t={}){let{listenerOptions:n={},sourceEvents:i="auto",startPredicate:s=o=>!("button"in o&&o.button>0)}=t;this.element=e,this.drag=null,this.isDestroyed=!1,this._areWindowListenersBound=!1,this._startPredicate=s,this._listenerOptions=ge(n),this._sourceEvents=Se(i),this._emitter=new Fe.Emitter,this._onStart=this._onStart.bind(this),this._onMove=this._onMove.bind(this),this._onCancel=this._onCancel.bind(this),this._onEnd=this._onEnd.bind(this),e.addEventListener(Y[this._sourceEvents].start,this._onStart,this._listenerOptions)}_getTrackedPointerEventData(e){return this.drag?pe(e,this.drag.pointerId):null}_onStart(e){if(this.isDestroyed||this.drag||!this._startPredicate(e))return;let t=Be(e);if(t===null)return;let n=pe(e,t);if(n===null)return;let i={pointerId:t,pointerType:ze(e),x:n.clientX,y:n.clientY};this.drag=i;let s={...i,type:_.start,srcEvent:e,target:n.target};this._emitter.emit(s.type,s),this.drag&&this._bindWindowListeners()}_onMove(e){if(!this.drag)return;let t=this._getTrackedPointerEventData(e);if(!t)return;this.drag.x=t.clientX,this.drag.y=t.clientY;let n={type:_.move,srcEvent:e,target:t.target,...this.drag};this._emitter.emit(n.type,n)}_onCancel(e){if(!this.drag)return;let t=this._getTrackedPointerEventData(e);if(!t)return;this.drag.x=t.clientX,this.drag.y=t.clientY;let n={type:_.cancel,srcEvent:e,target:t.target,...this.drag};this._emitter.emit(n.type,n),this._resetDrag()}_onEnd(e){if(!this.drag)return;let t=this._getTrackedPointerEventData(e);if(!t)return;this.drag.x=t.clientX,this.drag.y=t.clientY;let n={type:_.end,srcEvent:e,target:t.target,...this.drag};this._emitter.emit(n.type,n),this._resetDrag()}_bindWindowListeners(){if(this._areWindowListenersBound)return;let{move:e,end:t,cancel:n}=Y[this._sourceEvents];window.addEventListener(e,this._onMove,this._listenerOptions),window.addEventListener(t,this._onEnd,this._listenerOptions),n&&window.addEventListener(n,this._onCancel,this._listenerOptions),this._areWindowListenersBound=!0}_unbindWindowListeners(){if(this._areWindowListenersBound){let{move:e,end:t,cancel:n}=Y[this._sourceEvents];window.removeEventListener(e,this._onMove,this._listenerOptions),window.removeEventListener(t,this._onEnd,this._listenerOptions),n&&window.removeEventListener(n,this._onCancel,this._listenerOptions),this._areWindowListenersBound=!1}}_resetDrag(){this.drag=null,this._unbindWindowListeners()}cancel(){if(!this.drag)return;let e={type:_.cancel,srcEvent:null,target:null,...this.drag};this._emitter.emit(e.type,e),this._resetDrag()}updateSettings(e){if(this.isDestroyed)return;let{listenerOptions:t,sourceEvents:n,startPredicate:i}=e,s=Se(n),o=ge(t);i&&this._startPredicate!==i&&(this._startPredicate=i),(t&&(this._listenerOptions.capture!==o.capture||this._listenerOptions.passive===o.passive)||n&&this._sourceEvents!==s)&&(this.element.removeEventListener(Y[this._sourceEvents].start,this._onStart,this._listenerOptions),this._unbindWindowListeners(),this.cancel(),n&&(this._sourceEvents=s),t&&o&&(this._listenerOptions=o),this.element.addEventListener(Y[this._sourceEvents].start,this._onStart,this._listenerOptions))}on(e,t,n){return this._emitter.on(e,t,n)}off(e,t){this._emitter.off(e,t)}destroy(){this.isDestroyed||(this.isDestroyed=!0,this.cancel(),this._emitter.emit(_.destroy,{type:_.destroy}),this._emitter.off(),this.element.removeEventListener(Y[this._sourceEvents].start,this._onStart,this._listenerOptions))}};var Ee=class extends O{constructor(t={}){super();let{moveDistance:n=25,startPredicate:i=l=>{if((l.key==="Enter"||l.key===" ")&&document.activeElement&&document.activeElement!==document.body){let{left:a,top:d}=document.activeElement.getBoundingClientRect();return{x:a,y:d}}return null},movePredicate:s=(l,a,d)=>{if(!a.drag)return null;switch(l.key){case"ArrowLeft":return{x:a.drag.x-d,y:a.drag.y};case"ArrowRight":return{x:a.drag.x+d,y:a.drag.y};case"ArrowUp":return{x:a.drag.x,y:a.drag.y-d};case"ArrowDown":return{x:a.drag.x,y:a.drag.y+d};default:return null}},cancelPredicate:o=(l,a)=>a.drag&&l.key==="Escape"?{x:a.drag.x,y:a.drag.y}:null,endPredicate:c=(l,a)=>a.drag&&(l.key==="Enter"||l.key===" ")?{x:a.drag.x,y:a.drag.y}:null}=t;this._moveDistance=n,this._startPredicate=i,this._movePredicate=s,this._cancelPredicate=o,this._endPredicate=c,this.cancel=this.cancel.bind(this),this._onKeyDown=this._onKeyDown.bind(this),document.addEventListener("keydown",this._onKeyDown),window.addEventListener("blur",this.cancel),window.addEventListener("visibilitychange",this.cancel)}_onKeyDown(t){if(!this.drag){let o=this._startPredicate(t,this,this._moveDistance);o&&(t.preventDefault(),this._start({type:"start",x:o.x,y:o.y,srcEvent:t}));return}let n=this._cancelPredicate(t,this,this._moveDistance);if(n){t.preventDefault(),this._cancel({type:"cancel",x:n.x,y:n.y,srcEvent:t});return}let i=this._endPredicate(t,this,this._moveDistance);if(i){t.preventDefault(),this._end({type:"end",x:i.x,y:i.y,srcEvent:t});return}let s=this._movePredicate(t,this,this._moveDistance);if(s){t.preventDefault(),this._move({type:"move",x:s.x,y:s.y,srcEvent:t});return}}updateSettings(t={}){t.moveDistance!==void 0&&(this._moveDistance=t.moveDistance),t.startPredicate!==void 0&&(this._startPredicate=t.startPredicate),t.movePredicate!==void 0&&(this._movePredicate=t.movePredicate),t.cancelPredicate!==void 0&&(this._cancelPredicate=t.cancelPredicate),t.endPredicate!==void 0&&(this._endPredicate=t.endPredicate)}destroy(){this.isDestroyed||(super.destroy(),document.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("blur",this.cancel),window.removeEventListener("visibilitychange",this.cancel))}};var Et=["start","cancel","end","moveLeft","moveRight","moveUp","moveDown"];function ee(r,e){if(!r.size||!e.size)return 1/0;let t=1/0;for(let n of r){let i=e.get(n);i!==void 0&&i<t&&(t=i)}return t}var ve=class extends B{constructor(t={}){super();let{startPredicate:n=()=>{if(document.activeElement){let{left:y,top:g}=document.activeElement.getBoundingClientRect();return{x:y,y:g}}return null},computeSpeed:i=()=>500,startKeys:s=[" ","Enter"],moveLeftKeys:o=["ArrowLeft"],moveRightKeys:c=["ArrowRight"],moveUpKeys:l=["ArrowUp"],moveDownKeys:a=["ArrowDown"],cancelKeys:d=["Escape"],endKeys:m=[" ","Enter"]}=t;this._computeSpeed=i,this._startPredicate=n,this._startKeys=new Set(s),this._cancelKeys=new Set(d),this._endKeys=new Set(m),this._moveLeftKeys=new Set(o),this._moveRightKeys=new Set(c),this._moveUpKeys=new Set(l),this._moveDownKeys=new Set(a),this._moveKeys=new Set([...o,...c,...l,...a]),this._moveKeyTimestamps=new Map,this._onKeyDown=this._onKeyDown.bind(this),this._onKeyUp=this._onKeyUp.bind(this),this._onTick=this._onTick.bind(this),this.on("tick",this._onTick),document.addEventListener("keydown",this._onKeyDown),document.addEventListener("keyup",this._onKeyUp),window.addEventListener("blur",this.cancel),window.addEventListener("visibilitychange",this.cancel)}_end(t){this.drag&&(this._moveKeyTimestamps.clear(),this._direction.x=0,this._direction.y=0,super._end(t))}_cancel(t){this.drag&&(this._moveKeyTimestamps.clear(),this._direction.x=0,this._direction.y=0,super._cancel(t))}_updateDirection(){let t=ee(this._moveLeftKeys,this._moveKeyTimestamps),n=ee(this._moveRightKeys,this._moveKeyTimestamps),i=ee(this._moveUpKeys,this._moveKeyTimestamps),s=ee(this._moveDownKeys,this._moveKeyTimestamps),o=t===n?0:t<n?-1:1,c=i===s?0:i<s?-1:1;if(!(o===0||c===0)){let l=1/(Math.sqrt(o*o+c*c)||1);o*=l,c*=l}this._direction.x=o,this._direction.y=c}_onTick(){this._speed=this._computeSpeed(this)}_onKeyUp(t){this._moveKeyTimestamps.get(t.key)&&(this._moveKeyTimestamps.delete(t.key),this._updateDirection())}_onKeyDown(t){if(!this.drag){if(this._startKeys.has(t.key)){let n=this._startPredicate(t,this);n&&(t.preventDefault(),this._start({type:"start",x:n.x,y:n.y}))}return}if(this._cancelKeys.has(t.key)){t.preventDefault(),this._cancel({type:"cancel",x:this.drag.x,y:this.drag.y});return}if(this._endKeys.has(t.key)){t.preventDefault(),this._end({type:"end",x:this.drag.x,y:this.drag.y});return}if(this._moveKeys.has(t.key)){t.preventDefault(),this._moveKeyTimestamps.get(t.key)||(this._moveKeyTimestamps.set(t.key,Date.now()),this._updateDirection());return}}updateSettings(t={}){let n=!1;if(t.startPredicate!==void 0&&(this._startPredicate=t.startPredicate),t.computeSpeed!==void 0&&(this._computeSpeed=t.computeSpeed),Et.forEach((i,s)=>{let o=`${i}Keys`,c=t[o];c!==void 0&&(this[`_${o}`]=new Set(c),s>=3&&(n=!0))}),n){let i=[...this._moveLeftKeys,...this._moveRightKeys,...this._moveUpKeys,...this._moveDownKeys];[...this._moveKeys].every((o,c)=>i[c]===o)||(this._moveKeys=new Set(i),this._moveKeyTimestamps.clear(),this._updateDirection())}}destroy(){this.isDestroyed||(super.destroy(),this.off("tick",this._onTick),document.removeEventListener("keydown",this._onKeyDown),document.removeEventListener("keyup",this._onKeyUp),window.removeEventListener("blur",this.cancel),window.removeEventListener("visibilitychange",this.cancel))}};var Qe=require("eventti"),De=require("mezr");var te=class{constructor(){this.sensor=null,this.isEnded=!1,this.isStarted=!1,this.startEvent=null,this.nextMoveEvent=null,this.prevMoveEvent=null,this.endEvent=null,this.items=[]}};var ne=class{constructor(e,t,n,i,s){this.element=e,this.elementContainer=t,this.elementOffsetContainer=n,this.dragContainer=i,this.dragOffsetContainer=s,this.initialTransform="",this.frozenProps=null,this.unfrozenProps=null,this.x=0,this.y=0,this.pX=0,this.pY=0,this._updateDiffX=0,this._updateDiffY=0,this._moveDiffX=0,this._moveDiffY=0,this._containerDiffX=0,this._containerDiffY=0}};var _e=require("mezr");function ye(r,e,t={left:0,top:0}){if(t.left=0,t.top=0,r===e)return t;let n=(0,_e.getOffset)([r,"padding"]),i=(0,_e.getOffset)([e,"padding"]);return t.left=i.left-n.left,t.top=i.top-n.top,t}var je=new WeakMap;function re(r){let e=je.get(r)?.deref();return e||(e=window.getComputedStyle(r,null),je.set(r,new WeakRef(e))),e}var vt="matrix(1, 0, 0, 1, 0, 0)",_t="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)",$e=Z?{capture:!0,passive:!0}:!0,Je={left:0,top:0},be={x:0,y:0};function yt(){return{container:null,startPredicate:()=>!0,getElements:()=>null,releaseElements:()=>null,getFrozenProps:()=>null,getStartPosition:()=>({x:0,y:0}),setPosition:({item:r,x:e,y:t})=>{r.element.style.transform=`translate(${e}px, ${t}px) ${r.initialTransform}`},getPositionChange:({event:r,prevEvent:e})=>(be.x=r.x-e.x,be.y=r.y-e.y,be)}}var xe=class{constructor(e,t={}){this.sensors=e,this.settings=this._parseSettings(t),this.plugins={},this.drag=null,this.isDestroyed=!1,this._sensorData=new Map,this._emitter=new Qe.Emitter,this._startId=Symbol(),this._moveId=Symbol(),this._updateId=Symbol(),this._onMove=this._onMove.bind(this),this._onScroll=this._onScroll.bind(this),this._onEnd=this._onEnd.bind(this),this._prepareStart=this._prepareStart.bind(this),this._applyStart=this._applyStart.bind(this),this._prepareMove=this._prepareMove.bind(this),this._applyMove=this._applyMove.bind(this),this._preparePositionUpdate=this._preparePositionUpdate.bind(this),this._applyPositionUpdate=this._applyPositionUpdate.bind(this),this.sensors.forEach(n=>{this._sensorData.set(n,{predicateState:0,predicateEvent:null,onMove:o=>this._onMove(o,n),onEnd:o=>this._onEnd(o,n)});let{onMove:i,onEnd:s}=this._sensorData.get(n);n.on("start",i),n.on("move",i),n.on("cancel",s),n.on("end",s),n.on("destroy",s)})}_parseSettings(e,t=yt()){let{container:n=t.container,startPredicate:i=t.startPredicate,getElements:s=t.getElements,releaseElements:o=t.releaseElements,getFrozenProps:c=t.getFrozenProps,getStartPosition:l=t.getStartPosition,setPosition:a=t.setPosition,getPositionChange:d=t.getPositionChange}=e||{};return{container:n,startPredicate:i,getElements:s,releaseElements:o,getFrozenProps:c,getStartPosition:l,setPosition:a,getPositionChange:d}}_emit(e,...t){this._emitter.emit(e,...t)}_onMove(e,t){let n=this._sensorData.get(t);if(n)switch(n.predicateState){case 0:{n.predicateEvent=e;let i=this.settings.startPredicate({draggable:this,sensor:t,event:e});i===!0?this.resolveStartPredicate(t):i===!1&&this.rejectStartPredicate(t);break}case 1:{this.drag&&(this.drag.nextMoveEvent=e,u.once(S,this._prepareMove,this._moveId),u.once(D,this._applyMove,this._moveId));break}}}_onScroll(){this.updatePosition()}_onEnd(e,t){let n=this._sensorData.get(t);n&&(this.drag?n.predicateState===1&&(this.drag.endEvent=e,this._sensorData.forEach(i=>{i.predicateState=0,i.predicateEvent=null}),this.stop()):(n.predicateState=0,n.predicateEvent=null))}_prepareStart(){let{drag:e}=this;if(!e||!e.startEvent)return;let t=this.settings.getElements({draggable:this,sensor:e.sensor,startEvent:e.startEvent})||[];e.items=t.map(n=>{if(!n.isConnected)throw new Error("Element is not connected");let i=n.parentElement,s=(0,De.getOffsetContainer)(n);if(!s)throw new Error("Offset container could not be computed for the element!");let o=this.settings.container||i,c=o===i?s:(0,De.getOffsetContainer)(n,{container:o});if(!c)throw new Error("Drag offset container could not be computed for the element!");let l=new ne(n,i,s,o,c),a=n.getBoundingClientRect();if(l.x=a.left,l.y=a.top,s!==c){let{left:b,top:f}=ye(c,s,Je);l._containerDiffX=b,l._containerDiffY=f}let d=re(n),{transform:m}=d;m&&m!=="none"&&m!==vt&&m!==_t&&(l.initialTransform=m);let{x:y,y:g}=this.settings.getStartPosition({draggable:this,sensor:e.sensor,item:l,style:d});l.pX=y,l.pY=g;let E=this.settings.getFrozenProps({draggable:this,sensor:e.sensor,item:l,style:d});if(Array.isArray(E))if(E.length){let b={};for(let f of E)b[f]=d[f];l.frozenProps=b}else l.frozenProps=null;else l.frozenProps=E;if(l.frozenProps){let b={};for(let f in l.frozenProps)l.frozenProps.hasOwnProperty(f)&&(b[f]=n.style[f]);l.unfrozenProps=b}return l}),this._emit("preparestart",e.startEvent)}_applyStart(){let e=this.drag;if(!e||!e.startEvent)return;let{container:t}=this.settings;for(let n of e.items)t&&n.element.parentElement!==t&&(t.appendChild(n.element),n.pX+=n._containerDiffX,n.pY+=n._containerDiffY),n.frozenProps&&Object.assign(n.element.style,n.frozenProps),this.settings.setPosition({phase:"start",draggable:this,sensor:e.sensor,item:n,x:n.pX,y:n.pY});window.addEventListener("scroll",this._onScroll,$e),e.isStarted=!0,this._emit("start",e.startEvent)}_prepareMove(){let{drag:e}=this;if(!e||!e.startEvent)return;let t=e.nextMoveEvent,n=e.prevMoveEvent||e.startEvent;if(!(!t||t===n)){for(let i of e.items){let{x:s,y:o}=this.settings.getPositionChange({draggable:this,sensor:e.sensor,item:i,startEvent:e.startEvent,prevEvent:n,event:t});s&&(i.pX=i.pX-i._moveDiffX+s,i.x=i.x-i._moveDiffX+s,i._moveDiffX=s),o&&(i.pY=i.pY-i._moveDiffY+o,i.y=i.y-i._moveDiffY+o,i._moveDiffY=o)}e.prevMoveEvent=t,this._emit("preparemove",t)}}_applyMove(){let{drag:e}=this;if(!(!e||!e.nextMoveEvent)){for(let t of e.items)t._moveDiffX=0,t._moveDiffY=0;for(let t of e.items)this.settings.setPosition({phase:"move",draggable:this,sensor:e.sensor,item:t,x:t.pX,y:t.pY});this._emit("move",e.nextMoveEvent)}}_preparePositionUpdate(){let{drag:e}=this;if(e)for(let t of e.items){if(t.elementOffsetContainer!==t.dragOffsetContainer){let{left:c,top:l}=ye(t.dragOffsetContainer,t.elementOffsetContainer,Je);t._containerDiffX=c,t._containerDiffY=l}let{left:n,top:i}=t.element.getBoundingClientRect(),s=t.x-t._moveDiffX-n;t.pX=t.pX-t._updateDiffX+s,t._updateDiffX=s;let o=t.y-t._moveDiffY-i;t.pY=t.pY-t._updateDiffY+o,t._updateDiffY=o}}_applyPositionUpdate(){let{drag:e}=this;if(e)for(let t of e.items)t._updateDiffX=0,t._updateDiffY=0,this.settings.setPosition({phase:"move",draggable:this,sensor:e.sensor,item:t,x:t.pX,y:t.pY})}on(e,t,n){return this._emitter.on(e,t,n)}off(e,t){this._emitter.off(e,t)}resolveStartPredicate(e,t){let n=this._sensorData.get(e);if(!n)return;let i=t||n.predicateEvent;n.predicateState===0&&i&&(n.predicateState=1,n.predicateEvent=null,this.drag=new te,this.drag.sensor=e,this.drag.startEvent=i,this._sensorData.forEach((s,o)=>{o!==e&&(s.predicateState=2,s.predicateEvent=null)}),u.once(S,this._prepareStart,this._startId),u.once(D,this._applyStart,this._startId))}rejectStartPredicate(e){let t=this._sensorData.get(e);t?.predicateState===0&&(t.predicateState=2,t.predicateEvent=null)}stop(){let{drag:e}=this;if(!(!e||e.isEnded)){if(e.isEnded=!0,u.off(S,this._startId),u.off(D,this._startId),u.off(S,this._moveId),u.off(D,this._moveId),u.off(S,this._updateId),u.off(D,this._updateId),e.isStarted){window.removeEventListener("scroll",this._onScroll,$e);let t=[];for(let n of e.items){if(t.push(n.element),n.elementContainer&&n.element.parentElement!==n.elementContainer&&(n.pX-=n._containerDiffX,n.pY-=n._containerDiffY,n._containerDiffX=0,n._containerDiffY=0,n.elementContainer.appendChild(n.element)),n.unfrozenProps)for(let i in n.unfrozenProps)n.element.style[i]=n.unfrozenProps[i]||"";this.settings.setPosition({phase:"end",draggable:this,sensor:e.sensor,item:n,x:n.pX,y:n.pY})}t.length&&this.settings.releaseElements({draggable:this,sensor:e.sensor,elements:t})}this._emit("end",e.endEvent),this.drag=null}}updatePosition(e=!1){this.drag&&(e?(this._preparePositionUpdate(),this._applyPositionUpdate()):(u.once(S,this._preparePositionUpdate,this._updateId),u.once(D,this._applyPositionUpdate,this._updateId)))}updateSettings(e={}){this.settings=this._parseSettings(e,this.settings)}use(e){return e(this)}destroy(){this.isDestroyed||(this.isDestroyed=!0,this.stop(),this._sensorData.forEach(({onMove:e,onEnd:t},n)=>{n.off("start",e),n.off("move",e),n.off("cancel",t),n.off("end",t),n.off("destroy",t)}),this._sensorData.clear(),this._emit("destroy"),this._emitter.off())}};var it=require("eventti"),F=require("mezr");var H=class{constructor(e,t){this._data=[],this._createObject=e,this._onPut=t}pick(){return this._data.length?this._data.pop():this._createObject()}put(e){this._data.indexOf(e)===-1&&(this._onPut&&this._onPut(e),this._data.push(e))}reset(){this._data.length=0}};var Ze=require("mezr");function et(r,e){let t=(0,Ze.getIntersection)(r,e);return t?t.width*t.height:0}function Pe(r,e){let t=et(r,e);if(!t)return 0;let n=Math.min(r.width,e.width)*Math.min(r.height,e.height);return t/n*100}function w(r){return r instanceof Window}function Te(r){return w(r)||r===document.documentElement||r===document.body?window:r}function N(r){return w(r)?r.pageXOffset:r.scrollLeft}function we(r){return w(r)&&(r=document.documentElement),r.scrollWidth-r.clientWidth}function q(r){return w(r)?r.pageYOffset:r.scrollTop}function Ie(r){return w(r)&&(r=document.documentElement),r.scrollHeight-r.clientHeight}function Ae(r,e){return!(r.right<=e.left||e.right<=r.left||r.bottom<=e.top||e.bottom<=r.top)}var Ke={width:0,height:0,left:0,right:0,top:0,bottom:0},tt={...Ke},nt=50,I={direction:"none",threshold:0,distance:0,value:0,maxValue:0,duration:0,speed:0,deltaTime:0,isEnding:!1},h={x:1,y:2},M={forward:4,reverse:8},ie={none:0,left:h.x|M.reverse,right:h.x|M.forward},G={none:0,up:h.y|M.reverse,down:h.y|M.forward},p={...ie,...G};function ke(r){switch(r){case ie.none:case G.none:return"none";case ie.left:return"left";case ie.right:return"right";case G.up:return"up";case G.down:return"down";default:throw new Error(`Unknown direction value: ${r}`)}}function rt(r,e,t){let{left:n=0,right:i=0,top:s=0,bottom:o=0}=e;return n=Math.max(0,n),i=Math.max(0,i),s=Math.max(0,s),o=Math.max(0,o),t.width=r.width+n+i,t.height=r.height+s+o,t.left=r.left-n,t.top=r.top-s,t.right=r.right+i,t.bottom=r.bottom+o,t}function oe(r,e){return Math.ceil(r)>=Math.floor(e)}function Ce(r,e){return Math.min(e/2,r)}function Le(r,e,t,n){return Math.max(0,t+r*2+n*e-n)/2}var Re=class{constructor(){this.positionX=0,this.positionY=0,this.directionX=p.none,this.directionY=p.none,this.overlapCheckRequestTime=0}},Me=class{constructor(){this.element=null,this.requestX=null,this.requestY=null,this.scrollLeft=0,this.scrollTop=0}reset(){this.requestX&&(this.requestX.action=null),this.requestY&&(this.requestY.action=null),this.element=null,this.requestX=null,this.requestY=null,this.scrollLeft=0,this.scrollTop=0}addRequest(e){h.x&e.direction?(this.requestX&&this.removeRequest(this.requestX),this.requestX=e):(this.requestY&&this.removeRequest(this.requestY),this.requestY=e),e.action=this}removeRequest(e){this.requestX===e?(this.requestX=null,e.action=null):this.requestY===e&&(this.requestY=null,e.action=null)}computeScrollValues(){this.element&&(this.scrollLeft=this.requestX?this.requestX.value:N(this.element),this.scrollTop=this.requestY?this.requestY.value:q(this.element))}scroll(){this.element&&(this.element.scrollTo?this.element.scrollTo(this.scrollLeft,this.scrollTop):(this.element.scrollLeft=this.scrollLeft,this.element.scrollTop=this.scrollTop))}},Oe=class{constructor(){this.item=null,this.element=null,this.isActive=!1,this.isEnding=!1,this.direction=0,this.value=NaN,this.maxValue=0,this.threshold=0,this.distance=0,this.deltaTime=0,this.speed=0,this.duration=0,this.action=null}reset(){this.isActive&&this.onStop(),this.item=null,this.element=null,this.isActive=!1,this.isEnding=!1,this.direction=0,this.value=NaN,this.maxValue=0,this.threshold=0,this.distance=0,this.deltaTime=0,this.speed=0,this.duration=0,this.action=null}hasReachedEnd(){return M.forward&this.direction?oe(this.value,this.maxValue):this.value<=0}computeCurrentScrollValue(){return this.element?this.value!==this.value?h.x&this.direction?N(this.element):q(this.element):Math.max(0,Math.min(this.value,this.maxValue)):0}computeNextScrollValue(){let e=this.speed*(this.deltaTime/1e3),t=M.forward&this.direction?this.value+e:this.value-e;return Math.max(0,Math.min(t,this.maxValue))}computeSpeed(){if(!this.item||!this.element)return 0;let{speed:e}=this.item;return typeof e=="function"?(I.direction=ke(this.direction),I.threshold=this.threshold,I.distance=this.distance,I.value=this.value,I.maxValue=this.maxValue,I.duration=this.duration,I.speed=this.speed,I.deltaTime=this.deltaTime,I.isEnding=this.isEnding,e(this.element,I)):e}tick(e){return this.isActive||(this.isActive=!0,this.onStart()),this.deltaTime=e,this.value=this.computeCurrentScrollValue(),this.speed=this.computeSpeed(),this.value=this.computeNextScrollValue(),this.duration+=e,this.value}onStart(){if(!this.item||!this.element)return;let{onStart:e}=this.item;typeof e=="function"&&e(this.element,ke(this.direction))}onStop(){if(!this.item||!this.element)return;let{onStop:e}=this.item;typeof e=="function"&&e(this.element,ke(this.direction))}};function We(r=500,e=.5,t=.25){let n=r*(e>0?1/e:1/0),i=r*(t>0?1/t:1/0);return function(s,o){let c=0;if(!o.isEnding)if(o.threshold>0){let d=o.threshold-Math.max(0,o.distance);c=r/o.threshold*d}else c=r;let l=o.speed;if(l===c)return c;let a=c;return l<c?(a=l+n*(o.deltaTime/1e3),Math.min(c,a)):(a=l-i*(o.deltaTime/1e3),Math.max(c,a))}}var j=class{constructor(e={}){let{overlapCheckInterval:t=150}=e;this.items=[],this.settings={overlapCheckInterval:t},this._actions=[],this._isDestroyed=!1,this._isTicking=!1,this._tickTime=0,this._tickDeltaTime=0,this._requests={[h.x]:new Map,[h.y]:new Map},this._itemData=new Map,this._requestPool=new H(()=>new Oe,n=>n.reset()),this._actionPool=new H(()=>new Me,n=>n.reset()),this._emitter=new it.Emitter,this._frameRead=this._frameRead.bind(this),this._frameWrite=this._frameWrite.bind(this)}_frameRead(e){this._isDestroyed||(e&&this._tickTime?(this._tickDeltaTime=e-this._tickTime,this._tickTime=e,this._updateItems(),this._updateRequests(),this._updateActions()):(this._tickTime=e,this._tickDeltaTime=0))}_frameWrite(){this._isDestroyed||this._applyActions()}_startTicking(){this._isTicking||(this._isTicking=!0,u.on(S,this._frameRead),u.on(D,this._frameWrite))}_stopTicking(){this._isTicking&&(this._isTicking=!1,this._tickTime=0,this._tickDeltaTime=0,u.off(S,this._frameRead),u.off(D,this._frameWrite))}_getItemClientRect(e,t={width:0,height:0,left:0,right:0,top:0,bottom:0}){let{clientRect:n}=e;return t.left=n.left,t.top=n.top,t.width=n.width,t.height=n.height,t.right=n.left+n.width,t.bottom=n.top+n.height,t}_requestItemScroll(e,t,n,i,s,o,c){let l=this._requests[t],a=l.get(e);a?(a.element!==n||a.direction!==i)&&a.reset():(a=this._requestPool.pick(),l.set(e,a)),a.item=e,a.element=n,a.direction=i,a.threshold=s,a.distance=o,a.maxValue=c}_cancelItemScroll(e,t){let n=this._requests[t],i=n.get(e);i&&(i.action&&i.action.removeRequest(i),this._requestPool.put(i),n.delete(e))}_checkItemOverlap(e,t,n){let{inertAreaSize:i,targets:s}=e;if(!s.length){t&&this._cancelItemScroll(e,h.x),n&&this._cancelItemScroll(e,h.y);return}let o=this._itemData.get(e),c=o?.directionX,l=o?.directionY;if(!c&&!l){t&&this._cancelItemScroll(e,h.x),n&&this._cancelItemScroll(e,h.y);return}let a=this._getItemClientRect(e,Ke),d=null,m=-1/0,y=0,g=-1/0,E=p.none,b=0,f=0,v=null,x=-1/0,V=0,U=-1/0,ce=p.none,Ye=0,Ne=0,de=0;for(;de<s.length;de++){let A=s[de],qe=typeof A.threshold=="number"?A.threshold:nt,he=!!(t&&c&&A.axis!=="y"),me=!!(n&&l&&A.axis!=="x"),R=A.priority||0;if((!he||R<m)&&(!me||R<x))continue;let k=Te(A.element||A),J=he?we(k):-1,Q=me?Ie(k):-1;if(J<=0&&Q<=0)continue;let P=(0,F.getRect)([k,"padding"],window),X=Pe(a,P)||-1/0;if(X===-1/0)if(A.padding&&Ae(a,rt(P,A.padding,tt)))X=-((0,F.getDistance)(a,P)||0);else continue;if(he&&R>=m&&J>0&&(R>m||X>g)){let T=0,C=p.none,L=Ce(qe,P.width),z=Le(L,i,a.width,P.width);c===p.right?(T=P.right+z-a.right,T<=L&&!oe(N(k),J)&&(C=p.right)):c===p.left&&(T=a.left-(P.left-z),T<=L&&N(k)>0&&(C=p.left)),C&&(d=k,m=R,y=L,g=X,E=C,b=T,f=J)}if(me&&R>=x&&Q>0&&(R>x||X>U)){let T=0,C=G.none,L=Ce(qe,P.height),z=Le(L,i,a.height,P.height);l===p.down?(T=P.bottom+z-a.bottom,T<=L&&!oe(q(k),Q)&&(C=p.down)):l===p.up&&(T=a.top-(P.top-z),T<=L&&q(k)>0&&(C=p.up)),C&&(v=k,x=R,V=L,U=X,ce=C,Ye=T,Ne=Q)}}t&&(d&&E?this._requestItemScroll(e,h.x,d,E,y,b,f):this._cancelItemScroll(e,h.x)),n&&(v&&ce?this._requestItemScroll(e,h.y,v,ce,V,Ye,Ne):this._cancelItemScroll(e,h.y))}_updateScrollRequest(e){let t=e.item,{inertAreaSize:n,smoothStop:i,targets:s}=t,o=this._getItemClientRect(t,Ke),c=null,l=0;for(;l<s.length;l++){let a=s[l],d=Te(a.element||a);if(d!==e.element)continue;let m=!!(h.x&e.direction);if(m){if(a.axis==="y")continue}else if(a.axis==="x")continue;let y=m?we(d):Ie(d);if(y<=0)break;let g=(0,F.getRect)([d,"padding"],window);if((Pe(o,g)||-1/0)===-1/0){let U=a.scrollPadding||a.padding;if(!(U&&Ae(o,rt(g,U,tt))))break}let b=typeof a.threshold=="number"?a.threshold:nt,f=Ce(b,m?g.width:g.height),v=Le(f,n,m?o.width:o.height,m?g.width:g.height),x=0;if(e.direction===p.left?x=o.left-(g.left-v):e.direction===p.right?x=g.right+v-o.right:e.direction===p.up?x=o.top-(g.top-v):x=g.bottom+v-o.bottom,x>f)break;let V=m?N(d):q(d);if(c=M.forward&e.direction?oe(V,y):V<=0,c)break;return e.maxValue=y,e.threshold=f,e.distance=x,e.isEnding=!1,!0}return i===!0&&e.speed>0?(c===null&&(c=e.hasReachedEnd()),e.isEnding=!c):e.isEnding=!1,e.isEnding}_updateItems(){for(let e=0;e<this.items.length;e++){let t=this.items[e],n=this._itemData.get(t),{x:i,y:s}=t.position,o=n.positionX,c=n.positionY;i===o&&s===c||(n.directionX=i>o?p.right:i<o?p.left:n.directionX,n.directionY=s>c?p.down:s<c?p.up:n.directionY,n.positionX=i,n.positionY=s,n.overlapCheckRequestTime===0&&(n.overlapCheckRequestTime=this._tickTime))}}_updateRequests(){let e=this.items,t=this._requests[h.x],n=this._requests[h.y],i=0;for(;i<e.length;i++){let s=e[i],o=this._itemData.get(s),c=o.overlapCheckRequestTime,l=c>0&&this._tickTime-c>this.settings.overlapCheckInterval,a=!0,d=t.get(s);d&&d.isActive&&(a=!this._updateScrollRequest(d),a&&(l=!0,this._cancelItemScroll(s,h.x)));let m=!0,y=n.get(s);y&&y.isActive&&(m=!this._updateScrollRequest(y),m&&(l=!0,this._cancelItemScroll(s,h.y))),l&&(o.overlapCheckRequestTime=0,this._checkItemOverlap(s,a,m))}}_requestAction(e,t){let n=t===h.x,i=null,s=0;for(;s<this._actions.length;s++){if(i=this._actions[s],e.element!==i.element){i=null;continue}if(n?i.requestX:i.requestY){this._cancelItemScroll(e.item,t);return}break}i||(i=this._actionPool.pick()),i.element=e.element,i.addRequest(e),e.tick(this._tickDeltaTime),this._actions.push(i)}_updateActions(){let e=0;for(e=0;e<this.items.length;e++){let t=this.items[e],n=this._requests[h.x].get(t),i=this._requests[h.y].get(t);n&&this._requestAction(n,h.x),i&&this._requestAction(i,h.y)}for(e=0;e<this._actions.length;e++)this._actions[e].computeScrollValues()}_applyActions(){if(!this._actions.length)return;this._emitter.emit("beforescroll");let e=0;for(e=0;e<this._actions.length;e++)this._actions[e].scroll(),this._actionPool.put(this._actions[e]);this._actions.length=0;let t;for(e=0;e<this.items.length;e++)t=this.items[e],t.onPrepareScrollEffect&&t.onPrepareScrollEffect();for(e=0;e<this.items.length;e++)t=this.items[e],t.onApplyScrollEffect&&t.onApplyScrollEffect();this._emitter.emit("afterscroll")}on(e,t){return this._emitter.on(e,t)}off(e,t){this._emitter.off(e,t)}addItem(e){if(this._isDestroyed||this._itemData.has(e))return;let{x:t,y:n}=e.position,i=new Re;i.positionX=t,i.positionY=n,i.directionX=p.none,i.directionY=p.none,i.overlapCheckRequestTime=this._tickTime,this._itemData.set(e,i),this.items.push(e),this._isTicking||this._startTicking()}removeItem(e){if(this._isDestroyed)return;let t=this.items.indexOf(e);t!==-1&&(this._requests[h.x].get(e)&&(this._cancelItemScroll(e,h.x),this._requests[h.x].delete(e)),this._requests[h.y].get(e)&&(this._cancelItemScroll(e,h.y),this._requests[h.y].delete(e)),this._itemData.delete(e),this.items.splice(t,1),this._isTicking&&!this.items.length&&this._stopTicking())}isDestroyed(){return this._isDestroyed}isItemScrollingX(e){return!!this._requests[h.x].get(e)?.isActive}isItemScrollingY(e){return!!this._requests[h.y].get(e)?.isActive}isItemScrolling(e){return this.isItemScrollingX(e)||this.isItemScrollingY(e)}updateSettings(e={}){let{overlapCheckInterval:t=this.settings.overlapCheckInterval}=e;this.settings.overlapCheckInterval=t}destroy(){if(this._isDestroyed)return;let e=this.items.slice(0),t=0;for(;t<e.length;t++)this.removeItem(e[t]);this._actions.length=0,this._requestPool.reset(),this._actionPool.reset(),this._emitter.off(),this._isDestroyed=!0}};var se=new j;var $={x:0,y:0},K={left:0,top:0,width:0,height:0};function bt(){return{targets:[],inertAreaSize:.2,speed:We(),smoothStop:!1,getPosition:r=>{let{drag:e}=r,t=e?.items[0];if(t)$.x=t.pX,$.y=t.pY;else{let n=e&&(e.nextMoveEvent||e.startEvent);$.x=n?n.x:0,$.y=n?n.y:0}return $},getClientRect:r=>{let{drag:e}=r,t=e?.items[0];if(t&&t.element){let{left:n,top:i,width:s,height:o}=t.element.getBoundingClientRect();K.left=n,K.top=i,K.width=s,K.height=o}else{let n=e&&(e.nextMoveEvent||e.startEvent);K.left=n?n.x-25:0,K.top=n?n.y-25:0,K.width=n?50:0,K.height=n?50:0}return K},onStart:null,onStop:null}}var Xe=class{constructor(e,t){this._draggableAutoScroll=e,this._draggable=t,this._position={x:0,y:0},this._clientRect={left:0,top:0,width:0,height:0}}_getSettings(){return this._draggableAutoScroll.settings}get targets(){let{targets:e}=this._getSettings();return typeof e=="function"&&(e=e(this._draggable)),e}get position(){let{getPosition:e}=this._getSettings();if(typeof e=="function"){let t=e(this._draggable);this._position.x=t.x,this._position.y=t.y}else this._position.x=0,this._position.y=0;return this._position}get clientRect(){let{getClientRect:e}=this._getSettings();if(typeof e=="function"){let{left:t,top:n,width:i,height:s}=e(this._draggable);this._clientRect.left=t,this._clientRect.top=n,this._clientRect.width=i,this._clientRect.height=s}else this._clientRect.left=0,this._clientRect.top=0,this._clientRect.width=0,this._clientRect.height=0;return this._clientRect}get inertAreaSize(){return this._getSettings().inertAreaSize}get smoothStop(){return this._getSettings().smoothStop}get speed(){return this._getSettings().speed}get onStart(){return this._getSettings().onStart}get onStop(){return this._getSettings().onStop}onPrepareScrollEffect(){let e=this._draggable._updateId;u.off(S,e),u.off(D,e),this._draggable._preparePositionUpdate()}onApplyScrollEffect(){this._draggable._applyPositionUpdate()}},ae=class{constructor(e,t={}){this.name="autoscroll",this.version="0.0.2",this.settings=this._parseSettings(t),this._autoScrollProxy=null,e.on("start",()=>{this._autoScrollProxy||(this._autoScrollProxy=new Xe(this,e),se.addItem(this._autoScrollProxy))}),e.on("end",()=>{this._autoScrollProxy&&(se.removeItem(this._autoScrollProxy),this._autoScrollProxy=null)})}_parseSettings(e,t=bt()){let{targets:n=t.targets,inertAreaSize:i=t.inertAreaSize,speed:s=t.speed,smoothStop:o=t.smoothStop,getPosition:c=t.getPosition,getClientRect:l=t.getClientRect,onStart:a=t.onStart,onStop:d=t.onStop}=e||{};return{targets:n,inertAreaSize:i,speed:s,smoothStop:o,getPosition:c,getClientRect:l,onStart:a,onStop:d}}updateSettings(e={}){this.settings=this._parseSettings(e,this.settings)}};function Dt(r){return e=>{let t=new ae(e,r),n=e;return n.plugins[t.name]=t,n}}var ot=new Set(["auto","scroll","overlay"]);function le(r){let e=re(r);return!!(ot.has(e.overflowY)||ot.has(e.overflowX))}function st(r){return r instanceof Document}function at(r,e=[]){let t=r?.parentNode;for(;t&&!st(t);)t instanceof Element?(le(t)&&e.push(t),t=t.parentNode):t instanceof ShadowRoot?t=t.host:t=t.parentNode;return e.push(window),e}function xt(r){let e=[];return le(r)&&e.push(r),at(r,e),e}function Pt(r={}){let e,t=0,n=null,i,{timeout:s=250,fallback:o=()=>!0}=r,c=d=>d.preventDefault(),l=d=>{if(t){if(e){d.cancelable&&d.preventDefault();return}e===void 0&&(d.cancelable&&d.timeStamp-t>s?(e=!0,d.preventDefault()):e=!1)}};return d=>{if(!(d.sensor instanceof W))return o(d);let{draggable:m,sensor:y,event:g}=d,E=g;if(E.pointerType==="touch"){if(E.type==="start"&&(E.srcEvent.type==="pointerdown"||E.srcEvent.type==="touchstart")){n=E.target;let b=n?xt(n):[];b.forEach(v=>{v.addEventListener("touchmove",l,{passive:!1,capture:!0})});let f=()=>{t&&(m.off("end",f),m.sensors.forEach(v=>{v instanceof W&&v.off("end",f)}),n?.removeEventListener("contextmenu",c),b.forEach(v=>{v.removeEventListener("touchmove",l,{capture:!0})}),t=0,e=void 0,n=null,i=void window.clearTimeout(i))};e=void 0,t=E.srcEvent.timeStamp,n?.addEventListener("contextmenu",c),m.on("end",f),m.sensors.forEach(v=>{v instanceof W&&v.off("end",f)}),s>0&&(i=window.setTimeout(()=>{m.resolveStartPredicate(y),e=!0,i=void 0},s))}return e}return E.type==="start"&&!E.srcEvent.button}}0&&(module.exports={AUTO_SCROLL_AXIS,AUTO_SCROLL_AXIS_DIRECTION,AUTO_SCROLL_DIRECTION,AutoScroll,BaseMotionSensor,BaseSensor,Draggable,DraggableAutoScroll,KeyboardMotionSensor,KeyboardSensor,PointerSensor,SensorEventType,autoScroll,autoScrollPlugin,autoScrollSmoothSpeed,createPointerSensorStartPredicate,setTicker,ticker,tickerReadPhase,tickerWritePhase});
