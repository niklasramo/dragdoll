import{DndContext as e,DndContextEventType as t,Draggable as n,Droppable as r,KeyboardMotionSensor as i,KeyboardSensor as a,PointerSensor as o}from"dragdoll";import{cloneElement as s,createContext as c,memo as l,useCallback as u,useContext as d,useEffect as f,useMemo as p,useRef as m,useState as h}from"react";import{jsx as g}from"react/jsx-runtime";const _=c(null);function v({children:n,options:r,onStart:i,onMove:a,onEnter:o,onLeave:s,onCollide:c,onEnd:l}){let u=m(null),[d,p]=h(null);return f(()=>{let t=new e(r);return u.current=t,p({context:t}),()=>{u.current&&=(u.current.destroy(),null)}},[r]),f(()=>{if(!u.current)return;let e=[];if(i){let n=u.current.on(t.Start,i);e.push({type:t.Start,id:n})}if(a){let n=u.current.on(t.Move,a);e.push({type:t.Move,id:n})}if(o){let n=u.current.on(t.Enter,o);e.push({type:t.Enter,id:n})}if(s){let n=u.current.on(t.Leave,s);e.push({type:t.Leave,id:n})}if(c){let n=u.current.on(t.Collide,c);e.push({type:t.Collide,id:n})}if(l){let n=u.current.on(t.End,l);e.push({type:t.End,id:n})}return()=>{if(u.current)for(let{type:t,id:n}of e)u.current.off(t,n)}},[i,a,o,s,c,l]),d?g(_.Provider,{value:d,children:n}):null}function y(){let e=d(_);if(!e)throw Error(`useDndContext must be used within DndContextProvider`);return e}function b(e){let{context:t}=y();f(()=>{let n=[];for(let[r,i]of Object.entries(e))if(i){let e=t.on(r,i);n.push({type:r,id:e})}return()=>{for(let{type:e,id:r}of n)t.off(e,r)}},[t,e])}function x({element:e,id:t,pointerSensor:r=!0,keyboardSensor:s,keyboardMotionSensor:c,sensors:l,elements:d,...g}){let _=m(null),[v,b]=h(null),x=y().context,S=m(null),C=u(()=>{if(l)return l;let e=[];if(S.current){if(r){let t=typeof r==`object`?r:{};e.push(new o(S.current,t))}if(s){let t=typeof s==`object`?s:{};e.push(new a(S.current,t))}if(c){let t=typeof c==`object`?c:{};e.push(new i(S.current,t))}}return e},[r,s,c,l]),w=u(()=>{if(!S.current||_.current)return;let e=C();if(e.length===0)return;let r=new n(e,{id:t,...g,elements:d||(()=>S.current?[S.current]:null)});return _.current=r,b(r),x.addDraggables([r]),r},[t,C,d,g,x]),T=u(e=>{S.current=e,e&&!_.current&&w()},[w]);return f(()=>{S.current=e,e&&!_.current&&w()},[e,w]),f(()=>()=>{_.current&&(x.removeDraggables([_.current]),_.current.destroy(),_.current=null,b(null))},[x]),p(()=>({draggable:v,ref:T}),[v,T])}function S({children:e,id:t,pointerSensor:n=!0,keyboardSensor:r,keyboardMotionSensor:i,sensors:a,elements:o,...c}){let l=m(null),{ref:d}=x({element:l.current,id:t,pointerSensor:n,keyboardSensor:r,keyboardMotionSensor:i,sensors:a,elements:o||(()=>l.current?[l.current]:null),...c}),f=u(t=>{l.current=t,d(t);let n=Array.isArray(e)?e[0]:e;if(n&&typeof n==`object`&&`props`in n&&n.props.ref){let e=n.props.ref;typeof e==`function`?e(t):e&&`current`in e&&(e.current=t)}},[e,d]);if(typeof e==`function`)return e({ref:f});let p=Array.isArray(e)?e[0]:e;if(!p||typeof p!=`object`||!(`props`in p))throw Error(`Draggable expects a single React element as children`);return s(p,{ref:f})}const C=l(S);function w({element:e,id:t,accept:n,data:i}){let a=m(null),[o,s]=h(null),c=y().context,l=m(null),d=u(()=>{if(!l.current||a.current)return;let e={id:t,accept:n,data:i},o=new r(l.current,e);return a.current=o,s(o),c.addDroppables([o]),o},[t,n,i,c]),g=u(e=>{l.current=e,e&&!a.current&&d()},[d]);return f(()=>{l.current=e,e&&!a.current&&d()},[e,d]),f(()=>{a.current&&(n!==void 0&&(a.current.accept=n),i!==void 0&&(a.current.data=i))},[n,i]),f(()=>()=>{a.current&&(c.removeDroppables([a.current]),a.current.destroy(),a.current=null,s(null))},[c]),p(()=>({droppable:o,ref:g}),[o,g])}function T({children:e,id:t,accept:n,data:r}){let i=m(null),{ref:a}=w({element:i.current,id:t,accept:n,data:r}),o=u(t=>{i.current=t,a(t);let n=Array.isArray(e)?e[0]:e;if(n&&typeof n==`object`&&`props`in n&&n.props.ref){let e=n.props.ref;typeof e==`function`?e(t):e&&`current`in e&&(e.current=t)}},[e,a]);if(typeof e==`function`)return e({ref:o});let c=Array.isArray(e)?e[0]:e;if(!c||typeof c!=`object`||!(`props`in c))throw Error(`Droppable expects a single React element as children`);return s(c,{ref:o})}const E=l(T);export{_ as DndContextContext,v as DndContextProvider,C as Draggable,E as Droppable,y as useDndContext,b as useDndContextEvents,x as useDraggable,w as useDroppable};
//# sourceMappingURL=index.js.map