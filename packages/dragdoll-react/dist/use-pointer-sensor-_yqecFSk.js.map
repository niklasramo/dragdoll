{"version":3,"file":"use-pointer-sensor-_yqecFSk.js","names":[],"sources":["../src/hooks/use-pointer-sensor.ts"],"sourcesContent":["import type { PointerSensorEvents, PointerSensorSettings } from 'dragdoll';\nimport { PointerSensor } from 'dragdoll';\nimport { useRef, useState } from 'react';\nimport { useCallbackStable } from './use-callback-stable.js';\nimport { useIsomorphicLayoutEffect } from './use-isomorphic-layout-effect.js';\nimport { useMemoStable } from './use-memo-stable.js';\n\nexport function usePointerSensor<E extends PointerSensorEvents = PointerSensorEvents>(\n  settings: Partial<PointerSensorSettings> = {},\n  element?: Element | Window,\n) {\n  const [sensor, setSensor] = useState<PointerSensor<E> | null>(null);\n  const sensorRef = useRef<PointerSensor<E> | null>(sensor);\n  const settingsRef = useRef(settings);\n\n  // Helper function to create a new pointer sensor.\n  const createSensor = useCallbackStable((node: Element | Window) => {\n    sensorRef.current?.destroy();\n    const newSensor = new PointerSensor<E>(node, settingsRef.current);\n    sensorRef.current = newSensor;\n    setSensor(newSensor);\n  }, []);\n\n  // Helper function to destroy the pointer sensor.\n  const destroySensor = useCallbackStable(() => {\n    if (!sensorRef.current) return;\n    sensorRef.current.destroy();\n    sensorRef.current = null;\n    setSensor(null);\n  }, []);\n\n  // Ref callback for the pointer sensor element IF user does not provide an\n  // explicit element.\n  const setRef = useCallbackStable(\n    (node: Element | null) => {\n      // If user provides an explicit element, do not create a new pointer\n      // sensor.\n      if (element !== undefined) return;\n\n      // Destroy the pointer sensor if the node is null.\n      if (node === null) {\n        destroySensor();\n        return;\n      }\n\n      // Create a new pointer sensor if there is no sensor or the node has\n      // changed.\n      const currentSensor = sensorRef.current;\n      if (!currentSensor || currentSensor.element !== node) {\n        createSensor(node);\n      }\n    },\n    [element, createSensor, destroySensor],\n  );\n\n  // Keep settings up to date.\n  settingsRef.current = settings;\n\n  // Handle explicit element change.\n  useIsomorphicLayoutEffect(() => {\n    if (element === undefined) return;\n    createSensor(element);\n    return destroySensor;\n  }, [element, createSensor, destroySensor]);\n\n  // Handle settings change.\n  useIsomorphicLayoutEffect(() => {\n    if (sensor) sensor.updateSettings(settings);\n  }, [sensor, settings]);\n\n  return useMemoStable(() => {\n    return [sensor, setRef] as const;\n  }, [sensor, setRef]);\n}\n"],"mappings":"kNAOA,SAAgB,EACd,EAA2C,EAAE,CAC7C,EACA,CACA,GAAM,CAAC,EAAQ,GAAa,EAAkC,KAAK,CAC7D,EAAY,EAAgC,EAAO,CACnD,EAAc,EAAO,EAAS,CAG9B,EAAe,EAAmB,GAA2B,CACjE,EAAU,SAAS,SAAS,CAC5B,IAAM,EAAY,IAAI,EAAiB,EAAM,EAAY,QAAQ,CACjE,EAAU,QAAU,EACpB,EAAU,EAAU,EACnB,EAAE,CAAC,CAGA,EAAgB,MAAwB,CACvC,EAAU,UACf,EAAU,QAAQ,SAAS,CAC3B,EAAU,QAAU,KACpB,EAAU,KAAK,GACd,EAAE,CAAC,CAIA,EAAS,EACZ,GAAyB,CAGxB,GAAI,IAAY,IAAA,GAAW,OAG3B,GAAI,IAAS,KAAM,CACjB,GAAe,CACf,OAKF,IAAM,EAAgB,EAAU,SAC5B,CAAC,GAAiB,EAAc,UAAY,IAC9C,EAAa,EAAK,EAGtB,CAAC,EAAS,EAAc,EAAc,CACvC,CAiBD,MAdA,GAAY,QAAU,EAGtB,MAAgC,CAC1B,OAAY,IAAA,GAEhB,OADA,EAAa,EAAQ,CACd,GACN,CAAC,EAAS,EAAc,EAAc,CAAC,CAG1C,MAAgC,CAC1B,GAAQ,EAAO,eAAe,EAAS,EAC1C,CAAC,EAAQ,EAAS,CAAC,CAEf,MACE,CAAC,EAAQ,EAAO,CACtB,CAAC,EAAQ,EAAO,CAAC"}