import{ticker as e,tickerPhases as t}from"./ticker-ep3c22TT.js";import{createFullRect as n}from"./create-full-rect-ABJfaR4O.js";import{getIntersectionScore as r}from"./get-intersection-score-CvSlwByb.js";import{getRect as i}from"./get-rect-BRzLuevJ.js";import{getDistance as a}from"mezr/getDistance";var o=class{constructor(e,{batchSize:t=100,minBatchCount:n=0,maxBatchCount:r=2**53-1,initialBatchCount:i=0,shrinkThreshold:a=2,onRelease:o}={}){this._batchSize=Math.floor(Math.max(t,1)),this._minSize=Math.floor(Math.max(n,0))*this._batchSize,this._maxSize=Math.floor(Math.min(Math.max(r*this._batchSize,this._batchSize),2**53-1)),this._shrinkThreshold=Math.floor(Math.max(a,1)*this._batchSize),this._data=Array(Math.floor(Math.max(Math.max(i,n)*this._batchSize,0))),this._index=0,this._getItem=e,this._onRelease=o}get(...e){if(this._index>0)return this._getItem(this._data[--this._index],...e);if(this._index===0){let e=this._data.length,t=Math.min(this._batchSize,this._maxSize-e);t>0&&(this._data.length=e+t)}return this._getItem(void 0,...e)}release(e){if(this._index<this._maxSize&&(this._onRelease&&this._onRelease(e),this._data[this._index++]=e,this._index>=this._shrinkThreshold)){let e=this._data.length-this._batchSize;e>=this._minSize&&(this._data.length=e,this._index-=this._batchSize)}}destroy(){this._data.length=0,this._index=0}};const s=n(),c=n();function l(e,t){return a(n(e,s),n(t,c))}function u(e){return e instanceof Window}function d(e){return u(e)||e===document.documentElement||e===document.body?window:e}function f(e){return u(e)?e.scrollX:e.scrollLeft}function p(e){return u(e)&&(e=document.documentElement),e.scrollWidth-e.clientWidth}function m(e){return u(e)?e.scrollY:e.scrollTop}function h(e){return u(e)&&(e=document.documentElement),e.scrollHeight-e.clientHeight}function g(e,t){return!(e.x+e.width<=t.x||t.x+t.width<=e.x||e.y+e.height<=t.y||t.y+t.height<=e.y)}const _={width:0,height:0,x:0,y:0},v={direction:`none`,threshold:0,distance:0,value:0,maxValue:0,duration:0,speed:0,deltaTime:0,isEnding:!1},y={x:1,y:2},b={forward:4,reverse:8},x={none:0,left:y.x|b.reverse,right:y.x|b.forward},S={none:0,up:y.y|b.reverse,down:y.y|b.forward},C={...x,...S};function w(e){switch(e){case x.none:case S.none:return`none`;case x.left:return`left`;case x.right:return`right`;case S.up:return`up`;case S.down:return`down`;default:throw Error(`Unknown direction value: ${e}`)}}function T(e,t,n){let{left:r=0,right:i=0,top:a=0,bottom:o=0}=t;return r=Math.max(0,r),i=Math.max(0,i),a=Math.max(0,a),o=Math.max(0,o),n.width=e.width+r+i,n.height=e.height+a+o,n.x=e.x-r,n.y=e.y-a,n}function E(e,t){return Math.ceil(e)>=Math.floor(t)}function D(e,t){return Math.min(t/2,e)}function O(e,t,n,r){return Math.max(0,n+e*2+r*t-r)/2}var k=class{constructor(){this.positionX=0,this.positionY=0,this.directionX=C.none,this.directionY=C.none,this.overlapCheckRequestTime=0}},A=class{constructor(){this.element=null,this.requestX=null,this.requestY=null,this.scrollLeft=0,this.scrollTop=0}reset(){this.requestX&&(this.requestX.action=null),this.requestY&&(this.requestY.action=null),this.element=null,this.requestX=null,this.requestY=null,this.scrollLeft=0,this.scrollTop=0}addRequest(e){y.x&e.direction?(this.requestX&&this.removeRequest(this.requestX),this.requestX=e):(this.requestY&&this.removeRequest(this.requestY),this.requestY=e),e.action=this}removeRequest(e){this.requestX===e?(this.requestX=null,e.action=null):this.requestY===e&&(this.requestY=null,e.action=null)}computeScrollValues(){this.element&&(this.scrollLeft=this.requestX?this.requestX.value:f(this.element),this.scrollTop=this.requestY?this.requestY.value:m(this.element))}scroll(){this.element&&(this.element.scrollTo?this.element.scrollTo(this.scrollLeft,this.scrollTop):(this.element.scrollLeft=this.scrollLeft,this.element.scrollTop=this.scrollTop))}},j=class{constructor(){this.item=null,this.element=null,this.isActive=!1,this.isEnding=!1,this.direction=0,this.value=NaN,this.maxValue=0,this.threshold=0,this.distance=0,this.deltaTime=0,this.speed=0,this.duration=0,this.action=null}reset(){this.isActive&&this.onStop(),this.item=null,this.element=null,this.isActive=!1,this.isEnding=!1,this.direction=0,this.value=NaN,this.maxValue=0,this.threshold=0,this.distance=0,this.deltaTime=0,this.speed=0,this.duration=0,this.action=null}hasReachedEnd(){return b.forward&this.direction?E(this.value,this.maxValue):this.value<=0}computeCurrentScrollValue(){return this.element?this.value===this.value?Math.max(0,Math.min(this.value,this.maxValue)):y.x&this.direction?f(this.element):m(this.element):0}computeNextScrollValue(){let e=this.speed*(this.deltaTime/1e3),t=b.forward&this.direction?this.value+e:this.value-e;return Math.max(0,Math.min(t,this.maxValue))}computeSpeed(){if(!this.item||!this.element)return 0;let{speed:e}=this.item;return typeof e==`function`?(v.direction=w(this.direction),v.threshold=this.threshold,v.distance=this.distance,v.value=this.value,v.maxValue=this.maxValue,v.duration=this.duration,v.speed=this.speed,v.deltaTime=this.deltaTime,v.isEnding=this.isEnding,e(this.element,v)):e}tick(e){return this.isActive||(this.isActive=!0,this.onStart()),this.deltaTime=e,this.value=this.computeCurrentScrollValue(),this.speed=this.computeSpeed(),this.value=this.computeNextScrollValue(),this.duration+=e,this.value}onStart(){if(!this.item||!this.element)return;let{onStart:e}=this.item;typeof e==`function`&&e(this.element,w(this.direction))}onStop(){if(!this.item||!this.element)return;let{onStop:e}=this.item;typeof e==`function`&&e(this.element,w(this.direction))}};function M(e=500,t=.5,n=.25){let r=e*(t>0?1/t:1/0),i=e*(n>0?1/n:1/0);return function(t,n){let a=0;if(!n.isEnding)if(n.threshold>0){let t=n.threshold-Math.max(0,n.distance);a=e/n.threshold*t}else a=e;let o=n.speed;if(o===a)return a;let s=a;return o<a?(s=o+r*(n.deltaTime/1e3),Math.min(a,s)):(s=o-i*(n.deltaTime/1e3),Math.max(a,s))}}var N=class{constructor(e={}){let{overlapCheckInterval:t=150}=e;this.items=[],this.settings={overlapCheckInterval:t},this._actions=[],this._isDestroyed=!1,this._isTicking=!1,this._tickTime=0,this._tickDeltaTime=0,this._requests={[y.x]:new Map,[y.y]:new Map},this._itemData=new Map,this._requestPool=new o(e=>e||new j,{initialBatchCount:1,minBatchCount:1,onRelease:e=>e.reset()}),this._actionPool=new o(e=>e||new A,{batchSize:10,initialBatchCount:1,minBatchCount:1,onRelease:e=>e.reset()}),this._frameRead=this._frameRead.bind(this),this._frameWrite=this._frameWrite.bind(this)}_frameRead(e){this._isDestroyed||(e&&this._tickTime?(this._tickDeltaTime=e-this._tickTime,this._tickTime=e,this._updateItems(),this._updateRequests(),this._updateActions()):(this._tickTime=e,this._tickDeltaTime=0))}_frameWrite(){this._isDestroyed||this._applyActions()}_startTicking(){this._isTicking||(this._isTicking=!0,e.on(t.read,this._frameRead,this._frameRead),e.on(t.write,this._frameWrite,this._frameWrite))}_stopTicking(){this._isTicking&&(this._isTicking=!1,this._tickTime=0,this._tickDeltaTime=0,e.off(t.read,this._frameRead),e.off(t.write,this._frameWrite))}_requestItemScroll(e,t,n,r,i,a,o){let s=this._requests[t],c=s.get(e);c?(c.element!==n||c.direction!==r)&&c.reset():(c=this._requestPool.get(),s.set(e,c)),c.item=e,c.element=n,c.direction=r,c.threshold=i,c.distance=a,c.maxValue=o}_cancelItemScroll(e,t){let n=this._requests[t],r=n.get(e);r&&(r.action&&r.action.removeRequest(r),this._requestPool.release(r),n.delete(e))}_checkItemOverlap(e,t,n){let{inertAreaSize:a,targets:o,clientRect:s}=e;if(!o.length){t&&this._cancelItemScroll(e,y.x),n&&this._cancelItemScroll(e,y.y);return}let c=this._itemData.get(e),u=c?.directionX,v=c?.directionY;if(!u&&!v){t&&this._cancelItemScroll(e,y.x),n&&this._cancelItemScroll(e,y.y);return}let b=null,x=-1/0,w=0,k=-1/0,A=C.none,j=0,M=0,N=null,P=-1/0,F=0,I=-1/0,L=C.none,R=0,z=0,B=0;for(;B<o.length;B++){let e=o[B],c=typeof e.threshold==`number`?e.threshold:50,y=!!(t&&u&&e.axis!==`y`),V=!!(n&&v&&e.axis!==`x`),H=e.priority||0;if((!y||H<x)&&(!V||H<P))continue;let U=d(e.element||e),W=y?p(U):-1,G=V?h(U):-1;if(W<=0&&G<=0)continue;let K=i([U,`padding`],window),q=r(s,K)||-1/0;if(q===-1/0)if(e.padding&&g(s,T(K,e.padding,_)))q=-(l(s,K)||0);else continue;if(y&&H>=x&&W>0&&(H>x||q>k)){let e=0,t=C.none,n=D(c,K.width),r=O(n,a,s.width,K.width);u===C.right?(e=K.x+K.width+r-(s.x+s.width),e<=n&&!E(f(U),W)&&(t=C.right)):u===C.left&&(e=s.x-(K.x-r),e<=n&&f(U)>0&&(t=C.left)),t&&(b=U,x=H,w=n,k=q,A=t,j=e,M=W)}if(V&&H>=P&&G>0&&(H>P||q>I)){let e=0,t=S.none,n=D(c,K.height),r=O(n,a,s.height,K.height);v===C.down?(e=K.y+K.height+r-(s.y+s.height),e<=n&&!E(m(U),G)&&(t=C.down)):v===C.up&&(e=s.y-(K.y-r),e<=n&&m(U)>0&&(t=C.up)),t&&(N=U,P=H,F=n,I=q,L=t,R=e,z=G)}}t&&(b&&A?this._requestItemScroll(e,y.x,b,A,w,j,M):this._cancelItemScroll(e,y.x)),n&&(N&&L?this._requestItemScroll(e,y.y,N,L,F,R,z):this._cancelItemScroll(e,y.y))}_updateScrollRequest(e){let{inertAreaSize:t,smoothStop:n,targets:a,clientRect:o}=e.item,s=null,c=0;for(;c<a.length;c++){let n=a[c],l=d(n.element||n);if(l!==e.element)continue;let u=!!(y.x&e.direction);if(u){if(n.axis===`y`)continue}else if(n.axis===`x`)continue;let v=u?p(l):h(l);if(v<=0)break;let x=i([l,`padding`],window);if((r(o,x)||-1/0)===-1/0){let e=n.scrollPadding||n.padding;if(!(e&&g(o,T(x,e,_))))break}let S=D(typeof n.threshold==`number`?n.threshold:50,u?x.width:x.height),w=O(S,t,u?o.width:o.height,u?x.width:x.height),k=0;if(k=e.direction===C.left?o.x-(x.x-w):e.direction===C.right?x.x+x.width+w-(o.x+o.width):e.direction===C.up?o.y-(x.y-w):x.y+x.height+w-(o.y+o.height),k>S)break;let A=u?f(l):m(l);if(s=b.forward&e.direction?E(A,v):A<=0,s)break;return e.maxValue=v,e.threshold=S,e.distance=k,e.isEnding=!1,!0}return n===!0&&e.speed>0?(s===null&&(s=e.hasReachedEnd()),e.isEnding=!s):e.isEnding=!1,e.isEnding}_updateItems(){for(let e=0;e<this.items.length;e++){let t=this.items[e],n=this._itemData.get(t),{x:r,y:i}=t.position,a=n.positionX,o=n.positionY;r===a&&i===o||(n.directionX=r>a?C.right:r<a?C.left:n.directionX,n.directionY=i>o?C.down:i<o?C.up:n.directionY,n.positionX=r,n.positionY=i,n.overlapCheckRequestTime===0&&(n.overlapCheckRequestTime=this._tickTime))}}_updateRequests(){let e=this.items,t=this._requests[y.x],n=this._requests[y.y],r=0;for(;r<e.length;r++){let i=e[r],a=this._itemData.get(i),o=a.overlapCheckRequestTime,s=o>0&&this._tickTime-o>this.settings.overlapCheckInterval,c=!0,l=t.get(i);l&&l.isActive&&(c=!this._updateScrollRequest(l),c&&(s=!0,this._cancelItemScroll(i,y.x)));let u=!0,d=n.get(i);d&&d.isActive&&(u=!this._updateScrollRequest(d),u&&(s=!0,this._cancelItemScroll(i,y.y))),s&&(a.overlapCheckRequestTime=0,this._checkItemOverlap(i,c,u))}}_requestAction(e,t){let n=t===y.x,r=null,i=0;for(;i<this._actions.length;i++){if(r=this._actions[i],e.element!==r.element){r=null;continue}if(n?r.requestX:r.requestY){this._cancelItemScroll(e.item,t);return}break}r||=this._actionPool.get(),r.element=e.element,r.addRequest(e),e.tick(this._tickDeltaTime),this._actions.push(r)}_updateActions(){let e=0;for(e=0;e<this.items.length;e++){let t=this.items[e],n=this._requests[y.x].get(t),r=this._requests[y.y].get(t);n&&this._requestAction(n,y.x),r&&this._requestAction(r,y.y)}for(e=0;e<this._actions.length;e++)this._actions[e].computeScrollValues()}_applyActions(){if(!this._actions.length)return;let e=0;for(e=0;e<this._actions.length;e++)this._actions[e].scroll(),this._actionPool.release(this._actions[e]);this._actions.length=0}addItem(e){if(this._isDestroyed||this._itemData.has(e))return;let{x:t,y:n}=e.position,r=new k;r.positionX=t,r.positionY=n,r.directionX=C.none,r.directionY=C.none,r.overlapCheckRequestTime=this._tickTime,this._itemData.set(e,r),this.items.push(e),this._isTicking||this._startTicking()}removeItem(e){if(this._isDestroyed)return;let t=this.items.indexOf(e);t!==-1&&(this._requests[y.x].get(e)&&(this._cancelItemScroll(e,y.x),this._requests[y.x].delete(e)),this._requests[y.y].get(e)&&(this._cancelItemScroll(e,y.y),this._requests[y.y].delete(e)),this._itemData.delete(e),this.items.splice(t,1),this._isTicking&&!this.items.length&&this._stopTicking())}isDestroyed(){return this._isDestroyed}isItemScrollingX(e){return!!this._requests[y.x].get(e)?.isActive}isItemScrollingY(e){return!!this._requests[y.y].get(e)?.isActive}isItemScrolling(e){return this.isItemScrollingX(e)||this.isItemScrollingY(e)}updateSettings(e={}){let{overlapCheckInterval:t=this.settings.overlapCheckInterval}=e;this.settings.overlapCheckInterval=t}destroy(){this._isDestroyed||=(this.items.forEach(e=>this.removeItem(e)),this._requestPool.destroy(),this._actionPool.destroy(),this._actions.length=0,!0)}};export{y as AUTO_SCROLL_AXIS,b as AUTO_SCROLL_AXIS_DIRECTION,C as AUTO_SCROLL_DIRECTION,N as AutoScroll,M as autoScrollSmoothSpeed};
//# sourceMappingURL=auto-scroll-Bm_nic0A.js.map