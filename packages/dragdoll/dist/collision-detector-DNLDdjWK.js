import{getIntersectionRect as e,getIntersectionScore as t}from"./get-intersection-score-nMuj0vta.js";function n(e,t={width:0,height:0,x:0,y:0}){return e&&(t.width=e.width,t.height=e.height,t.x=e.x,t.y=e.y),t}var r=class{constructor(e){this._items=[],this._index=0,this._getItem=e}get(...e){return this._index>=this._items.length?this._items[this._index++]=this._getItem(void 0,...e):this._getItem(this._items[this._index++],...e)}resetPointer(){this._index=0}resetItems(e=0){let t=Math.max(0,Math.min(e,this._items.length));this._index=Math.min(this._index,t),this._items.length=t}};const i=Symbol();var a=class{constructor(e){this._listenerId=Symbol(),this._dndContext=e,this._collisionDataPoolCache=[],this._collisionDataPoolMap=new Map}_checkCollision(r,i,a){let o=r.getClientRect(),s=i.getClientRect();if(!o)return null;let c=e(o,s,a.intersectionRect);if(c===null)return null;let l=t(o,s,c);return l<=0?null:(a.droppableId=i.id,n(s,a.droppableRect),n(o,a.draggableRect),a.intersectionScore=l,a)}_sortCollisions(e,t){return t.sort((e,t)=>{let n=t.intersectionScore-e.intersectionScore;return n===0?e.droppableRect.width*e.droppableRect.height-t.droppableRect.width*t.droppableRect.height:n})}_createCollisionData(){return{droppableId:i,droppableRect:n(),draggableRect:n(),intersectionRect:n(),intersectionScore:0}}getCollisionDataPool(e){let t=this._collisionDataPoolMap.get(e);return t||(t=this._collisionDataPoolCache.pop()||new r(e=>e||this._createCollisionData()),this._collisionDataPoolMap.set(e,t)),t}removeCollisionDataPool(e){let t=this._collisionDataPoolMap.get(e);t&&(t.resetItems(20),t.resetPointer(),this._collisionDataPoolCache.push(t),this._collisionDataPoolMap.delete(e))}detectCollisions(e,t,n){if(n.length=0,!t.size)return;let r=this.getCollisionDataPool(e),i=null,a=t.values();for(let t of a)i||=r.get(),this._checkCollision(e,t,i)&&(n.push(i),i=null);n.length>1&&this._sortCollisions(e,n),r.resetPointer()}destroy(){this._collisionDataPoolMap.forEach(e=>{e.resetItems()})}};export{a as CollisionDetector,n as createRect};
//# sourceMappingURL=collision-detector-DNLDdjWK.js.map