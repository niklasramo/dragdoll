import{SensorEventType as e}from"./sensor-TzqXogk2.js";import{HAS_POINTER_EVENTS as t,HAS_TOUCH_EVENTS as n}from"./constants-BG0DGMmK.js";import{Emitter as r}from"eventti";function i(e,t){if(`pointerId`in e)return e.pointerId===t?e:null;if(`changedTouches`in e){let n=0;for(;n<e.changedTouches.length;n++)if(e.changedTouches[n].identifier===t)return e.changedTouches[n];return null}return e}function a(e){return`pointerId`in e?e.pointerId:`changedTouches`in e?e.changedTouches[0]?e.changedTouches[0].identifier:null:-1}function o(e){return`pointerType`in e?e.pointerType:`touches`in e?`touch`:`mouse`}function s(e={}){let{capture:t=!0,passive:n=!0}=e;return{capture:t,passive:n}}function c(e){return e===`auto`||e===void 0?t?`pointer`:n?`touch`:`mouse`:e}const l={pointer:{start:`pointerdown`,move:`pointermove`,cancel:`pointercancel`,end:`pointerup`},touch:{start:`touchstart`,move:`touchmove`,cancel:`touchcancel`,end:`touchend`},mouse:{start:`mousedown`,move:`mousemove`,cancel:``,end:`mouseup`}};var u=class{constructor(e,t={}){let{listenerOptions:n={},sourceEvents:i=`auto`,startPredicate:a=e=>!(`button`in e&&e.button>0)}=t;this.element=e,this.drag=null,this.isDestroyed=!1,this._areWindowListenersBound=!1,this._startPredicate=a,this._listenerOptions=s(n),this._sourceEvents=c(i),this._emitter=new r,this._onStart=this._onStart.bind(this),this._onMove=this._onMove.bind(this),this._onCancel=this._onCancel.bind(this),this._onEnd=this._onEnd.bind(this),e.addEventListener(l[this._sourceEvents].start,this._onStart,this._listenerOptions)}_getTrackedPointerEventData(e){return this.drag?i(e,this.drag.pointerId):null}_onStart(t){if(this.isDestroyed||this.drag||!this._startPredicate(t))return;let n=a(t);if(n===null)return;let r=i(t,n);if(r===null)return;let s={pointerId:n,pointerType:o(t),x:r.clientX,y:r.clientY};this.drag=s;let c={...s,type:e.Start,srcEvent:t,target:r.target};this._emitter.emit(c.type,c),this.drag&&this._bindWindowListeners()}_onMove(t){if(!this.drag)return;let n=this._getTrackedPointerEventData(t);if(!n)return;this.drag.x=n.clientX,this.drag.y=n.clientY;let r={type:e.Move,srcEvent:t,target:n.target,...this.drag};this._emitter.emit(r.type,r)}_onCancel(t){if(!this.drag)return;let n=this._getTrackedPointerEventData(t);if(!n)return;this.drag.x=n.clientX,this.drag.y=n.clientY;let r={type:e.Cancel,srcEvent:t,target:n.target,...this.drag};this._emitter.emit(r.type,r),this._resetDrag()}_onEnd(t){if(!this.drag)return;let n=this._getTrackedPointerEventData(t);if(!n)return;this.drag.x=n.clientX,this.drag.y=n.clientY;let r={type:e.End,srcEvent:t,target:n.target,...this.drag};this._emitter.emit(r.type,r),this._resetDrag()}_bindWindowListeners(){if(this._areWindowListenersBound)return;let{move:e,end:t,cancel:n}=l[this._sourceEvents];window.addEventListener(e,this._onMove,this._listenerOptions),window.addEventListener(t,this._onEnd,this._listenerOptions),n&&window.addEventListener(n,this._onCancel,this._listenerOptions),this._areWindowListenersBound=!0}_unbindWindowListeners(){if(this._areWindowListenersBound){let{move:e,end:t,cancel:n}=l[this._sourceEvents];window.removeEventListener(e,this._onMove,this._listenerOptions),window.removeEventListener(t,this._onEnd,this._listenerOptions),n&&window.removeEventListener(n,this._onCancel,this._listenerOptions),this._areWindowListenersBound=!1}}_resetDrag(){this.drag=null,this._unbindWindowListeners()}cancel(){if(!this.drag)return;let t={type:e.Cancel,srcEvent:null,target:null,...this.drag};this._emitter.emit(t.type,t),this._resetDrag()}updateSettings(e){if(this.isDestroyed)return;let{listenerOptions:t,sourceEvents:n,startPredicate:r}=e,i=c(n),a=s(t);r&&this._startPredicate!==r&&(this._startPredicate=r),(t&&(this._listenerOptions.capture!==a.capture||this._listenerOptions.passive===a.passive)||n&&this._sourceEvents!==i)&&(this.element.removeEventListener(l[this._sourceEvents].start,this._onStart,this._listenerOptions),this._unbindWindowListeners(),this.cancel(),n&&(this._sourceEvents=i),t&&a&&(this._listenerOptions=a),this.element.addEventListener(l[this._sourceEvents].start,this._onStart,this._listenerOptions))}on(e,t,n){return this._emitter.on(e,t,n)}off(e,t){this._emitter.off(e,t)}destroy(){this.isDestroyed||(this.isDestroyed=!0,this.cancel(),this._emitter.emit(e.Destroy,{type:e.Destroy}),this._emitter.off(),this.element.removeEventListener(l[this._sourceEvents].start,this._onStart,this._listenerOptions))}};export{u as PointerSensor};
//# sourceMappingURL=pointer-sensor-Dbu_Xu9q.js.map