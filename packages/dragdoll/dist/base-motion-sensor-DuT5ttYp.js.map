{"version":3,"file":"base-motion-sensor-DuT5ttYp.js","names":["tickEvent: BaseMotionSensorTickEvent"],"sources":["../src/sensors/base-motion-sensor.ts"],"sourcesContent":["import { ticker, tickerPhases } from '../singletons/ticker.js';\nimport type { Point, Writeable } from '../types.js';\nimport type { BaseSensorDragData } from './base-sensor.js';\nimport { BaseSensor } from './base-sensor.js';\nimport type { Sensor, SensorEvents } from './sensor.js';\nimport { SensorEventType } from './sensor.js';\n\nexport interface BaseMotionSensorTickEvent {\n  type: 'tick';\n  time: number;\n  deltaTime: number;\n}\n\nexport interface BaseMotionSensorEvents extends SensorEvents {\n  tick: BaseMotionSensorTickEvent;\n}\n\nexport interface BaseMotionSensorDragData extends BaseSensorDragData {\n  readonly time: number;\n  readonly deltaTime: number;\n}\n\nexport class BaseMotionSensor<E extends BaseMotionSensorEvents = BaseMotionSensorEvents>\n  extends BaseSensor<E>\n  implements Sensor<E>\n{\n  declare _events_type: E;\n  readonly drag: BaseMotionSensorDragData | null;\n  protected _direction: Point;\n  protected _speed: number;\n\n  constructor() {\n    super();\n    this.drag = null;\n    this._direction = { x: 0, y: 0 };\n    this._speed = 0;\n\n    this._tick = this._tick.bind(this);\n  }\n\n  protected _createDragData(data: E['start']): BaseMotionSensorDragData {\n    return {\n      ...super._createDragData(data),\n      time: 0,\n      deltaTime: 0,\n    };\n  }\n\n  protected _start(data: E['start']) {\n    if (this.isDestroyed || this.drag) return;\n    super._start(data);\n    ticker.on(tickerPhases.read, this._tick, this._tick);\n  }\n\n  protected _end(data: E['end']) {\n    if (!this.drag) return;\n    ticker.off(tickerPhases.read, this._tick);\n    super._end(data);\n  }\n\n  protected _cancel(data: E['cancel']) {\n    if (!this.drag) return;\n    ticker.off(tickerPhases.read, this._tick);\n    super._cancel(data);\n  }\n\n  protected _tick(time: number) {\n    if (!this.drag) return;\n    if (time && this.drag.time) {\n      // Update tick time and delta time.\n      (this.drag.deltaTime as Writeable<number>) = time - this.drag.time;\n      (this.drag.time as Writeable<number>) = time;\n\n      // Emit tick event.\n      const tickEvent: BaseMotionSensorTickEvent = {\n        type: 'tick',\n        time: this.drag.time,\n        deltaTime: this.drag.deltaTime,\n      };\n      this._emitter.emit('tick', tickEvent);\n\n      // Make sure the sensor is still active.\n      if (!this.drag) return;\n\n      // Compute the movement offset (delta) by applying time factor to\n      // the speed. The speed is assumed to be provided as pixels-per-second.\n      const speedFactor = this._speed * (this.drag.deltaTime / 1000);\n      const deltaX = this._direction.x * speedFactor;\n      const deltaY = this._direction.y * speedFactor;\n\n      // Trigger move event if the clientX/Y needs change. Note that calling\n      // this._move() automatically updates clientX/Y values also so we don't\n      // need to do it here.\n      if (deltaX || deltaY) {\n        this._move({\n          type: SensorEventType.Move,\n          x: this.drag.x + deltaX,\n          y: this.drag.y + deltaY,\n        });\n      }\n    } else {\n      (this.drag.time as Writeable<number>) = time;\n      (this.drag.deltaTime as Writeable<number>) = 0;\n    }\n  }\n}\n"],"mappings":"8KAsBA,IAAa,EAAb,cACU,CAEV,CAME,aAAc,CACZ,OAAO,CACP,KAAK,KAAO,KACZ,KAAK,WAAa,CAAE,EAAG,EAAG,EAAG,EAAG,CAChC,KAAK,OAAS,EAEd,KAAK,MAAQ,KAAK,MAAM,KAAK,KAAK,CAGpC,gBAA0B,EAA4C,CACpE,MAAO,CACL,GAAG,MAAM,gBAAgB,EAAK,CAC9B,KAAM,EACN,UAAW,EACZ,CAGH,OAAiB,EAAkB,CAC7B,KAAK,aAAe,KAAK,OAC7B,MAAM,OAAO,EAAK,CAClB,EAAO,GAAG,EAAa,KAAM,KAAK,MAAO,KAAK,MAAM,EAGtD,KAAe,EAAgB,CACxB,KAAK,OACV,EAAO,IAAI,EAAa,KAAM,KAAK,MAAM,CACzC,MAAM,KAAK,EAAK,EAGlB,QAAkB,EAAmB,CAC9B,KAAK,OACV,EAAO,IAAI,EAAa,KAAM,KAAK,MAAM,CACzC,MAAM,QAAQ,EAAK,EAGrB,MAAgB,EAAc,CACvB,QAAK,KACV,GAAI,GAAQ,KAAK,KAAK,KAAM,CAEzB,KAAK,KAAK,UAAkC,EAAO,KAAK,KAAK,KAC7D,KAAK,KAAK,KAA6B,EAGxC,IAAMA,EAAuC,CAC3C,KAAM,OACN,KAAM,KAAK,KAAK,KAChB,UAAW,KAAK,KAAK,UACtB,CAID,GAHA,KAAK,SAAS,KAAK,OAAQ,EAAU,CAGjC,CAAC,KAAK,KAAM,OAIhB,IAAM,EAAc,KAAK,QAAU,KAAK,KAAK,UAAY,KACnD,EAAS,KAAK,WAAW,EAAI,EAC7B,EAAS,KAAK,WAAW,EAAI,GAK/B,GAAU,IACZ,KAAK,MAAM,CACT,KAAM,EAAgB,KACtB,EAAG,KAAK,KAAK,EAAI,EACjB,EAAG,KAAK,KAAK,EAAI,EAClB,CAAC,MAGH,KAAK,KAAK,KAA6B,EACvC,KAAK,KAAK,UAAkC"}