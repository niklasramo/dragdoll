import{Emitter}from"eventti";function createRequestFrame(e=60){if("function"==typeof requestAnimationFrame&&"function"==typeof cancelAnimationFrame)return e=>{const t=requestAnimationFrame(e);return()=>cancelAnimationFrame(t)};{const t=1e3/e,i="undefined"==typeof performance?()=>Date.now():()=>performance.now();return e=>{const r=setTimeout((()=>e(i())),t);return()=>clearTimeout(r)}}}var AutoTickState;!function(e){e[e.PAUSED=1]="PAUSED",e[e.ON_DEMAND=2]="ON_DEMAND",e[e.CONTINUOUS=3]="CONTINUOUS"}(AutoTickState||(AutoTickState={}));class Ticker{constructor(e={}){const{phases:t=[],autoTick:i=AutoTickState.ON_DEMAND,allowDuplicateListeners:r=!0,idDedupeMode:s="replace",requestFrame:n=createRequestFrame()}=e;this.phases=t,this._autoTick=i,this._requestFrame=n,this._cancelFrame=null,this._queue=[],this._emitter=new Emitter({allowDuplicateListeners:r,idDedupeMode:s}),this.tick=this.tick.bind(this)}get requestFrame(){return this._requestFrame}set requestFrame(e){this._requestFrame=e,this._kickstart()}get autoTick(){return this._autoTick}set autoTick(e){this._autoTick=e,this._kickstart()}get allowDuplicateListeners(){return this._emitter.allowDuplicateListeners}set allowDuplicateListeners(e){this._emitter.allowDuplicateListeners=e}get idDedupeMode(){return this._emitter.idDedupeMode}set idDedupeMode(e){this._emitter.idDedupeMode=e}tick(...e){this._cancelFrame=null;const{_queue:t}=this;if(t.length)throw new Error("Ticker: Can't tick before the previous tick has finished!");this._request();const{phases:i,_emitter:r}=this;let s,n,a,c,u,o;for(s=0,a=i.length;s<a;s++)o=r._getListeners(i[s]),o&&t.push(o);for(s=0,a=t.length;s<a;s++)for(u=t[s],n=0,c=u.length;n<c;n++)u[n](...e);t.length=0,this._autoTick!==AutoTickState.ON_DEMAND||r.listenerCount()||this._cancel()}on(e,t,i){const r=this._emitter.on(e,t,i);return this._request(),r}once(e,t,i){const r=this._emitter.once(e,t,i);return this._request(),r}off(e,t){return this._emitter.off(e,t)}listenerCount(e){return this._emitter.listenerCount(e)}_request(){this._requestFrame&&!this._cancelFrame&&this._autoTick>=AutoTickState.ON_DEMAND&&(this._cancelFrame=this._requestFrame(this.tick))}_cancel(){this._cancelFrame&&(this._cancelFrame(),this._cancelFrame=null)}_kickstart(){this._autoTick===AutoTickState.ON_DEMAND?this._emitter.listenerCount()&&this._request():this._autoTick===AutoTickState.CONTINUOUS?this._request():this._cancel()}}function createXrRequestFrame(e){return t=>{const i=e.requestAnimationFrame(t);return()=>e.cancelAnimationFrame(i)}}export{AutoTickState,Ticker,createRequestFrame,createXrRequestFrame};